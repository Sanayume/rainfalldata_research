# rainfalldata_research
# 高分辨率降雨融合与机器学习预测研究项目

## 1. 项目概述与研究意义

**背景:** 精准的降雨预测对于洪水预警、农业生产、水资源管理等领域至关重要。然而，单一数据源往往存在时空覆盖不完整、精度不足等问题。本项目旨在应对这一挑战，通过 **融合多种先进的卫星遥感降雨产品** (CMORPH, CHIRPS, GSMAP, IMERG, PERSIANN, SM2RAIN) 与 **地面观测融合数据** (CHM)，结合 **前沿的机器学习技术**，探索和构建高性能、高分辨率的降雨预测模型。

**目标:**
*   开发一套稳健的数据处理与融合流程，有效整合多源异构降雨数据。
*   设计并实现大规模、多维度的特征工程体系，深度挖掘数据中蕴含的降雨相关信息。
*   系统性地评估和优化多种机器学习模型（特别是梯度提升树如 XGBoost, LightGBM，并辅以贝叶斯方法等）在降雨预测任务上的性能。
*   深入分析模型误差，理解预测偏差来源，并驱动特征和模型的迭代优化。
*   针对重点区域（如长江流域）进行精细化建模，探索区域适应性预测策略。
*   重点提升在于降雨的命中率误报率以及临界成功指数, 主要看误报率是否有突破

**核心价值:** 本项目不仅致力于提升降雨预测精度，也深入探索了数据融合、特征工程和机器学习在复杂气象问题中的应用潜力，为相关领域的研究和应用提供方法论参考和技术积累。

## 2. 项目技术架构与实施细节

### 2.1 数据体系 (`data/`)

*   **多源数据整合:**
    *   **原始数据 (`raw/`)**: 涵盖 CMORPH, CHIRPS, GSMAP, IMERG, PERSIANN, SM2RAIN, CHM 等 **7 种主流降雨产品** 的原始数据（如 `.nc`, `.zip` 格式），时间跨度覆盖 **多年** (例如 2016-2020 年数据被重点处理)，空间分辨率各异，总数据量达到 **数十 GB 甚至 TB 级别**。相关的初步读取脚本位于 `src/readdata/` 目录下，例如 `CHM.py`, `CMORPH.py` 等。
    *   **挑战**: 处理不同产品的格式差异、坐标系统、时间分辨率不一致等问题。
*   **精细化预处理 (`intermediate/`, `processed/`)**:
    *   **NaN 值处理**: 实施了系统的缺失值处理流程，结合了 **时空插值方法** 与 **阈值替换策略**，确保数据完整性。处理后的数据按产品和年份存储 (`intermediate/`)，并最终生成用于模型输入的合并时间序列 `.mat` 文件 (`processed/`)。
    *   **空间掩码**: 生成并应用了中国大陆及主要流域（如长江流域）的高精度地理掩码 (`processed/.../masks/`)，以精确提取研究区域数据。
    *   **标准化与对齐**: 进行了必要的时间和空间分辨率对齐操作。

### 2.2 特征工程 (主要代码位于 `src/nationwide/project_all_for_deepling_learning/turn*.py`, `src/yangtze/YangTsu/turn*.py`)

构建了一个 **包含数百个潜在特征** 的大规模特征库，体现了对降雨物理机制和数据驱动模式的深度理解：

*   **基础信息**: 各降雨产品在目标点的原始降雨量。
*   **多产品协同**: 利用产品间的统计关系（均值、标准差、中位数、极差、一致降雨产品数）来 **量化不同产品的一致性与不确定性**，这是单一产品分析无法实现的。
*   **时序动态捕捉**:
    *   **周期性**: 采用正余弦函数编码年内周期、季节性虚拟变量等捕捉季节变化规律。
    *   **记忆性**: 引入 **多尺度时间滞后项** (t-1, t-2, t-3 天等) 捕捉降雨的持续性和短期依赖。
    *   **变化率**: 计算 **时间差分** 特征捕捉降雨强度的变化趋势。
    *   **累积效应**: 设计了 **多窗口滑动统计** (如 3, 7, 15 天窗口的均值、标准差、最值、范围) 以捕捉不同时间尺度下的降雨累积和波动特征。
*   **空间关联**: 引入 **3x3 邻域** 的空间统计量（均值、标准差、最大值）及其与中心点的差异，以 **刻画降雨事件的空间展布和局部梯度**。
*   **弱信号增强**: 特别设计了针对 **毛毛雨、小雨等低强度降雨** 的探测特征（如距 0.1mm 阈值距离、变异系数 CV、特定强度分箱），旨在提升模型对这类易被忽略但重要的降雨事件的敏感度。
*   **高阶交互**: 探索性地构建了 **交互特征** (如 `产品标准差 * 季节性因子`)，试图捕捉非线性、多因素耦合的复杂降雨模式。
*   **迭代优化**: 特征集经历了 **至少 6 个主要版本 (`v1` 到 `v6`) 的迭代** (具体体现在 `src/yangtze/YangTsu/turn1.py` 至 `turn6.py` 等脚本中，结果存储于 `results/yangtze/features/`)，每一版本的调整都基于前一轮的模型评估和误差分析结果，体现了 **数据驱动的特征选择和优化** 过程。

具体到长江流域的特征工程 (`src/yangtze/YangTsu/turn*.py`)，其迭代过程和主要变化如下：

*   **V1 (`turn1.py`): 重大转变 - 转向格点数据并大幅简化特征**
    *   **数据处理重大变化**: 通过 `ALL_DATA.yangtsu()` 返回的是**格点数据** (`(prod, time, lat, lon)`)。脚本中明确处理了经纬度维度，并在展平时应用了有效格点掩码 (`valid_mask`)。使用了 `memmap` 处理大规模格点数据。
    *   **特征集大幅简化，适配格点数据特性，为后续复杂模型准备。**
    *   **基础特征**: 各产品原始降雨量 (`raw_values`)。
    *   **多产品协同 (简化)**: 仅保留当前时刻降雨产品数 (`rain_product_count`，基于 `RAIN_THR=0.1mm` 阈值)。
    *   **时序动态捕捉 (简化)**:
        *   **周期性**: 仅保留季节虚拟变量 (`season_onehot`)。
        *   **记忆性 (滞后项)**: t-1, t-2, t-3 天的原始降雨量 (`lag_X_values`)。移除了滞后均值、标准差和滞后降雨产品数。
        *   **变化率**: t 时刻与 t-1 时刻的原始值差分 (`diff_1_values`)。移除了均值和标准差的差分。
        *   **累积效应 (滑动窗口)**: 基于**各产品在滑动窗口内的均值**计算得到的 3, 7, 15 天窗口的均值、标准差、最值、范围。
    *   **空间关联 (针对格点数据真实计算)**:
        *   **5x5 邻域**: 针对每个产品，真实计算了中心格点周围 5x5 邻域的均值 (`spatial_mean_5x5`)、标准差 (`spatial_std_5x5`)、最大值 (`spatial_max_5x5`)。移除了邻域中心点差异特征。
    *   **弱信号增强 / 模糊性特征**: **全部移除**。
    *   **交互特征**: **全部移除**。

*   **V2 (`turn2.py`): 针对点位数据，在 V3 简化思路上增补关键信号**
    *   **数据处理**: 输入为流域点位数据，通过 `ALL_DATA.yangtsu()` 获取 (`(prod, time, points)`)。
    *   **特征集定位**: 较 V3 有所增补，但未引入 `sin_day`, `cos_day` (与 V4/V5/V6 不同)。
    *   **多产品协同 (增强)**: 除 `rain_product_count` 外，重新引入了当前时刻的变异系数 (`coef_of_variation`) 和产品极差 (`product_range`)。
    *   **时序动态捕捉**:
        *   **周期性**: 仅保留季节虚拟变量 (`season_onehot`)。
        *   **记忆性 (滞后项)**: t-1, t-2, t-3 天的原始降雨量 (`lag_X_values`)、产品间标准差 (`lag_X_std`) 和降雨产品数 (`lag_X_rain_count`)。
        *   **变化率**: t 时刻与 t-1 时刻的原始值差分 (`diff_1_values`)。
        *   **累积效应 (滑动窗口)**: 基于**产品均值**序列计算 3, 7, 15 天窗口的均值、标准差、最值、范围 (无特定产品滑动窗口)。
    *   **空间关联 (点位数据的名义空间特征)**:
        *   名义上的 5x5 邻域统计量 (均值 `spatial_mean_5x5`、标准差 `spatial_std_5x5`、最大值 `spatial_max_5x5`、中心点差异 `spatial_center_diff_5x5`，均为 NaN 占位符)。
        *   名义上的空间梯度特征 (GSMAP梯度 `gradient_magnitude_GSMAP`、PERSIANN梯度 `gradient_magnitude_PERSIANN`、平均梯度 `gradient_magnitude_mean`，均为 NaN 占位符)。
    *   **弱信号增强 / 模糊性特征 (增强)**:
        *   重新引入距 0.1mm 阈值距离 (`threshold_proximity`，基于产品均值)。
        *   新增 (0, 0.5mm] 区间产品比例 (`fraction_products_low_range`)。
        *   保留基于**降雨产品数量**的特定强度分箱 (`intensity_bins_count`)。
    *   **交互特征**: **无**。

*   **V3 (`turn3.py`): 特征体系简化探索 (针对点位数据)**
    *   **数据处理**: 输入为流域点位数据，通过 `ALL_DATA.yangtsu()` 获取。
    *   **核心思路**: **显著简化特征集，旨在测试核心特征的有效性。**
    *   **多产品协同 (简化)**: 仅保留当前时刻降雨产品数 (`rain_product_count`)。
    *   **时序动态捕捉 (简化)**:
        *   **周期性**: 仅保留季节虚拟变量 (`season_onehot`)。移除了年内周期正余弦编码。
        *   **记忆性 (滞后项)**: 保留 t-1, t-2, t-3 天的原始降雨量 (`lag_X_values`)、产品间标准差 (`lag_X_std`) 和降雨产品数 (`lag_X_rain_count`)。
        *   **变化率**: 仅保留 t 时刻与 t-1 时刻的原始值差分 (`diff_1_values`)。
        *   **累积效应 (滑动窗口)**: 基于**产品均值**序列计算 3, 7, 15 天窗口的均值、标准差、最值、范围。**并引入了针对特定产品（GSMAP 均值，PERSIANN 标准差）的 7 天滑动窗口统计** (`window_7_mean_GSMAP`, `window_7_std_PERSIANN`)。
    *   **空间关联 (点位数据的名义空间特征)**:
        *   名义上的 5x5 邻域统计量和空间梯度特征 (均为 NaN 占位符)。移除了 3x3 邻域特征。
    *   **弱信号增强 (大幅简化)**:
        *   仅保留基于**降雨产品数量**的特定强度分箱 (`intensity_bins_count`)。
    *   **交互特征**: **全部移除**。

*   **V4 (`turn4.py`): 特征体系深化与扩展 (针对点位数据)**
    *   **数据处理**: 输入为流域点位数据，通过 `ALL_DATA.yangtsu()` 获取。
    *   **核心思路**: **在 V6 基础上进行特征的全面深化和扩展，构建更丰富的特征集。**
    *   **多产品协同 (当前时刻, 全面)**: 包括原始值的均值 (`product_mean`)、标准差 (`product_std`)、中位数 (`product_median`)、最大值 (`product_max`)、最小值 (`product_min`)、极差 (`product_range`)，以及降雨产品数 (`rain_product_count`)。
    *   **时序动态捕捉 (全面深化)**:
        *   **周期性**: 年内周期正余弦编码 (`sin_day`, `cos_day`)，季节虚拟变量 (`season_onehot`)。
        *   **记忆性 (滞后项)**: t-1, t-2, t-3 天的原始降雨量 (`lag_X_values`)、产品间均值 (`lag_X_mean`)、标准差 (`lag_X_std`) 和降雨产品数 (`lag_X_rain_count`)。新增了滞后项之间的均值差分 (`lag_1_2_mean_diff`, `lag_2_3_mean_diff`)。
        *   **变化率**: t 时刻与 t-1 时刻的原始值差分 (`diff_1_values`)、均值差分 (`diff_1_mean`) 和标准差差分 (`diff_1_std`)。
        *   **累积效应 (滑动窗口)**: 基于**产品均值**序列计算 3, 7, 15 天窗口统计。并保留了针对特定产品（GSMAP 均值，PERSIANN 标准差）的 7 天滑动窗口统计。
    *   **空间关联 (点位数据的名义空间特征, 扩展)**:
        *   名义上的 3x3 邻域统计量 (`spatial_mean_3x3`, etc.) 和 5x5 邻域统计量 (`spatial_mean_5x5`, etc.) 及其与中心点的差异 (均为 NaN 占位符)。
        *   名义上的空间梯度特征 (GSMAP梯度, PERSIANN梯度, 平均梯度，均为 NaN 占位符)。
    *   **弱信号增强 (强化)**:
        *   距 0.1mm 阈值距离 (`threshold_proximity`)。
        *   当前及滞后一天 (t-1) 的变异系数 (`coef_of_variation`, `lag_1_coef_of_variation`)。
        *   条件不确定性 (`low_intensity_std`)。
        *   基于**产品均值** (`intensity_bins_mean`) 和**降雨产品数量** (`intensity_bins_count`) 的特定强度分箱。
    *   **交互特征 (强化)**:
        *   `product_std * sin_day` (`std_season_interaction`)。
        *   `low_intensity_std * coef_of_variation` (`low_intense_high_uncertain`)。
        *   `rain_product_count * product_std` (`rain_count_std_interaction`)。
        *   `product_std * spatial_center_diff_3x3` (`std_x_spatial_diff`, 仍为 NaN 占位符)。
        *   `product_std * diff_1_mean` (`std_x_diff_1_mean`)。

*   **V5 (`turn5.py`): 在 V3 简化基础上恢复周期特征 (针对点位数据)**
    *   **数据处理**: 输入为流域点位数据，通过 `ALL_DATA.yangtsu()` 获取。
    *   **核心思路**: **以 V3 的简化特征集为基础，主要恢复了年内周期编码。**
    *   **多产品协同**: 与 V3 一致 (仅 `rain_product_count`)。
    *   **时序动态捕捉**:
        *   **周期性**: **重新引入年内周期正余弦编码 (`sin_day`, `cos_day`)**，保留季节虚拟变量 (`season_onehot`)。
        *   **记忆性 (滞后项)**: 与 V3 一致 (`lag_X_values`, `lag_X_std`, `lag_X_rain_count`)。
        *   **变化率**: 与 V3 一致 (`diff_1_values`)。
        *   **累积效应 (滑动窗口)**: 与 V3 一致 (基于产品均值的滑动统计，以及特定产品的滑动窗口)。
    *   **空间关联 (点位数据的名义空间特征)**: 与 V3 一致 (名义 5x5 及梯度，NaN 占位符)。
    *   **弱信号增强**: 与 V3 一致 (仅 `intensity_bins_count`)。
    *   **交互特征**: **全部移除** (与 V3 一致)。

*   **V6 (`turn6.py`): 特征体系初建 (针对特定流域点位数据)**
    *   **数据处理**: 输入为特定流域（如长江）的点位数据，通过 `ALL_DATA.get_basin_point_data(basin_mask_value=2)` 获取。
    *   **核心思路**: **构建一套相对完整的、针对点位数据的基础特征体系。**
    *   **基础特征**: 各降雨产品在目标点的原始降雨量 (`raw_values`)。
    *   **多产品协同 (当前时刻)**: 原始值的均值 (`product_mean`)、标准差 (`product_std`)、中位数 (`product_median`)、最大值 (`product_max`)、最小值 (`product_min`)、极差 (`product_range`)，以及当前时刻降雨产品数 (`rain_product_count`)。
    *   **时序动态捕捉**:
        *   **周期性**: 年内周期正余弦编码 (`sin_day`, `cos_day`)，季节虚拟变量 (`season_onehot`)。
        *   **记忆性 (滞后项)**: t-1, t-2, t-3 天的原始降雨量 (`lag_X_values`)、产品间均值 (`lag_X_mean`) 和标准差 (`lag_X_std`)。
        *   **变化率**: t 时刻与 t-1 时刻的原始值差分 (`diff_1_values`)、均值差分 (`diff_1_mean`) 和标准差差分 (`diff_1_std`)。
        *   **累积效应 (滑动窗口)**: 基于各产品**均值**序列计算 3, 7, 15 天窗口的均值、标准差、最值、范围。
    *   **空间关联 (点位数据的名义空间特征)**:
        *   名义上的 3x3 邻域（由于是点位数据，实际填充为 NaN，作为结构占位符）：空间均值 (`spatial_mean`)、标准差 (`spatial_std`)、最大值 (`spatial_max`) 及其与中心点的差异 (`spatial_center_diff`)。脚本中明确指出这对于点位数据会产生 NaN。
    *   **弱信号增强**:
        *   距 0.1mm 阈值距离 (`threshold_proximity`)。
        *   变异系数 CV (`coef_of_variation`)。
        *   条件不确定性 (`low_intensity_std`，当均值<1mm时的标准差)。
        *   基于**产品均值**的特定强度分箱 (`intensity_bins`)。
    *   **交互特征**: `product_std * sin_day` (`std_season_interaction`), `low_intensity_std * coef_of_variation` (`low_intense_high_uncertain`), `rain_product_count * product_std` (`rain_count_std_interaction`)。

这一系列迭代清晰地展示了长江流域特征工程的演进：从 V1 版本探索格点数据与简化特征开始，后续版本 (V2-V6) 则聚焦于点位数据，经历了从简化测试 (V3, V5部分特征)、逐步增补关键信号 (V2, V5)，到构建全面特征体系 (V4, V6) 的不同阶段，反映了特征集在不同策略下的探索和优化过程。

构建了一个 **包含数百个潜在特征** 的大规模特征库，体现了对降雨物理机制和数据驱动模式的深度理解：

*   **基础信息**: 各降雨产品在目标点的原始降雨量。
*   **多产品协同**: 利用产品间的统计关系（均值、标准差、中位数、极差、一致降雨产品数）来 **量化不同产品的一致性与不确定性**，这是单一产品分析无法实现的。
*   **时序动态捕捉**:
    *   **周期性**: 采用正余弦函数编码年内周期、季节性虚拟变量等捕捉季节变化规律。
    *   **记忆性**: 引入 **多尺度时间滞后项** (t-1, t-2, t-3 天等) 捕捉降雨的持续性和短期依赖。
    *   **变化率**: 计算 **时间差分** 特征捕捉降雨强度的变化趋势。
    *   **累积效应**: 设计了 **多窗口滑动统计** (如 3, 7, 15 天窗口的均值、标准差、最值、范围) 以捕捉不同时间尺度下的降雨累积和波动特征。
*   **空间关联**: 引入 **3x3 邻域** 的空间统计量（均值、标准差、最大值）及其与中心点的差异，以 **刻画降雨事件的空间展布和局部梯度**。
*   **弱信号增强**: 特别设计了针对 **毛毛雨、小雨等低强度降雨** 的探测特征（如距 0.1mm 阈值距离、变异系数 CV、特定强度分箱），旨在提升模型对这类易被忽略但重要的降雨事件的敏感度。
*   **高阶交互**: 探索性地构建了 **交互特征** (如 `产品标准差 * 季节性因子`)，试图捕捉非线性、多因素耦合的复杂降雨模式。
*   **迭代优化**: 特征集经历了 **至少 6 个主要版本 (`v1` 到 `v6`) 的迭代** (具体体现在 `src/yangtze/YangTsu/turn1.py` 至 `turn6.py` 等脚本中，结果存储于 `results/yangtze/features/`)，每一版本的调整都基于前一轮的模型评估和误差分析结果，体现了 **数据驱动的特征选择和优化** 过程。

具体到长江流域的特征工程 (`src/yangtze/YangTsu/turn*.py`)，其迭代过程和主要变化如下：

*   **V1 (`turn1.py`): 重大转变 - 转向格点数据并大幅简化特征**
    *   **数据处理重大变化**: 通过 `ALL_DATA.yangtsu()` 返回的是**格点数据** (`(prod, time, lat, lon)`)。脚本中明确处理了经纬度维度，并在展平时应用了有效格点掩码 (`valid_mask`)。使用了 `memmap` 处理大规模格点数据。
    *   **特征集大幅简化，适配格点数据特性，为后续复杂模型准备。**
    *   **基础特征**: 各产品原始降雨量 (`raw_values`)。
    *   **多产品协同 (简化)**: 仅保留当前时刻降雨产品数 (`rain_product_count`，基于 `RAIN_THR=0.1mm` 阈值)。
    *   **时序动态捕捉 (简化)**:
        *   **周期性**: 仅保留季节虚拟变量 (`season_onehot`)。
        *   **记忆性 (滞后项)**: t-1, t-2, t-3 天的原始降雨量 (`lag_X_values`)。移除了滞后均值、标准差和滞后降雨产品数。
        *   **变化率**: t 时刻与 t-1 时刻的原始值差分 (`diff_1_values`)。移除了均值和标准差的差分。
        *   **累积效应 (滑动窗口)**: 基于**各产品在滑动窗口内的均值**计算得到的 3, 7, 15 天窗口的均值、标准差、最值、范围。
    *   **空间关联 (针对格点数据真实计算)**:
        *   **5x5 邻域**: 针对每个产品，真实计算了中心格点周围 5x5 邻域的均值 (`spatial_mean_5x5`)、标准差 (`spatial_std_5x5`)、最大值 (`spatial_max_5x5`)。移除了邻域中心点差异特征。
    *   **弱信号增强 / 模糊性特征**: **全部移除**。
    *   **交互特征**: **全部移除**。

*   **V2 (`turn2.py`): 针对点位数据，在 V3 简化思路上增补关键信号**
    *   **数据处理**: 输入为流域点位数据，通过 `ALL_DATA.yangtsu()` 获取 (`(prod, time, points)`)。
    *   **特征集定位**: 较 V3 有所增补，但未引入 `sin_day`, `cos_day` (与 V4/V5/V6 不同)。
    *   **多产品协同 (增强)**: 除 `rain_product_count` 外，重新引入了当前时刻的变异系数 (`coef_of_variation`) 和产品极差 (`product_range`)。
    *   **时序动态捕捉**:
        *   **周期性**: 仅保留季节虚拟变量 (`season_onehot`)。
        *   **记忆性 (滞后项)**: t-1, t-2, t-3 天的原始降雨量 (`lag_X_values`)、产品间标准差 (`lag_X_std`) 和降雨产品数 (`lag_X_rain_count`)。
        *   **变化率**: t 时刻与 t-1 时刻的原始值差分 (`diff_1_values`)。
        *   **累积效应 (滑动窗口)**: 基于**产品均值**序列计算 3, 7, 15 天窗口的均值、标准差、最值、范围 (无特定产品滑动窗口)。
    *   **空间关联 (点位数据的名义空间特征)**:
        *   名义上的 5x5 邻域统计量 (均值 `spatial_mean_5x5`、标准差 `spatial_std_5x5`、最大值 `spatial_max_5x5`、中心点差异 `spatial_center_diff_5x5`，均为 NaN 占位符)。
        *   名义上的空间梯度特征 (GSMAP梯度 `gradient_magnitude_GSMAP`、PERSIANN梯度 `gradient_magnitude_PERSIANN`、平均梯度 `gradient_magnitude_mean`，均为 NaN 占位符)。
    *   **弱信号增强 / 模糊性特征 (增强)**:
        *   重新引入距 0.1mm 阈值距离 (`threshold_proximity`，基于产品均值)。
        *   新增 (0, 0.5mm] 区间产品比例 (`fraction_products_low_range`)。
        *   保留基于**降雨产品数量**的特定强度分箱 (`intensity_bins_count`)。
    *   **交互特征**: **无**。

*   **V3 (`turn3.py`): 特征体系简化探索 (针对点位数据)**
    *   **数据处理**: 输入为流域点位数据，通过 `ALL_DATA.yangtsu()` 获取。
    *   **核心思路**: **显著简化特征集，旨在测试核心特征的有效性。**
    *   **多产品协同 (简化)**: 仅保留当前时刻降雨产品数 (`rain_product_count`)。
    *   **时序动态捕捉 (简化)**:
        *   **周期性**: 仅保留季节虚拟变量 (`season_onehot`)。移除了年内周期正余弦编码。
        *   **记忆性 (滞后项)**: 保留 t-1, t-2, t-3 天的原始降雨量 (`lag_X_values`)、产品间标准差 (`lag_X_std`) 和降雨产品数 (`lag_X_rain_count`)。
        *   **变化率**: 仅保留 t 时刻与 t-1 时刻的原始值差分 (`diff_1_values`)。
        *   **累积效应 (滑动窗口)**: 基于**产品均值**序列计算 3, 7, 15 天窗口的均值、标准差、最值、范围。**并引入了针对特定产品（GSMAP 均值，PERSIANN 标准差）的 7 天滑动窗口统计** (`window_7_mean_GSMAP`, `window_7_std_PERSIANN`)。
    *   **空间关联 (点位数据的名义空间特征)**:
        *   名义上的 5x5 邻域统计量和空间梯度特征 (均为 NaN 占位符)。移除了 3x3 邻域特征。
    *   **弱信号增强 (大幅简化)**:
        *   仅保留基于**降雨产品数量**的特定强度分箱 (`intensity_bins_count`)。
    *   **交互特征**: **全部移除**。

*   **V4 (`turn4.py`): 特征体系深化与扩展 (针对点位数据)**
    *   **数据处理**: 输入为流域点位数据，通过 `ALL_DATA.yangtsu()` 获取。
    *   **核心思路**: **在 V6 基础上进行特征的全面深化和扩展，构建更丰富的特征集。**
    *   **多产品协同 (当前时刻, 全面)**: 包括原始值的均值 (`product_mean`)、标准差 (`product_std`)、中位数 (`product_median`)、最大值 (`product_max`)、最小值 (`product_min`)、极差 (`product_range`)，以及降雨产品数 (`rain_product_count`)。
    *   **时序动态捕捉 (全面深化)**:
        *   **周期性**: 年内周期正余弦编码 (`sin_day`, `cos_day`)，季节虚拟变量 (`season_onehot`)。
        *   **记忆性 (滞后项)**: t-1, t-2, t-3 天的原始降雨量 (`lag_X_values`)、产品间均值 (`lag_X_mean`)、标准差 (`lag_X_std`) 和降雨产品数 (`lag_X_rain_count`)。新增了滞后项之间的均值差分 (`lag_1_2_mean_diff`, `lag_2_3_mean_diff`)。
        *   **变化率**: t 时刻与 t-1 时刻的原始值差分 (`diff_1_values`)、均值差分 (`diff_1_mean`) 和标准差差分 (`diff_1_std`)。
        *   **累积效应 (滑动窗口)**: 基于**产品均值**序列计算 3, 7, 15 天窗口统计。并保留了针对特定产品（GSMAP 均值，PERSIANN 标准差）的 7 天滑动窗口统计。
    *   **空间关联 (点位数据的名义空间特征, 扩展)**:
        *   名义上的 3x3 邻域统计量 (`spatial_mean_3x3`, etc.) 和 5x5 邻域统计量 (`spatial_mean_5x5`, etc.) 及其与中心点的差异 (均为 NaN 占位符)。
        *   名义上的空间梯度特征 (GSMAP梯度, PERSIANN梯度, 平均梯度，均为 NaN 占位符)。
    *   **弱信号增强 (强化)**:
        *   距 0.1mm 阈值距离 (`threshold_proximity`)。
        *   当前及滞后一天 (t-1) 的变异系数 (`coef_of_variation`, `lag_1_coef_of_variation`)。
        *   条件不确定性 (`low_intensity_std`)。
        *   基于**产品均值** (`intensity_bins_mean`) 和**降雨产品数量** (`intensity_bins_count`) 的特定强度分箱。
    *   **交互特征 (强化)**:
        *   `product_std * sin_day` (`std_season_interaction`)。
        *   `low_intensity_std * coef_of_variation` (`low_intense_high_uncertain`)。
        *   `rain_product_count * product_std` (`rain_count_std_interaction`)。
        *   `product_std * spatial_center_diff_3x3` (`std_x_spatial_diff`, 仍为 NaN 占位符)。
        *   `product_std * diff_1_mean` (`std_x_diff_1_mean`)。

*   **V5 (`turn5.py`): 在 V3 简化基础上恢复周期特征 (针对点位数据)**
    *   **数据处理**: 输入为流域点位数据，通过 `ALL_DATA.yangtsu()` 获取。
    *   **核心思路**: **以 V3 的简化特征集为基础，主要恢复了年内周期编码。**
    *   **多产品协同**: 与 V3 一致 (仅 `rain_product_count`)。
    *   **时序动态捕捉**:
        *   **周期性**: **重新引入年内周期正余弦编码 (`sin_day`, `cos_day`)**，保留季节虚拟变量 (`season_onehot`)。
        *   **记忆性 (滞后项)**: 与 V3 一致 (`lag_X_values`, `lag_X_std`, `lag_X_rain_count`)。
        *   **变化率**: 与 V3 一致 (`diff_1_values`)。
        *   **累积效应 (滑动窗口)**: 与 V3 一致 (基于产品均值的滑动统计，以及特定产品的滑动窗口)。
    *   **空间关联 (点位数据的名义空间特征)**: 与 V3 一致 (名义 5x5 及梯度，NaN 占位符)。
    *   **弱信号增强**: 与 V3 一致 (仅 `intensity_bins_count`)。
    *   **交互特征**: **全部移除** (与 V3 一致)。

*   **V6 (`turn6.py`): 特征体系初建 (针对特定流域点位数据)**
    *   **数据处理**: 输入为特定流域（如长江）的点位数据，通过 `ALL_DATA.get_basin_point_data(basin_mask_value=2)` 获取。
    *   **核心思路**: **构建一套相对完整的、针对点位数据的基础特征体系。**
    *   **基础特征**: 各降雨产品在目标点的原始降雨量 (`raw_values`)。
    *   **多产品协同 (当前时刻)**: 原始值的均值 (`product_mean`)、标准差 (`product_std`)、中位数 (`product_median`)、最大值 (`product_max`)、最小值 (`product_min`)、极差 (`product_range`)，以及当前时刻降雨产品数 (`rain_product_count`)。
    *   **时序动态捕捉**:
        *   **周期性**: 年内周期正余弦编码 (`sin_day`, `cos_day`)，季节虚拟变量 (`season_onehot`)。
        *   **记忆性 (滞后项)**: t-1, t-2, t-3 天的原始降雨量 (`lag_X_values`)、产品间均值 (`lag_X_mean`) 和标准差 (`lag_X_std`)。
        *   **变化率**: t 时刻与 t-1 时刻的原始值差分 (`diff_1_values`)、均值差分 (`diff_1_mean`) 和标准差差分 (`diff_1_std`)。
        *   **累积效应 (滑动窗口)**: 基于各产品**均值**序列计算 3, 7, 15 天窗口的均值、标准差、最值、范围。
    *   **空间关联 (点位数据的名义空间特征)**:
        *   名义上的 3x3 邻域（由于是点位数据，实际填充为 NaN，作为结构占位符）：空间均值 (`spatial_mean`)、标准差 (`spatial_std`)、最大值 (`spatial_max`) 及其与中心点的差异 (`spatial_center_diff`)。脚本中明确指出这对于点位数据会产生 NaN。
    *   **弱信号增强**:
        *   距 0.1mm 阈值距离 (`threshold_proximity`)。
        *   变异系数 CV (`coef_of_variation`)。
        *   条件不确定性 (`low_intensity_std`，当均值<1mm时的标准差)。
        *   基于**产品均值**的特定强度分箱 (`intensity_bins`)。
    *   **交互特征**: `product_std * sin_day` (`std_season_interaction`), `low_intensity_std * coef_of_variation` (`low_intense_high_uncertain`), `rain_product_count * product_std` (`rain_count_std_interaction`)。

这一系列迭代清晰地展示了长江流域特征工程的演进：从 V1 版本探索格点数据与简化特征开始，后续版本 (V2-V6) 则聚焦于点位数据，经历了从简化测试 (V3, V5部分特征)、逐步增补关键信号 (V2, V5)，到构建全面特征体系 (V4, V6) 的不同阶段，反映了特征集在不同策略下的探索和优化过程。

### 2.3 机器学习建模 (主要代码位于 `src/nationwide/project_all_for_deepling_learning/`, `src/yangtze/YangTsu/`, `src/ensemble_learning/ensemble_learning/`)

系统性地探索和评估了多种先进的机器学习模型：

*   **主力模型**:
    *   **XGBoost / LightGBM**: 作为业界领先的梯度提升树模型，重点用于追求高预测性能，并针对性地调整了目标函数和评估指标。相关脚本包括 `src/nationwide/project_all_for_deepling_learning/xgboost*.py`, `lightGBM1.py` 以及长江流域对应的 `src/yangtze/YangTsu/xgboost*.py`。
*   **辅助与对比模型**:
    *   **Naive Bayes**: 作为基准模型之一，用于快速评估特征效果。相关脚本如 `src/nationwide/project_all_for_deepling_learning/naive_bayes*.py`。
    *   **Bayesian Network**: 探索结合 **专家先验知识** 与数据驱动学习的可能性，特别用于 FP/FN 样本的分析和建模，如 `src/nationwide/project_all_for_deepling_learning/bayesian_network_fp_expert.py` 和 `src/ensemble_learning/ensemble_learning/` 中的相关脚本。
*   **自动化超参数优化**: 广泛应用 **Optuna** 框架，对 XGBoost 和 Naive Bayes 等模型的 **关键超参数** 进行了系统的优化。相关脚本如 `src/nationwide/project_all_for_deepling_learning/xgboost3_optuna.py`, `naive_bayes1_optuna.py`。
*   **性能加速**: 积极探索 **GPU 加速** 技术 (相关探索代码位于 `src/legacy/` 目录，如 `cuda_train.py`, `xgboost_cuda_training.py`)，利用 CUDA 环境优化训练过程，以应对大规模数据和复杂模型的计算挑战。
*   **集成学习探索**: 进行了集成学习的实践，包括训练基模型、FP/FN 专家模型及元学习器等步骤，具体脚本位于 `src/ensemble_learning/ensemble_learning/` 目录下 (例如 `1_generate_base_predictions.py` 至 `5_train_evaluate_meta_learner.py`)，旨在结合多个模型的优势，进一步提升预测稳定性和准确性。
*   **版本化管理**: 严格保存了 **不同版本、不同参数配置** 下训练得到的模型文件 (`.joblib`, `.pkl` 存储于 `results/.../models/`)，便于追溯和比较。

#### 2.3.1 基础模型选择与性能对比

在基础模型的选择阶段，我们首先在v1特征集上对部分候选模型进行了初步训练与评估。基于这些对比结果，XGBoost模型因其表现突出而被选为主要模型。

值得注意的是，除XGBoost和贝叶斯网络模型外，其他所有参与比较的模型均在v1特征集上进行了超参数寻优。因此，下表中展示的XGBoost性能是基于其默认参数配置的。

各模型性能对比如下：

| 模型名称                               | 准确率 (Accuracy) | 命中率 (POD) | 空报率 (FAR) | 临界成功指数 (CSI) | TP     | FN     | FP     | TN     |
|----------------------------------------|-----------------|------------|------------|-----------------|--------|--------|--------|--------|
| K-Nearest Neighbors (Tuned on Subset)  | 0.7917          | 0.7839     | 0.1308     | 0.7012          | 516971 | 142520 | 77795  | 320429 |
| Support Vector Machine (Tuned on Subset)| 0.8021          | 0.7496     | 0.0819     | 0.7026          | 494322 | 165169 | 44111  | 354113 |
| Random Forest                          | 0.8408          | 0.8378     | 0.1001     | 0.7665          | 552553 | 106938 | 61430  | 336794 |
| LightGBM                               | 0.8366          | 0.8221     | 0.0929     | 0.7582          | 542149 | 117342 | 55529  | 342695 |
| Gaussian Naive Bayes (Default)         | 0.7019          | 0.5799     | 0.0909     | 0.5481          | 382432 | 277059 | 38237  | 359987 |
| XGBoost (Default)                      | **0.8819**      | **0.8880** | **0.0819** | **0.8228**      | -      | **73133**  | **51763**  | -      |

#### 2.3.2 长江流域 XGBoost 模型性能迭代与评估实例

针对长江流域，基于不同版本的特征工程（详见 2.2 节中 V1-V6 的迭代描述），我们使用 XGBoost 作为主力分类模型进行了训练和评估。以下表格汇总了部分关键版本的模型在**测试集**上的性能表现，均采用二分类（有雨/无雨，阈值 > 0.1mm/d 判为有雨），并展示了不同预测概率阈值下的核心气象评估指标。

**1. 特征集 V1 (`turn1.py`, 模型 `xgboost1.py`):** (*此版本特征工程转向格点数据，结果代表了不同数据处理方式下的性能*)
    *   在预测概率阈值为 0.50 时：POD: 0.8410, **FAR: 0.0823**, CSI: 0.7820
    *   **不同预测阈值下的性能 (Test Set):**

        | 预测阈值 | Accuracy | POD    | FAR    | CSI    | FP    | FN     |
        |----------|----------|--------|--------|--------|-------|--------|
        | 0.30     | 0.8559   | 0.9032 | 0.1280 | 0.7975 | 87458 | 63813  |
        | 0.35     | 0.8576   | 0.8889 | 0.1149 | 0.7969 | 76109 | 73296  |
        | 0.40     | 0.8576   | 0.8738 | 0.1030 | 0.7941 | 66168 | 83234  |
        | 0.45     | 0.8558   | 0.8578 | 0.0924 | 0.7889 | 57590 | 93759  |
        | **0.50** | **0.8526** | **0.8410** | **0.0823** | **0.7820** | **49753** | **104886** |
        | 0.55     | 0.8480   | 0.8230 | 0.0731 | 0.7728 | 42821 | 116730 |
        | 0.60     | 0.8418   | 0.8037 | 0.0646 | 0.7615 | 36601 | 129435 |
        | 0.65     | 0.8343   | 0.7829 | 0.0561 | 0.7481 | 30679 | 143174 |
        | 0.70     | 0.8252   | 0.7601 | 0.0479 | 0.7321 | 25198 | 158214 |

**2. 特征集 V2 (`turn2.py`, 模型 `xgboost2.py`):**
    *   在预测概率阈值为 0.5 时：POD: 0.8322, **FAR: 0.0687**, CSI: 0.7841

    | 预测阈值 | Accuracy | POD    | FAR    | CSI    | FP    | FN     |
    |----------|----------|--------|--------|--------|-------|--------|
    | 0.45     | 0.8617   | 0.8495 | 0.0797 | 0.7913 | 48033 | 98275  |
    | **0.50** | **0.8585** | **0.8322** | **0.0687** | **0.7841** | **40072** | **109563** |
    | 0.55     | 0.8539   | 0.8140 | 0.0586 | 0.7747 | 33064 | 121487 |

**3. 特征集 V3 (`turn3.py`, 模型 `xgboost3.py`):**
    *   在预测概率阈值为 0.5 时：POD: 0.8337, **FAR: 0.0681**, CSI: 0.7859

    | 预测阈值 | Accuracy | POD    | FAR    | CSI    | FP    | FN     |
    |----------|----------|--------|--------|--------|-------|--------|
    | 0.45     | 0.8629   | 0.8506 | 0.0786 | 0.7930 | 47404 | 97565  |
    | **0.50** | **0.8597** | **0.8337** | **0.0681** | **0.7859** | **39779** | **108584** |
    | 0.55     | 0.8551   | 0.8156 | 0.0581 | 0.7765 | 32884 | 120423 |

**4. 特征集 V4 (`turn4.py`, 模型 `xgboost4.py`):**
    *   在预测概率阈值为 0.5 时：POD: 0.8520, **FAR: 0.0572**, CSI: 0.8101

    | 预测阈值 | Accuracy | POD    | FAR    | CSI    | FP    | FN     |
    |----------|----------|--------|--------|--------|-------|--------|
    | 0.45     | 0.8685   | 0.8675 | 0.0675 | 0.8171 | 41073 | 85895  |
    | **0.50** | **0.8767** | **0.8520** | **0.0572** | **0.8101** | **33775** | **96659**  |
    | 0.55     | 0.8720   | 0.8349 | 0.0482 | 0.8011 | 27602 | 107801 |

**5. 特征集 V5 (`turn5.py`, 模型 `xgboost5.py`):**
    *   在预测概率阈值为 0.5 时：POD: 0.8529, **FAR: 0.0564**, CSI: 0.8115

    | 预测阈值 | Accuracy | POD    | FAR    | CSI    | FP    | FN     |
    |----------|----------|--------|--------|--------|-------|--------|
    | 0.45     | 0.8810   | 0.8695 | 0.0667 | 0.8186 | 40579 | 85237  |
    | **0.50** | **0.8777** | **0.8529** | **0.0564** | **0.8115** | **33320** | **96033**  |
    | 0.55     | 0.8729   | 0.8357 | 0.0474 | 0.8023 | 27185 | 107285 |

**6. 特征集 V6 (基于 `turn6.py`):**

*   **默认参数模型 (`xgboost6 - 副本.py`):**
    *   在预测概率阈值为 0.5 时：
        *   Accuracy: 0.8819, POD: 0.8880, **FAR: 0.0819**, CSI: 0.8228
        *   FP: 51763, FN: 73133
    *   模型在不同阈值下的表现：

        | 预测阈值 | Accuracy | POD    | FAR    | CSI    | FP    | FN     |
        |----------|----------|--------|--------|--------|-------|--------|
        | 0.30     | 0.8685   | 0.9213 | 0.1241 | 0.8100 | 83500 | 50972  |
        | 0.35     | 0.8759   | 0.9115 | 0.1084 | 0.8184 | 70624 | 57114  |
        | 0.40     | 0.8801   | 0.9019 | 0.0956 | 0.8227 | 60500 | 63220  |
        | 0.45     | 0.8825   | 0.8920 | 0.0849 | 0.8242 | 53240 | 70103  |
        | **0.50** | **0.8819** | **0.8880** | **0.0819** | **0.8228** | **51763** | **73133**  |
        | 0.55     | 0.8806   | 0.8722 | 0.0700 | 0.8185 | 42860 | 83457  |
        | 0.60     | 0.8775   | 0.8555 | 0.0593 | 0.8117 | 35205 | 94373  |
        | 0.65     | 0.8723   | 0.8369 | 0.0496 | 0.8019 | 28511 | 106507 |
        | 0.70     | 0.8655   | 0.8164 | 0.0403 | 0.7894 | 22368 | 119904 |

    *   与原始卫星产品相比 (在测试集，概率阈值 0.5，降雨阈值 0.1mm/d)：

        | 模型/产品                    | Accuracy | POD    | FAR    | CSI    | FP      | FN      |
        |------------------------------|----------|--------|--------|--------|---------|---------|
        | XGBoost_Yangtsu (Thr 0.5)    | 0.8819   | 0.8880 | 0.0819 | 0.8228 | 51763   | 73133   |
        | Baseline_CMORPH_Yangtsu      | 0.6334   | 0.5168 | 0.1763 | 0.4654 | 361158  | 1577665 |
        | Baseline_CHIRPS_Yangtsu      | 0.5906   | 0.4413 | 0.1913 | 0.3996 | 340810  | 1824393 |
        | Baseline_SM2RAIN_Yangtsu     | 0.6930   | 0.9033 | 0.3072 | 0.6450 | 1307610 | 315866  |
        | Baseline_IMERG_Yangtsu       | 0.7145   | 0.7073 | 0.1935 | 0.6047 | 554123  | 955706  |
        | Baseline_GSMAP_Yangtsu       | 0.7353   | 0.6108 | 0.0606 | 0.5876 | 128730  | 1270999 |
        | Baseline_PERSIANN_Yangtsu    | 0.6498   | 0.6387 | 0.2437 | 0.5297 | 672194  | 1179721 |

*   **特征集 V6 + Optuna 超参数优化 + 5 折交叉验证 (`xgboost6.py` - 修改版):**
    *   **优化过程:** 使用 Optuna 在 V6 特征集的训练数据子集上进行了 50 次试验（超时时间 360000 秒，约 100 小时，实际用时约 8.7 小时），优化目标为 `auc`。
    *   **找到的最佳超参数:**
        ```python
        {
            'n_estimators': 1600,
            'learning_rate': 0.14853278798829103,
            'max_depth': 12,
            'subsample': 0.9290691945109609,
            'colsample_bytree': 0.6438409241178931,
            'gamma': 0.08754060377305081,
            'lambda': 3.197192690742817e-05,
            'alpha': 7.247084975494008e-08
        }
        ```
    *   **K-Fold 交叉验证:** 使用上述优化参数，在除去最终保持测试集后的训练数据池 (`Training/CV Pool`) 上进行了 5 折 `StratifiedKFold` 交叉验证。
        *   每折模型都进行了训练并保存。
        *   生成了覆盖整个 `Training/CV Pool` 的**折外预测概率** (`Train_L0_Probs_V6_Opt.npy`)，这是集成学习第二阶段的关键输入。
        *   K-Fold 平均 AUC 约为 0.984。
    *   **最终模型训练与评估 (在独立的 Hold-out Test Set 上):**
        *   使用优化参数，在完整的 `Training/CV Pool` 上重新训练了一个最终模型。
        *   该最终模型在独立的**保持测试集 (Hold-out Test Set)** 上的性能表现如下（降雨定义阈值 > 0.1mm/d）：

            | 预测概率阈值 | Accuracy | POD    | FAR    | CSI    | FP    | FN    |
            |--------------|----------|--------|--------|--------|-------|-------|
            | 0.40         | 0.9404   | 0.9493 | 0.0460 | 0.9077 | 29917 | 33114 |
            | 0.45         | 0.9401   | 0.9426 | 0.0404 | 0.9066 | 25949 | 37458 |
            | **0.50**     | **0.9389** | **0.9356** | **0.0357** | **0.9043** | **22618** | **42037** |
            | 0.55         | 0.9371   | 0.9282 | 0.0314 | 0.9011 | 19642 | 46911 |
            | 0.60         | 0.9348   | 0.9202 | 0.0274 | 0.8970 | 16922 | 52090 |
            | 0.65         | 0.9316   | 0.9114 | 0.0238 | 0.8916 | 14529 | 57843 |
            | 0.70         | 0.9274   | 0.9014 | 0.0207 | 0.8846 | 12414 | 64379 |

    *   **关键观察 (基于 Hold-out Test Set 结果):**
        *   经过 Optuna 超参数优化和规范的训练流程后，V6特征集训练的 XGBoost 模型在独立的保持测试集上表现出色。
        *   在预测概率阈值为 **0.5** 时，达到了 **FAR: 0.0357** 和 **CSI: 0.9043** 的优异水平。这比之前未严格划分保持测试集时的结果（FAR: 0.0399, CSI: 0.8896）有进一步提升，显示了严格评估的重要性。
        *   通过调整预测概率阈值，可以在 POD 和 FAR 之间进行权衡，例如在阈值 0.70 时，FAR 可以降低到约 **0.0207**，但 POD 也会相应下降。
    *   **Top 10 特征重要性 (来自最终模型):**
        1.  `lag_1_values_GSMAP` (0.2687)
        2.  `rain_product_count` (0.1086)
        3.  `raw_values_GSMAP` (0.0911)
        4.  `diff_1_values_GSMAP` (0.0810)
        5.  `lag_1_mean` (0.0510)
        6.  `season_onehot_2` (夏季) (0.0435)
        7.  `season_onehot_1` (春季) (0.0209)
        8.  `cos_day` (0.0116)
        9.  `sin_day` (0.0105)
        10. `lag_1_values_IMERG` (0.0089)
        *   观察可见，GSMAP 相关的特征（当前值、滞后一天值、差分值）以及多产品一致性（降雨产品数、滞后均值）和季节性特征占据了主导地位。

    *   **产出文件 (用于集成学习):**
        *   折外预测概率 (Training/CV Pool): `f:\rainfalldata\results\yangtze\features\kfold_optimization_v6\Train_L0_Probs_V6_Opt.npy`
        *   最终模型在保持测试集上的预测概率: `f:\rainfalldata\results\yangtze\features\kfold_optimization_v6\Test_L0_Probs_V6_Opt_from_final_model.npy`
        *   最终优化模型: `f:\rainfalldata\results\yangtze\features\kfold_optimization_v6\xgboost_v6_opt_final_model_on_train_cv_pool.joblib`
        *   各折模型位于 `kfold_optimization_v6` 目录下。

**总结与洞察:**

*   **特征集 V6 + Optuna 优化展现最佳性能**: 基于 `turn6.py` 的 V6 特征集，在经过 Optuna 超参数优化、规范 K-Fold 流程后，其 XGBoost 模型在独立的保持测试集上展现了当前项目中最优的综合性能。尤其在误报率 (FAR) 控制方面取得了显著成效 (例如，在预测概率阈值 0.5 时 FAR 约为 0.0357，阈值 0.7 时 FAR 可低至约 0.0207)。
*   **Optuna 优化的显著效果**: 对比特征集 V6 的默认参数模型 (在预测概率阈值 0.5 时，FAR: 0.0819, CSI: 0.8228) 与 Optuna 优化后的模型 (在预测概率阈值 0.5 时，FAR: 0.0357, CSI: 0.9043)，超参数优化能显著提升模型性能，特别是在降低 FAR 和提高 CSI 方面。
*   **关键特征与后续工作基础**: 从 V6 优化模型的特征重要性来看，GSMAP 相关的特征（当前值、滞后一天值、差分值）、多产品一致性特征（如 `rain_product_count`、`lag_1_mean`）以及季节性特征（如 `season_onehot`、`cos_day`, `sin_day`）在模型决策中起到了关键作用。此优化模型的折外预测 (`Train_L0_Probs_V6_Opt.npy`) 为后续集成学习以进一步优化 FP/FN 提供了坚实基础。
*   **特征集迭代观察**:
    *   V1 (`turn1.py`) 特征集基于格点数据，在默认参数下，预测概率阈值 0.50 时 CSI 为 0.7820，FAR 为 0.0823。
    *   V2 (`turn2.py`) 至 V5 (`turn5.py`) 特征集均基于点位数据，采用默认或预设参数进行评估，展示了不同特征简化或调整策略下的性能。例如，在预测概率阈值 0.5 时：
        *   V2: CSI 0.7841, FAR 0.0687
        *   V3: CSI 0.7859, FAR 0.0681
        *   V4: CSI 0.8101, FAR 0.0572
        *   V5: CSI 0.8115, FAR 0.0564
    *   这些结果反映了不同特征工程策略对模型性能的直接影响，并与最终 V6 版本（默认参数下 CSI 0.8228, FAR 0.0819）形成对比。
*   这些结果为后续的模型选择、特征优化方向（例如，是否继续深化格点数据特征、如何进一步优化点位数据特征集组合）以及集成学习策略的设计提供了宝贵的经验和数据支持。

// ...existing code...
### 2.4 全方位评估与诊断 (主要分析脚本位于 `src/nationwide/analysis/`, `src/nationwide/project_all_for_deepling_learning/feature_of_FP_FN.py`, `src/yangtze/YangTsu/feature_of_FP_FN_Yangtsu.py`)

建立了全面的模型评估和诊断体系，远超标准指标评估：

*   **标准指标**: Accuracy, Precision, Recall, F1-score, ROC AUC 等。
*   **气象相关指标**: 可能探索了如 Heidke Skill Score (HSS), Equitable Threat Score (ETS) 等专业评分。
*   **训练过程监控**: 可视化并分析 **训练/验证损失曲线**，判断模型拟合状态。
*   **特征重要性分析**: 利用模型内置方法（如 SHAP 值或 Gini 不纯度）量化和排序 **特征贡献度**，理解模型决策依据。
*   **特征相关性研究**: 计算并可视化 **特征间的相关系数矩阵**，识别冗余特征，并对比不同特征集 (`v1` vs `v2`) 的差异。相关脚本如 `src/nationwide/analysis/analyze_feature_sets_v1_v2.py`, `analyze_correlations_v1.py`。
*   **误差空间分布**: 绘制 **预测误差（如偏差、均方根误差）的空间分布图**，识别模型表现的地理差异和薄弱区域。
*   **误差时间演变**: 分析误差的 **季节性变化和月度趋势**。
*   **误报/漏报 (FP/FN) 深度诊断**:
    *   识别 **FP/FN 事件高发的热点区域**。
    *   **专门分析 FP/FN 样本对应的特征分布** (通过 `src/nationwide/project_all_for_deepling_learning/feature_of_FP_FN.py` 和长江流域的 `src/yangtze/YangTsu/feature_of_FP_FN_Yangtsu.py` 及 `feature_of_FP_FN_Yangtsu_Mean.py` 等脚本)，反向推断导致预测错误的关键因素，为特征工程优化提供直接依据。
*   **预测阈值敏感性分析**: 系统评估不同 **分类阈值** 对 Precision, Recall 等指标的影响，为实际应用选择最佳阈值提供依据。

## 3. 项目研发历程与关键节点 (深度剖析)

本项目从零起步，经历了从理论学习到复杂系统实现、从全国宏观到区域精细的完整研发周期，充分展现了研究者在跨学科知识融合、大规模数据处理、前沿算法应用和系统性问题解决方面的综合能力。关键节点与活动深度剖析如下：

-   **阶段一：理论奠基与技术预研 (2024年底)**
    *   **跨学科知识储备**: 面对降雨预测这一复杂交叉领域，进行了 **广泛而深入的文献调研**，系统学习了大气科学基础、卫星遥感原理、机器学习/深度学习核心算法（特别是梯度提升、时间序列分析、集成学习等），以及 Python 数据科学生态（Numpy, Pandas, Scipy, Matplotlib 等）。**目标是建立坚实的理论基础，理解问题本质**。
    *   **多源数据理解与挑战识别**: 获取部分早期数据后，投入大量时间 **解析多种卫星产品**（CMORPH, CHIRPS 等）的 **数据格式 (NetCDF, GRIB, HDF等)、投影方式、时空分辨率差异以及各自的优缺点**。识别出 **数据融合、时空对齐、缺失值处理** 等核心技术挑战。
    *   **技术可行性探索与环境搭建**: 搭建了基于 Python 的数据分析与机器学习环境。针对小规模数据子集，**编写了原型脚本** 进行数据读取 (如使用 `xarray`, `netCDF4`)、基础可视化和预处理流程的 **初步验证**，为后续大规模处理积累了宝贵经验，并验证了技术路线的可行性。

-   **阶段二：数据壁垒攻克与基线建立 (2025年1月中旬 - 2月底)**
    *   **全量数据获取与管理**: 成功获取 **覆盖多年、多源的 TB 级完整数据集**，并建立了初步的数据管理方案。
    *   **大规模并行预处理流程设计与实现**: 面对海量数据，设计并实现了 **高效的预处理流程**，关键环节包括：
        *   **地理空间处理**: 利用 `geopandas`, `rasterio` 等库，实现了从全球数据中 **精确、高效地裁剪中国区域** 数据。
        *   **时空对齐**: 开发算法将不同来源、不同分辨率的数据 **插值/重采样到统一的时空网格**，确保后续特征工程和模型输入的有效性。
        *   **智能 NaN 值处理**: 针对降雨数据特性，设计了 **结合时空插值和阈值替换的多阶段 NaN 处理策略**，最大程度保留有效信息，并将处理结果固化为标准化的 `.mat` 文件。
    *   **数据驱动的理解深化**: 对预处理后的各产品数据进行了 **统计分析和可视化对比** (如绘制偏差图、相关性图、季节分布图)，**量化了产品间的差异和一致性**，为后续特征工程和模型选择提供了关键洞见。
    *   **模型技术栈拓展**: 在掌握基础 ML 理论后，开始深入学习 **LSTM 等深度学习模型** 在处理时空序列数据方面的潜力，并调研其在气象领域的应用。
    *   **基线模型快速迭代 (2月底)**: **快速实现了** 包括 XGBoost、LSTM 及基础 MLP 在内的 **多种基线模型**，进行了初步训练和评估。**目的不仅是测试模型效果，更是为了打通整个 "数据-特征-模型-评估" 的流程**，识别瓶颈。

-   **阶段三：核心算法精通与特征体系构建 (2025年3月中旬 - 4月初)**
    *   **核心模型聚焦**: **超越库调用层面**，深入研究了 XGBoost 的 **原理（梯度提升、正则化、分裂算法等）、核心参数含义、调优技巧以及如何针对不平衡数据调整目标函数/评估指标**。
    *   **关键库能力强化**: **系统性地掌握了 scikit-learn** 的核心模块（`Pipeline`, `Preprocessing`, `Metrics`, `Model Selection` 等）和 **PyTorch** 的基础（张量操作、自动微分、模型构建），为复杂模型实现和高效实验奠定基础。
    *   **文献驱动的特征工程设计**: 结合第二阶段的数据分析结果和 **对领域文献的深入研读**，**系统性地设计了多维度特征体系** (详见 2.2 节)，**从理论层面确保了特征的科学性和有效性**。
    *   **问题形式化与基准确立**: **清晰地将任务解构** 为降雨分类和回归两个子问题，并 **严谨地选择 CHM 数据作为参照真值 (Y)**，为后续模型评估提供了统一、可靠的基准。

-   **阶段四：实验迭代、性能优化与区域聚焦 (2025年4月)**
    *   **特征工程"炼金术" - 高速迭代与验证**: 进入 **高强度实验迭代周期**，基于 **模型性能反馈和误差分析**，快速实现、测试并优化了 **至少 5 个核心版本的特征集 (`v1`->`v5.1`)**。**证明了研究者具备快速试错、数据驱动决策和高效实现复杂特征的能力**。特征维度和复杂度显著提升。
    *   **自动化超参数寻优**: 引入并 **熟练运用 Optuna** 对 XGBoost, LightGBM 等模型进行 **系统的贝叶斯超参数优化**，**显著提升了调参效率和模型性能上限**，避免了手动调参的低效和盲目性。
    *   **创新性误差修正 - FP/FN 专家集成模型**: 针对降雨分类中 **误报 (FP) 和漏报 (FN) 的不对称性及关键影响**，**创新性地设计并初步实现了基于误差分析的集成策略**：利用贝叶斯网络等模型 **专门训练识别 FP 和 FN 样本的"专家"**，旨在 **靶向性地提升分类器的 POD, FAR 等关键业务指标**，体现了在模型层面解决实际问题的能力。
    *   **空间异质性洞察与分区建模探索**: 通过误差分析敏锐地 **识别出模型性能的空间异质性**，认识到单一全局模型的局限性，**前瞻性地启动了分区建模** 的探索。
    *   **长江流域精细化研究快速启动 (4月底)**: **高效地将全国范围的分析框架和代码复用并适配到长江流域**，快速完成了区域掩码生成、数据提取、特征工程和初步建模，**展现了研究流程的模块化和可扩展性**。

-   **阶段五：系统重构与知识沉淀 (2025年5月初至今)**
    *   **工程化重构**: **投入大量精力** 对之前快速迭代过程中产生的代码和文件进行 **全面的结构化重构**，**遵循了良好的软件工程实践**，建立了清晰、模块化的项目结构，**极大地提升了代码的可读性、可维护性和未来协作的可能性**。
    *   **系统性总结与文档化**: **全面梳理和总结** 了项目的背景、方法、过程、成果、挑战与未来方向，**形成了高质量、细节丰富的 README 文档**，完成了项目知识的沉淀与展示。

## 4. 项目可持续性与未来展望

本项目已奠定坚实的基础，并展现出强大的可持续发展潜力：

1.  **代码库完善与标准化**:
    *   **【近期重点】** 完成 `src/` 目录下所有脚本的 **文件路径更新**，确保代码在新结构下无缝运行。
    *   将核心功能（特别是数据加载、特征工程、模型训练）**封装为可复用的 Python 模块或包**，提升代码质量和易用性。
    *   **完善文档**: 补充详细的 `README.md`（包括环境设置、数据说明、运行指令）、代码内注释和必要的技术文档。
2.  **区域化研究深化**:
    *   深入对比长江流域与全国范围的模型表现和关键特征差异。
    *   可 **扩展到其他重要流域或气候区**，进行模型迁移性和适应性研究。
    *   考虑引入更高分辨率的 **地形地貌数据 (DEM)** 等地理因子，增强区域模型的精度。
3.  **特征工程与模型前沿探索**:
    *   **特征**: 探索更复杂的时空特征（如 ConvLSTM 提取的时空模式）、引入大气环流因子、探索基于物理过程的特征构建。
    *   **模型**: 深入研究 **深度学习模型** (如 CNN, Transformer, ConvLSTM) 在该任务上的应用；探索 **可解释性 AI (XAI)** 技术增强模型透明度；进一步优化 **集成学习** 策略；尝试 **多任务学习** 或 **迁移学习**。
4.  **应用潜力与拓展 (详细展望)**:
    *   **构建业务化准实时预测系统**:
        *   **目标**: 将当前离线模型框架改造为能够 **接近实时** (例如，每日或每几小时更新) 处理最新卫星数据并输出预测结果的业务化系统。
        *   **技术挑战**: 解决 **数据获取延迟**、**大规模数据流处理**、**计算效率** (需要更快的特征计算和模型推理) 等工程难题。可能需要引入流处理框架 (如 Kafka, Flink) 和更高效的计算架构。
        *   **潜在应用**: 为 **短临强降雨预警**、**山洪灾害风险评估**、**城市内涝管理**、**实时农业灌溉决策** 等提供关键技术支撑，具有显著的社会经济效益。
    *   **极端降雨事件预测能力强化**:
        *   **目标**: 针对 **暴雨、持续性强降水** 等致灾性强的极端事件，显著提升模型的 **预报预警能力 (尤其是提前量和准确率)**。
        *   **技术路径**:
            *   **数据层面**: 重点分析极端事件样本，可能需要采用 **过采样/欠采样** 或 **合成数据生成 (如 SMOTE)** 技术来处理样本不平衡问题。
            *   **特征层面**: 挖掘与极端事件更相关的 **大尺度环流背景特征**、**不稳定能量指标** 等。
            *   **模型层面**: 探索 **代价敏感学习 (Cost-Sensitive Learning)**，赋予极端事件样本更高的错分代价；研究 **异常检测 (Anomaly Detection)** 算法用于识别极端信号；设计 **针对极端事件优化的损失函数**。
        *   **价值**: 直接服务于国家防灾减灾需求，减少极端天气事件带来的生命财产损失。
    *   **与下游应用模型深度耦合**:
        *   **目标**: 将本项目输出的 **高精度、高分辨率降雨预测场** 作为 **驱动数据**，输入到其他相关领域的应用模型中，提升下游模型性能。
        *   **耦合实例**:
            *   **水文模型**: 驱动 **流域水文模型** (如 SWAT, HEC-HMS)，进行更精准的 **径流模拟、洪水演进预测** 和水库调度优化。
            *   **农业模型**: 耦合 **作物生长模型** (如 DSSAT, WOFOST)，进行更准确的 **作物产量预估、病虫害风险评估** 和灌溉需水预测。
            *   **地质灾害模型**: 为 **滑坡、泥石流** 等降雨诱发型地质灾害的风险评估模型提供更可靠的降雨输入。
        *   **价值**: 打破领域壁垒，通过提供高质量的基础气象数据输入，**赋能** 其他相关领域的模型预测能力和应用水平。
    *   **不确定性量化与概率预报**:
        *   **目标**: 不仅提供确定性的降雨预测值，还要提供 **预测结果的不确定性信息**，即输出 **概率预报** (例如，未来 1 小时降雨量超过 5mm 的概率)。
        *   **技术路径**: 探索 **贝叶斯深度学习**、**模型集成 (Ensemble)** 方法（如 Monte Carlo Dropout）、**分位数回归 (Quantile Regression)** 等技术来量化模型预测的不确定性。
        *   **价值**: 为决策者提供更全面的风险信息，支持基于概率的风险管理和决策制定。
        *   **数据同化应用探索**:
            *   **目标**: 将模型的预测结果或提取的关键特征 **反馈** 到数值天气预报 (NWP) 模型或数据同化系统中，**改进 NWP 模式的初始场或物理过程参数化方案**，形成双向促进。
            *   **技术路径**: 需要深入理解数据同化理论（如集合卡尔曼滤波 EnKF, 3DVar/4DVar），研究如何将机器学习输出有效融入同化框架。
            *   **价值**: 探索机器学习与传统数值预报结合的新范式，有望从更根本的层面提升天气预报能力。
5.  **工程实践**:
    *   **引入 Git 进行版本控制**: 强烈建议立即实施，规范管理代码和实验历史。
    *   **构建自动化流水线 (Pipeline)**: 利用 Airflow, Kubeflow 等工具实现数据处理、特征工程、模型训练、评估的自动化流程。

**结论:** 本项目在多源降雨数据融合、大规模特征工程、机器学习建模与深度诊断方面开展了系统性的研究和实践，取得了丰富的阶段性成果，并已构建了一个可持续发展、潜力巨大的研究框架。项目展现了研究者在处理复杂气象数据、应用先进机器学习技术以及系统性解决科学问题方面的综合能力。

## 5. 项目目录结构说明

本项目采用以下目录结构进行组织和管理：

*   **`.git/`**: Git 版本控制系统目录，包含所有版本历史和分支信息。
*   **`data/`**: 存放项目所需的所有数据。
    *   `raw/`: 存储从原始数据源下载的未处理数据，如 CMORPH, CHIRPS, GSMAP, IMERG, PERSIANN, SM2RAIN, CHM 等产品的 `.nc`, `.zip` 文件。
    *   `intermediate/`: 存储经过完整预处理流程（如 NaN 值填充、时空对齐、掩码应用）后，可直接用于模型输入的最终数据每一年或者连续5年的数据。主要用于训练或者特征工程处理的适合从这里加载，这里的数据就经过空间对齐操作的中国地区0.25分辨率144*256矩阵的数据，只有在中国mask区域上的点有值不在中国区域mask上的点为nan。文件为：
        ```
        CMORPHdata/
            -a----          1/3/2025  10:53 pm       53969088 CMORPH_2016.mat
            -a----          5/3/2025   5:18 pm      269402304 CMORPH_2016_2020.mat
            -a----          1/3/2025  10:53 pm       53821632 CMORPH_2017.mat
            -a----          1/3/2025  10:53 pm       53821632 CMORPH_2018.mat
            -a----          1/3/2025  10:53 pm       53821632 CMORPH_2019.mat
            -a----          1/3/2025  10:53 pm       53969088 CMORPH_2020.mat
        CHIRPSdata/
            -a----          2/3/2025  11:19 am      107937984 chirps_2016.mat
            -a----          5/3/2025   4:30 pm      538804416 chirps_2016_2020.mat
            -a----          2/3/2025  11:19 am      107643072 chirps_2017.mat
            -a----          2/3/2025  11:19 am      107643072 chirps_2018.mat
            -a----          2/3/2025  11:19 am      107643072 chirps_2019.mat
            -a----          2/3/2025  11:20 am      107937984 chirps_2020.mat
        CHMdata/
            -a----          4/3/2025   8:44 pm      107937984 CHM_2016.mat
            -a----          4/3/2025   8:54 pm      538804416 CHM_2016_2020.mat
            -a----          4/3/2025   8:47 pm      107643072 CHM_2017.mat
            -a----          4/3/2025   8:49 pm      107643072 CHM_2018.mat
            -a----          4/3/2025   8:51 pm      107643072 CHM_2019.mat
            -a----          4/3/2025   8:53 pm      107937984 CHM_2020.mat
        IMERGdata/
            -a----          4/3/2025   9:04 pm      107937984 IMERG_2016.mat
            -a----          4/3/2025   9:16 pm      538804416 IMERG_2016_2020.mat
            -a----          4/3/2025   9:07 pm      107643072 IMERG_2017.mat
            -a----          4/3/2025   9:10 pm      107643072 IMERG_2018.mat
            -a----          4/3/2025   9:13 pm      107643072 IMERG_2019.mat
            -a----          4/3/2025   9:16 pm      107937984 IMERG_2020.mat
        sm2raindata/
            -a----          2/3/2025  10:44 am      107937984 sm2rain_2016.mat
            -a----          5/3/2025   5:18 pm      538804416 sm2rain_2016_2020.mat
            -a----          5/3/2025   5:12 pm      538804416 sm2rain_2016_2020processed.mat
            -a----          2/3/2025  10:46 am      107643072 sm2rain_2017.mat
            -a----          2/3/2025  10:49 am      107643072 sm2rain_2018.mat
            -a----          2/3/2025  10:52 am      107643072 sm2rain_2019.mat
            -a----          2/3/2025  10:54 am      107937984 sm2rain_2020.mat
        PERSIANNdata/
            -a----          1/3/2025  10:14 pm       53969088 PERSIANN_2016.mat
            -a----          1/3/2025  10:15 pm      269402304 PERSIANN_2016_2020.mat
            -a----          1/3/2025  10:14 pm       53821632 PERSIANN_2017.mat
            -a----          1/3/2025  10:14 pm       53821632 PERSIANN_2018.mat
            -a----          1/3/2025  10:15 pm       53821632 PERSIANN_2019.mat
            -a----          1/3/2025  10:15 pm       53969088 PERSIANN_2020.mat
        GSMAPdata/
            -a----          2/3/2025   8:47 pm      107937984 GSMAP_2016.mat
            -a----          2/3/2025   8:57 pm      538804416 GSMAP_2016_2020.mat
            -a----          2/3/2025   8:50 pm      107643072 GSMAP_2017.mat
            -a----          2/3/2025   8:52 pm      107643072 GSMAP_2018.mat
            -a----          2/3/2025   8:55 pm      107643072 GSMAP_2019.mat
            -a----          2/3/2025   8:57 pm      107937984 GSMAP_2020.mat
        ```
    *   `processed/`: 初步数据处理尝试生成的文件，基本已经弃用。
    *   `mask/` : 储存从全球数据中选取出中国区域以及从中国区域中选出长江流域的掩码矩阵，为`.mat`文件，数据键值为`"data"`，大小为144*256大小矩阵。目前矩阵中有三类值(0, 1, 2)：大于等于1的值掩码出中国版图，大于等于2的值掩码出长江流域。
*   **`docs/`**: 存放项目相关的各类文档。
    *   `functions_reference.md`: 项目中重要函数的参考说明。
    *   `降雨预测模型优化方法_.pdf`: 关于模型优化的详细 PDF 文档。
    *   (可能包含其他设计文档、研究报告等)
*   **`logs/`**: 存放项目运行过程中产生的日志文件。
    *   `feature_names_v5_1.txt`, `feature_names_v5.txt`, `feature_names_v4.txt`, `feature_names_v3.txt`, `feature_names_v2.txt`, `feature_names.txt`: 不同版本特征工程所使用的特征列表。
    *   `training_log.txt`: 主要模型训练过程的详细日志。
    *   `continued_training_log.txt`: 继续训练过程的日志 (当前为空)。
    *   `fine_tuned_train_log.txt`: 微调训练过程的日志 (当前为空)。
    *   `fine_tuning_log.txt`: 微调过程的日志 (当前为空)。
    *   `distributed_training_log.txt`: 分布式训练过程的日志 (当前为空)。
*   **`models/`**: 存放训练完成的机器学习模型文件及相关产出。
    *   `xgboost_model_YYYYMMDD_HHMMSS.json` (例如 `xgboost_model_20250405_234933.json`): XGBoost 模型保存文件，通常以时间戳命名。
    *   `xgboost_foldX_YYYYMMDD_HHMMSS.json`: 交叉验证中特定折数的 XGBoost 模型。
    *   `xgboost_3days_pca_YYYYMMDD_HHMMSS.json`: 经过 PCA 处理的特征训练的 XGBoost 模型。
    *   `best_model.pth`, `best_weights.pth`, `best_rainfall_model.pth`, `best_rainfall_model_cuda.pth`: PyTorch 格式保存的模型文件或权重。
    *   `prediction_results.csv`: 模型在测试集上的详细预测结果。
    *   `prediction_scatter.png`: 预测值与真实值的散点图。
    *   `training_history.csv`: 模型训练过程中的指标记录。
    *   `training_visualization.png`, `cuda_training_metrics.png`: 训练过程指标的可视化图表。
    *   `training_report.txt`: 简要的训练报告。
    *   `cuda_training_history.npz`, `cuda_metrics_history.csv`: 使用 CUDA 训练时的历史和指标记录。
    *   `continued/`: 存放继续训练得到的模型及报告。
        *   `best_weights.pth`, `best_model.pth`: 继续训练后的模型。
        *   `training_report.txt`: 继续训练的报告。
    *   `fine_tuned/`: (预期存放) 微调训练得到的模型 (当前为空)。
*   **`notebooks/`**: 存放用于探索性数据分析、原型验证、可视化等的 Jupyter Notebooks 或相关学习材料。
    *   `book.md`, `book.pdf`: 可能为项目方法论或背景知识的文档。
    *   `ml_tutorial.md`, `ml_tutorial.pdf`: 机器学习相关的教程材料。
    *   `wordpress.md`, `wordpress.pdf`: 与 Wordpress 相关的文档或教程 (具体关联需确认)。
*   **`results/`**: 存放模型训练、评估和分析产生的结果文件 (此目录下的 `models/` 子目录与顶层 `models/` 目录可能存在分工或历史版本)。
    *   `features/`: 存储不同版本迭代生成的特征集文件。
    *   `models/`: 存储训练好的模型文件（`.joblib`, `.pkl` 等）。
    *   `plots/`: 存储评估过程中生成的各类图表，如特征重要性图、误差分布图、损失曲线等。
    *   `predictions`: 储存模型的预测值
*   **`scripts/`**: 存放一些辅助性的脚本。
    *   `utils/`: 通用工具脚本。
        *   `safe_handlers.py`: 可能包含处理文件或数据时的安全操作函数。已废弃停用。
        *   `encoding_fix.py`: 用于修正或处理不同文件编码问题的脚本。已废弃停用
        *   `torch_safe_load.py`: 安全加载 PyTorch 模型或数据的工具。已废弃停用
        *   `safe_unicode.py`: 处理 Unicode 编码安全的工具。已废弃停用
        *   `memory_utils.py`: 内存管理相关的辅助函数 (当前为空)。已废弃停用
        *   `font_helper.py`: 字体处理相关的辅助脚本，可能用于绘图。已废弃停用
        *   `visualization_helper.py`: 可视化相关的辅助函数。已废弃停用
        *   `gpu_utils.py`: GPU 使用相关的辅助函数，如设备选择、内存监控等。已废弃停用
        *   `scale_utils.py`: 数据缩放或尺度转换相关的工具。在从原始数据中进行空间对齐操作中使用,因为原始6个产品的空间分辨率不一致，部分是0.1°部分为0.25°, 本工具将对全部数据空间对齐至0.25°以便于后续的数据分析处理以及训练
    *   `mask_creation`: 创建地理掩码的脚本。
    *   `ReadGsmapG01d25y0820.m`: 读取特定格式 GSMAP 数据的 MATLAB 脚本。
*   **`src/`**: 核心源代码目录。
    *   `common/`: 通用模块。
        *   `feature_engineering/`: (预期存放) 通用的特征工程函数和类 (当前为空)。
    *   `ensemble_learning/`: 集成学习相关代码,目前停止维护，特征工程尚未完善
        *   `ensemble_learning/`: 具体的集成学习流程脚本。
            *   `1_generate_base_predictions.py`: 生成基础模型的预测结果。
            *   `2_train_fn_expert.py`: 训练专门识别漏报 (FN) 的专家模型, level1, 使用基础模型的预测结果以及预测结果中对于漏报事件的索引标签为特征训练的模型, 并未学习到原有基础模型中对于漏报事件
            *   `3_train_fp_expert.py`: 训练专门识别误报 (FP) 的专家模型, level1, 使用基础模型的预测结果以及预测结果中的误报事件的索引标签为特征训练的模型, 并未学习到原有基础模型中的误报事件。
            *   `4_generate_meta_features.py`: 基于基础模型预测和专家模型输出来生成元特征。
            *   `5_train_evaluate_meta_learner.py`: 训练并评估元学习器 (stacking 模型)。
            *   `6_finetune_base_model.py`: 对基础模型进行微调的脚本。
            *   `evaluate_fp_expert_on_tp.py`: 评估 FP 专家模型在 TP 样本上的表现。
            *   `debug_predict_test.py`: 用于调试预测过程的测试脚本。
    *   `legacy/`: 存放旧的、废弃的或实验性和学习的代码。
        *   `lstm_train.py`, `lstm_train - 副本.py`: 早期的 LSTM 模型训练尝试。
        *   `cuda_train.py`, `xgboost_cuda_training.py`, `cuda_profiler.py`, `checkcuda.py`: CUDA/GPU 加速相关的训练、性能分析和检查脚本。
        *   `gpu_memory_config.py`, `memory_optimization.py`: GPU 内存配置和优化脚本。
        *   `knntrain.py`, `xgboost_rf_knn.py`: KNN 及其他模型的早期实验脚本。
        *   (其他众多脚本为不同时期、不同参数或优化尝试的 XGBoost 训练及数据处理脚本的遗留版本)
    *   `nationwide/`: 全国范围的降雨预测研究代码。
        *   `project_all_for_deepling_learning/`: 核心处理流程和实验脚本。
            *   `loaddata.py`: 加载全国范围的预处理数据以供模型使用，从data/intermediate/下面的数据读取中国区域空间对齐操作后的数据
            *   `turn1.py` 至 `turn5_1.py`: 代表特征工程 v1 到 v5.1 版本迭代的脚本，逐步构建和优化特征集。
            *   `xgboost1.py` 至 `xgboost5_1.py` (及 `xgboost3_optuna.py`): 不同版本或配置的 XGBoost 模型训练脚本，`xgboost3_optuna.py` 使用 Optuna 进行超参数优化。
            *   `lightGBM1.py`: LightGBM 模型训练脚本。
            *   `naive_bayes1.py`, `naive_bayes1_optuna.py`: Naive Bayes 模型训练脚本，后者使用 Optuna 进行优化。
            *   `bayesian_network_fp_expert.py`: 使用贝叶斯网络构建 FP (误报) 专家模型的脚本。
            *   `feature_of_FP_FN.py`: 深入分析导致误报 (FP) 和漏报 (FN) 样本的特征分布的脚本。
            *   `sklearn_pipeline_eval.py`: 使用 scikit-learn Pipeline 进行模型评估的脚本。
            *   `get_fronts.py`: 修复当前系统字体问题的脚本
            *   (大量 `.png` 文件): 模型评估、特征分析等的可视化结果。
        *   `analysis/`: 针对全国范围研究的分析脚本。
            *   `analyze_feature_sets_v1_v2.py`: 对比分析 v1 和 v2 版本特征集的脚本。
            *   `analyze_correlations_v1.py`, `analyze_correlations_v2.py`: 分析 v1 和 v2 特征集内部特征相关性的脚本, 使用的是统计特征分析。
            *   `analyze_pca.py`: 进行主成分分析 (PCA) 的脚本。
    *   `readdata/`: 各类降雨原始数据的读取和初步解析脚本。
        *   `CHM.py`: 从原始数据中读取和处理出中国mask区域 CHM 地面观测融合数据的脚本。
        *   `sm2rain.py`: 从原始数据中读取和处理出中国mask区域 SM2RAIN 卫星降雨产品的脚本。
        *   `PERSIANN.py`: 从原始数据中读取和处理出中国mask区域 PERSIANN 卫星降雨产品的脚本。
        *   `gsmap.py`: 从原始数据中读取和处理出中国mask区域 GSMAP 卫星降雨产品的脚本。
        *   `CMORPH.py`: 从原始数据中读取和处理出中国mask区域 CMORPH 卫星降雨产品的脚本。
        *   `IMERG.py`: 从原始数据中读取和处理出中国mask区域 IMERG 卫星降雨产品的脚本。
        *   `chirps.py`: 从原始数据中读取和处理出中国mask区域 CHIRPS 卫星降雨产品的脚本。
        *   `datafix.py`: 处理空间对齐之后的数据进行修复, 主要进行nan值得处理, 原始产品数据中存在缺失值, 个别产品存在大片区域值得缺失, 本修复函数进行智能插值替换nan值, 能插值尽量插值, 不能插值就用IMERG的值进行替换。
        *   `scale_utils.py`: 数据缩放或尺度转换相关的工具。在从原始数据中进行空间对齐操作中使用,因为原始6个产品的空间分辨率不一致，部分是0.1°部分为0.25°, 本工具将对全部数据空间对齐至0.25°以便于后续的数据分析处理以及训练。
    *   `yangtze/`: 长江流域的降雨预测研究代码。
        *   `YangTsu/` (实际应为 `Yangtze`): 长江流域核心处理流程，脚本结构和功能与 `nationwide/project_all_for_deepling_learning/` 类似, 这下面的代码为后续和核心工作区域。
            *   `loaddata.py`: 加载长江流域的预处理数据。从data/intermediate/下面的数据读取中国区域空间对齐操作后的数据
            *   `turn1.py` 至 `turn5_1.py`: 针对长江流域的特征工程 v1 到 v5.1 版本迭代脚本。
            *   `xgboost1.py` 至 `xgboost5_1.py`: 针对长江流域的 XGBoost 模型训练脚本。
            *   `feature_of_FP_FN_Yangtsu.py`, `feature_of_FP_FN_Yangtsu_Mean.py`: 专门分析长江流域 FP/FN 样本特征的脚本。
            *   `product_pod_far.py`: 计算长江流域各降雨产品 POD/FAR 等指标的脚本。
        *   `analysis/`: (预期存放) 针对长江流域的特定分析脚本 (当前为空)。
*   **`tests/`**: 存放单元测试、集成测试等相关代码 (当前为空)。
*   **`.gitignore`**: Git 配置文件，指定哪些文件或目录不纳入版本控制。
*   **`README.md`**: 项目的入口文档，提供项目概述、技术架构、研究历程、未来展望和本目录结构说明。

## 6. 长江流域多源降雨产品性能评估 (基于不同分类阈值)

以下表格展示了长江流域几种主要降雨产品 (CMORPH, CHIRPS, GSMAP, IMERG, PERSIANN, SM2RAIN) 在不同降雨量分类阈值下的关键性能指标：命中率 (POD - Probability of Detection)、空报率 (FAR - False Alarm Ratio) 和临界成功指数 (CSI - Critical Success Index)。这些指标基于 TP (命中数), FP (空报数), FN (漏报数), TN (正确负例数) 计算得出。

#### 表1: 各产品在不同阈值下的 POD (命中率)

| 阈值   | CMORPH | CHIRPS | GSMAP  | IMERG  | PERSIANN | SM2RAIN |
|------|--------|--------|--------|--------|----------|---------|
| 0.00 | 0.4919 | 0.4113 | 0.5557 | 0.7515 | 0.6004   | 0.9153  |
| 0.05 | 0.5243 | 0.4280 | 0.5887 | 0.7227 | 0.6235   | 0.9074  |
| 0.10 | 0.5460 | 0.4383 | 0.6085 | 0.7053 | 0.6368   | 0.9030  |
| 0.15 | 0.5281 | 0.4441 | 0.6216 | 0.6933 | 0.6449   | 0.8973  |
| 0.20 | 0.5401 | 0.4470 | 0.6317 | 0.6841 | 0.6507   | 0.8946  |
| 0.25 | 0.5285 | 0.4487 | 0.6403 | 0.6767 | 0.6552   | 0.8914  |
| 0.30 | 0.5372 | 0.4497 | 0.6471 | 0.6700 | 0.6584   | 0.8894  |
| 0.35 | 0.5256 | 0.4509 | 0.6533 | 0.6645 | 0.6606   | 0.8870  |
| 0.40 | 0.5327 | 0.4517 | 0.6585 | 0.6593 | 0.6617   | 0.8852  |
| 0.45 | 0.5231 | 0.4522 | 0.6630 | 0.6548 | 0.6619   | 0.8831  |
| 0.50 | 0.5148 | 0.4525 | 0.6669 | 0.6506 | 0.6612   | 0.8809  |
| 0.55 | 0.5204 | 0.4528 | 0.6704 | 0.6466 | 0.6598   | 0.8793  |
| 0.60 | 0.5258 | 0.4530 | 0.6735 | 0.6429 | 0.6580   | 0.8776  |
| 0.65 | 0.5166 | 0.4532 | 0.6764 | 0.6394 | 0.6559   | 0.8758  |
| 0.70 | 0.5109 | 0.4534 | 0.6790 | 0.6361 | 0.6538   | 0.8739  |
| 0.75 | 0.5156 | 0.4536 | 0.6813 | 0.6329 | 0.6515   | 0.8724  |
| 0.80 | 0.5199 | 0.4537 | 0.6833 | 0.6300 | 0.6491   | 0.8710  |
| 0.85 | 0.5122 | 0.4538 | 0.6853 | 0.6273 | 0.6466   | 0.8691  |
| 0.90 | 0.5162 | 0.4538 | 0.6870 | 0.6245 | 0.6441   | 0.8674  |
| 0.95 | 0.5109 | 0.4539 | 0.6885 | 0.6218 | 0.6416   | 0.8659  |

#### 表2: 各产品在不同阈值下的 FAR (空报率)

| 阈值   | CMORPH | CHIRPS | GSMAP  | IMERG  | PERSIANN | SM2RAIN |
|------|--------|--------|--------|--------|----------|---------|
| 0.00 | 0.1173 | 0.1246 | 0.0250 | 0.1425 | 0.1602   | 0.2076  |
| 0.05 | 0.1607 | 0.1672 | 0.0454 | 0.1766 | 0.2145   | 0.2716  |
| 0.10 | 0.1905 | 0.1935 | 0.0613 | 0.1947 | 0.2467   | 0.3088  |
| 0.15 | 0.1977 | 0.2105 | 0.0734 | 0.2061 | 0.2676   | 0.3316  |
| 0.20 | 0.2144 | 0.2240 | 0.0837 | 0.2145 | 0.2831   | 0.3494  |
| 0.25 | 0.2187 | 0.2352 | 0.0931 | 0.2215 | 0.2960   | 0.3631  |
| 0.30 | 0.2311 | 0.2452 | 0.1014 | 0.2273 | 0.3067   | 0.3747  |
| 0.35 | 0.2332 | 0.2543 | 0.1091 | 0.2326 | 0.3165   | 0.3845  |
| 0.40 | 0.2435 | 0.2625 | 0.1162 | 0.2374 | 0.3249   | 0.3932  |
| 0.45 | 0.2449 | 0.2703 | 0.1231 | 0.2419 | 0.3327   | 0.4006  |
| 0.50 | 0.2464 | 0.2774 | 0.1296 | 0.2462 | 0.3397   | 0.4071  |
| 0.55 | 0.2546 | 0.2841 | 0.1357 | 0.2501 | 0.3460   | 0.4132  |
| 0.60 | 0.2625 | 0.2905 | 0.1416 | 0.2540 | 0.3519   | 0.4188  |
| 0.65 | 0.2628 | 0.2967 | 0.1472 | 0.2576 | 0.3574   | 0.4235  |
| 0.70 | 0.2646 | 0.3028 | 0.1528 | 0.2613 | 0.3627   | 0.4280  |
| 0.75 | 0.2714 | 0.3083 | 0.1580 | 0.2648 | 0.3675   | 0.4322  |
| 0.80 | 0.2779 | 0.3136 | 0.1630 | 0.2681 | 0.3719   | 0.4361  |
| 0.85 | 0.2778 | 0.3189 | 0.1678 | 0.2712 | 0.3763   | 0.4394  |
| 0.90 | 0.2842 | 0.3241 | 0.1726 | 0.2746 | 0.3805   | 0.4426  |
| 0.95 | 0.2856 | 0.3290 | 0.1773 | 0.2777 | 0.3845   | 0.4457  |

#### 表3: 各产品在不同阈值下的 CSI (临界成功指数)

| 阈值   | CMORPH | CHIRPS | GSMAP  | IMERG  | PERSIANN | SM2RAIN |
|------|--------|--------|--------|--------|----------|---------|
| 0.00 | 0.4617 | 0.3885 | 0.5479 | 0.6681 | 0.5387   | 0.7382  |
| 0.05 | 0.4765 | 0.3941 | 0.5727 | 0.6257 | 0.5328   | 0.6780  |
| 0.10 | 0.4838 | 0.3966 | 0.5852 | 0.6025 | 0.5269   | 0.6434  |
| 0.15 | 0.4673 | 0.3971 | 0.5924 | 0.5875 | 0.5219   | 0.6208  |
| 0.20 | 0.4707 | 0.3960 | 0.5973 | 0.5764 | 0.5176   | 0.6043  |
| 0.25 | 0.4604 | 0.3943 | 0.6008 | 0.5674 | 0.5137   | 0.5910  |
| 0.30 | 0.4625 | 0.3924 | 0.6031 | 0.5597 | 0.5099   | 0.5802  |
| 0.35 | 0.4532 | 0.3908 | 0.6049 | 0.5531 | 0.5058   | 0.5708  |
| 0.40 | 0.4548 | 0.3892 | 0.6061 | 0.5470 | 0.5019   | 0.5625  |
| 0.45 | 0.4472 | 0.3873 | 0.6065 | 0.5416 | 0.4976   | 0.5553  |
| 0.50 | 0.4406 | 0.3856 | 0.6067 | 0.5366 | 0.4934   | 0.5489  |
| 0.55 | 0.4419 | 0.3839 | 0.6065 | 0.5319 | 0.4891   | 0.5431  |
| 0.60 | 0.4429 | 0.3821 | 0.6062 | 0.5274 | 0.4848   | 0.5376  |
| 0.65 | 0.4363 | 0.3804 | 0.6057 | 0.5233 | 0.4806   | 0.5329  |
| 0.70 | 0.4316 | 0.3788 | 0.6049 | 0.5192 | 0.4765   | 0.5284  |
| 0.75 | 0.4325 | 0.3773 | 0.6040 | 0.5154 | 0.4726   | 0.5242  |
| 0.80 | 0.4332 | 0.3758 | 0.6031 | 0.5119 | 0.4689   | 0.5204  |
| 0.85 | 0.4279 | 0.3743 | 0.6021 | 0.5086 | 0.4652   | 0.5170  |
| 0.90 | 0.4284 | 0.3727 | 0.6009 | 0.5051 | 0.4615   | 0.5137  |
| 0.95 | 0.4243 | 0.3713 | 0.5995 | 0.5019 | 0.4580   | 0.5105  |

## 7. 长江流域各降雨产品基本统计特征

以下数据基于长江流域范围（掩码值为2的区域），时间跨度为2016-2020年。

| 指标                                   | CMORPH                 | CHIRPS                 | SM2RAIN                | IMERG                  | GSMAP                  | PERSIANN               |
|----------------------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|
| 平均值                                 | 3.3629                 | 3.5047                 | 3.9431                 | 3.5663                 | 3.2589                 | 3.5872                 |
| 标准差                                 | 9.9921                 | 9.8690                 | 5.4609                 | 9.7228                 | 7.9307                 | 8.1056                 |
| 最大值                                 | 379.8000               | 330.5150               | 228.4960               | 357.1993               | 280.7053               | 230.6858               |
| 最小值                                 | 0.0000                 | 0.0000                 | 0.0000                 | 0.0000                 | 0.0000                 | 0.0000                 |
| 中位数                                 | 0.0000                 | 0.0000                 | 1.9240                 | 0.1765                 | 0.0000                 | 0.2830                 |
| 众数 (count)                           | 0.0000 (3103372)       | 0.0000 (3453450)       | 0.0000 (709395)        | 0.0000 (1825289)       | 0.0000 (3052396)       | 0.0000 (2472006)       |
| 方差                                   | 99.8425                | 97.3975                | 29.8218                | 94.5334                | 62.8952                | 65.7014                |
| 偏度 (Skewness)                        | 6.1082                 | 5.5473                 | 3.0639                 | 5.9726                 | 4.9681                 | 4.7259                 |
| 峰度 (Kurtosis)                        | 57.8855                | 50.6663                | 21.6656                | 55.5745                | 40.8976                | 34.8649                |
| 和地面观测站(CHM)之间的相关系数        | 0.4456                 | 0.3900                 | 0.5695                 | 0.5014                 | 0.6454                 | 0.4133                 |
| 和 CMORPH 之间的相关系数               | 1.0000 (self-correlation) | 0.6147                 | 0.5000                 | 0.8259                 | 0.6593                 | 0.6752                 |
| 和 CHIRPS 之间的相关系数               | 0.6147                 | 1.0000 (self-correlation) | 0.4278                 | 0.6541                 | 0.5802                 | 0.7533                 |
| 和 SM2RAIN 之间的相关系数              | 0.5000                 | 0.4278                 | 1.0000 (self-correlation) | 0.5359                 | 0.6233                 | 0.4636                 |
| 和 IMERG 之间的相关系数                | 0.8259                 | 0.6541                 | 0.5359                 | 1.0000 (self-correlation) | 0.7261                 | 0.7134                 |
| 和 GSMAP 之间的相关系数                | 0.6593                 | 0.5802                 | 0.6233                 | 0.7261                 | 1.0000 (self-correlation) | 0.5920                 |
| 和 PERSIANN 之间的相关系数             | 0.6752                 | 0.7533                 | 0.4636                 | 0.7134                 | 0.5920                 | 1.0000 (self-correlation) |

// ... existing code ...
| 和 PERSIANN 之间的相关系数         | 0.6551                 | 0.7431                 | 0.5092                 | 0.7137                 | 0.5990                 | 1.0000 (self-correlation) |

## 8. 全国范围各降雨产品性能评估 (基于不同分类阈值)

以下表格展示了全国范围几种主要降雨产品 (CMORPH, CHIRPS, GSMAP, IMERG, PERSIANN, SM2RAIN) 在不同降雨量分类阈值下的关键性能指标：命中率 (POD - Probability of Detection)、空报率 (FAR - False Alarm Ratio) 和临界成功指数 (CSI - Critical Success Index)。这些指标基于 TP (命中数), FP (空报数), FN (漏报数), TN (正确负例数) 计算得出，并以 CHM 产品作为地面真值。

#### 表4: 全国范围各产品在不同阈值下的 POD (命中率)

| 阈值   | CMORPH | CHIRPS | GSMAP  | IMERG  | PERSIANN | SM2RAIN |
|------|--------|--------|--------|--------|----------|---------|
| 0.00 | 0.4474 | 0.3849 | 0.4636 | 0.7002 | 0.6594   | 0.7931  |
| 0.05 | 0.4871 | 0.3995 | 0.5097 | 0.6694 | 0.6740   | 0.7845  |
| 0.10 | 0.5124 | 0.4079 | 0.5366 | 0.6532 | 0.6787   | 0.7780  |
| 0.15 | 0.4917 | 0.4125 | 0.5539 | 0.6424 | 0.6798   | 0.7693  |
| 0.20 | 0.5052 | 0.4148 | 0.5670 | 0.6344 | 0.6793   | 0.7665  |
| 0.25 | 0.4925 | 0.4162 | 0.5776 | 0.6278 | 0.6781   | 0.7630  |
| 0.30 | 0.5021 | 0.4170 | 0.5861 | 0.6221 | 0.6762   | 0.7616  |
| 0.35 | 0.4896 | 0.4179 | 0.5936 | 0.6173 | 0.6738   | 0.7595  |
| 0.40 | 0.4973 | 0.4185 | 0.5999 | 0.6128 | 0.6708   | 0.7585  |
| 0.45 | 0.4869 | 0.4189 | 0.6055 | 0.6089 | 0.6674   | 0.7569  |
| 0.50 | 0.4780 | 0.4191 | 0.6103 | 0.6052 | 0.6636   | 0.7554  |
| 0.55 | 0.4840 | 0.4193 | 0.6146 | 0.6017 | 0.6595   | 0.7547  |
| 0.60 | 0.4897 | 0.4195 | 0.6185 | 0.5985 | 0.6553   | 0.7541  |
| 0.65 | 0.4803 | 0.4197 | 0.6221 | 0.5955 | 0.6512   | 0.7529  |
| 0.70 | 0.4743 | 0.4199 | 0.6254 | 0.5927 | 0.6472   | 0.7518  |
| 0.75 | 0.4792 | 0.4201 | 0.6283 | 0.5900 | 0.6432   | 0.7513  |
| 0.80 | 0.4838 | 0.4201 | 0.6309 | 0.5875 | 0.6393   | 0.7507  |
| 0.85 | 0.4757 | 0.4202 | 0.6334 | 0.5851 | 0.6354   | 0.7496  |
| 0.90 | 0.4800 | 0.4203 | 0.6357 | 0.5828 | 0.6316   | 0.7488  |
| 0.95 | 0.4746 | 0.4203 | 0.6377 | 0.5805 | 0.6279   | 0.7481  |

#### 表5: 全国范围各产品在不同阈值下的 FAR (空报率)

| 阈值   | CMORPH | CHIRPS | GSMAP  | IMERG  | PERSIANN | SM2RAIN |
|------|--------|--------|--------|--------|----------|---------|
| 0.00 | 0.2750 | 0.3085 | 0.0615 | 0.2850 | 0.3816   | 0.3519  |
| 0.05 | 0.3360 | 0.3551 | 0.0885 | 0.3116 | 0.4382   | 0.4127  |
| 0.10 | 0.3742 | 0.3766 | 0.1080 | 0.3244 | 0.4601   | 0.4387  |
| 0.15 | 0.3747 | 0.3881 | 0.1222 | 0.3318 | 0.4706   | 0.4456  |
| 0.20 | 0.3943 | 0.3962 | 0.1340 | 0.3371 | 0.4769   | 0.4537  |
| 0.25 | 0.3943 | 0.4026 | 0.1443 | 0.3418 | 0.4812   | 0.4577  |
| 0.30 | 0.4082 | 0.4080 | 0.1533 | 0.3456 | 0.4842   | 0.4619  |
| 0.35 | 0.4059 | 0.4127 | 0.1615 | 0.3491 | 0.4867   | 0.4643  |
| 0.40 | 0.4170 | 0.4168 | 0.1689 | 0.3522 | 0.4887   | 0.4672  |
| 0.45 | 0.4145 | 0.4208 | 0.1758 | 0.3553 | 0.4905   | 0.4689  |
| 0.50 | 0.4127 | 0.4245 | 0.1823 | 0.3581 | 0.4921   | 0.4703  |
| 0.55 | 0.4214 | 0.4278 | 0.1882 | 0.3607 | 0.4935   | 0.4723  |
| 0.60 | 0.4297 | 0.4312 | 0.1940 | 0.3634 | 0.4949   | 0.4741  |
| 0.65 | 0.4265 | 0.4343 | 0.1995 | 0.3661 | 0.4962   | 0.4751  |
| 0.70 | 0.4258 | 0.4375 | 0.2047 | 0.3686 | 0.4976   | 0.4762  |
| 0.75 | 0.4329 | 0.4405 | 0.2098 | 0.3711 | 0.4989   | 0.4777  |
| 0.80 | 0.4396 | 0.4433 | 0.2145 | 0.3734 | 0.5000   | 0.4790  |
| 0.85 | 0.4366 | 0.4462 | 0.2191 | 0.3757 | 0.5011   | 0.4798  |
| 0.90 | 0.4429 | 0.4490 | 0.2236 | 0.3779 | 0.5024   | 0.4807  |
| 0.95 | 0.4421 | 0.4517 | 0.2279 | 0.3802 | 0.5035   | 0.4817  |

#### 表6: 全国范围各产品在不同阈值下的 CSI (临界成功指数)

| 阈值   | CMORPH | CHIRPS | GSMAP  | IMERG  | PERSIANN | SM2RAIN |
|------|--------|--------|--------|--------|----------|---------|
| 0.00 | 0.3825 | 0.3285 | 0.4499 | 0.5474 | 0.4687   | 0.5544  |
| 0.05 | 0.3908 | 0.3275 | 0.4856 | 0.5138 | 0.4417   | 0.5057  |
| 0.10 | 0.3922 | 0.3273 | 0.5039 | 0.4973 | 0.4300   | 0.4838  |
| 0.15 | 0.3798 | 0.3270 | 0.5142 | 0.4871 | 0.4237   | 0.4753  |
| 0.20 | 0.3802 | 0.3261 | 0.5213 | 0.4796 | 0.4195   | 0.4684  |
| 0.25 | 0.3729 | 0.3250 | 0.5264 | 0.4735 | 0.4163   | 0.4641  |
| 0.30 | 0.3730 | 0.3239 | 0.5299 | 0.4683 | 0.4136   | 0.4605  |
| 0.35 | 0.3669 | 0.3231 | 0.5327 | 0.4638 | 0.4111   | 0.4580  |
| 0.40 | 0.3668 | 0.3221 | 0.5348 | 0.4596 | 0.4088   | 0.4555  |
| 0.45 | 0.3621 | 0.3211 | 0.5362 | 0.4559 | 0.4063   | 0.4537  |
| 0.50 | 0.3578 | 0.3201 | 0.5372 | 0.4524 | 0.4039   | 0.4521  |
| 0.55 | 0.3579 | 0.3192 | 0.5379 | 0.4492 | 0.4015   | 0.4505  |
| 0.60 | 0.3577 | 0.3183 | 0.5384 | 0.4461 | 0.3991   | 0.4489  |
| 0.65 | 0.3539 | 0.3174 | 0.5386 | 0.4431 | 0.3967   | 0.4478  |
| 0.70 | 0.3509 | 0.3165 | 0.5387 | 0.4403 | 0.3944   | 0.4466  |
| 0.75 | 0.3508 | 0.3157 | 0.5385 | 0.4377 | 0.3921   | 0.4453  |
| 0.80 | 0.3507 | 0.3148 | 0.5382 | 0.4352 | 0.3900   | 0.4442  |
| 0.85 | 0.3476 | 0.3140 | 0.5378 | 0.4327 | 0.3878   | 0.4432  |
| 0.90 | 0.3474 | 0.3130 | 0.5373 | 0.4304 | 0.3857   | 0.4423  |
| 0.95 | 0.3449 | 0.3122 | 0.5367 | 0.4281 | 0.3836   | 0.4412  |

| 和 PERSIANN 之间的相关系数             | 0.6752                 | 0.7533                 | 0.4636                 | 0.7134                 | 0.5920                 | 1.0000 (self-correlation) |

## 9. 全国范围各降雨产品基本统计特征

以下数据基于全国范围（掩码值为1的区域），时间跨度为2016-2020年 (1827天)。目标变量 Y 为 CHM 产品。

| 指标                               | CMORPH                 | CHIRPS                 | SM2RAIN                | IMERG                  | GSMAP                  | PERSIANN               |
|------------------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|
| 平均值                             | 1.8652                 | 1.8549                 | 1.9931                 | 1.8931                 | 1.6654                 | 1.9591                 |
| 标准差                             | 6.9623                 | 6.9233                 | 4.2815                 | 6.7717                 | 5.7024                 | 5.5107                 |
| 最大值                             | 379.8000               | 330.5150               | 301.2768               | 408.9030               | 297.9254               | 281.0631               |
| 最小值                             | 0.0000                 | 0.0000                 | 0.0000                 | 0.0000                 | 0.0000                 | 0.0000                 |
| 中位数                             | 0.0000                 | 0.0000                 | 0.2000                 | 0.0194                 | 0.0000                 | 0.1256                 |
| 众数 (count)                       | 0.0000 (18647303)      | 0.0000 (19567263)      | 0.0000 (9411016)       | 0.0000 (13131758)      | 0.0000 (20520991)      | 0.0000 (11810182)      |
| 方差                               | 48.4740                | 47.9320                | 18.3316                | 45.8562                | 32.5170                | 30.3680                |
| 偏度 (Skewness)                    | 8.2594                 | 7.7101                 | 4.6727                 | 8.5174                 | 7.4365                 | 6.6837                 |
| 峰度 (Kurtosis)                    | 108.5944               | 96.0344                | 46.5308                | 119.3158               | 96.1135                | 72.6359                |
| 和 Y (CHM) 之间的相关系数         | 0.4407                 | 0.4124                 | 0.5743                 | 0.5204                 | 0.6591                 | 0.4416                 |
| 和 CMORPH 之间的相关系数           | 1.0000 (self-correlation) | 0.6000                 | 0.5021                 | 0.7943                 | 0.6313                 | 0.6551                 |
| 和 CHIRPS 之间的相关系数           | 0.6000                 | 1.0000 (self-correlation) | 0.4650                 | 0.6605                 | 0.5851                 | 0.7431                 |
| 和 SM2RAIN 之间的相关系数          | 0.5021                 | 0.4650                 | 1.0000 (self-correlation) | 0.5690                 | 0.6298                 | 0.5092                 |
| 和 IMERG 之间的相关系数            | 0.7943                 | 0.6605                 | 0.5690                 | 1.0000 (self-correlation) | 0.7326                 | 0.7137                 |
| 和 GSMAP 之间的相关系数            | 0.6313                 | 0.5851                 | 0.6298                 | 0.7326                 | 1.0000 (self-correlation) | 0.5990                 |
| 和 PERSIANN 之间的相关系数         | 0.6551                 | 0.7431                 | 0.5092                 | 0.7137                 | 0.5990                 | 1.0000 (self-correlation) |

## 10. 各降雨产品逐年性能指标的空间统计特征详析

**10.2 各降雨产品逐年性能指标的空间统计特征详析**

**10.2.1 CMORPH 产品性能分析**

CMORPH 产品作为一种常用的卫星降雨产品，其在 2016 年至 2020 年间的性能表现出一定的时空变异性。

*   **10.2.1.1 POD (命中率) 空间统计特征**
    *   **平均空间 POD 随阈值变化：**
        *   **普遍趋势：** 在大多数年份（如 2016, 2017, 2018, 2019），CMORPH 的平均空间 POD 在非常小的阈值（0.0mm/d 至 0.1mm/d 或 0.2mm/d）下通常会略有上升，表明在探测微小降雨事件时，略微提高阈值有助于排除一些噪声，反而提升名义上的命中率。然而，随着阈值的进一步增高（超过 0.2mm/d 或 0.3mm/d），平均空间 POD 整体呈现下降趋势或在高位波动后缓慢下降。这符合预期，因为更高强度的降雨事件本身发生频率较低，探测难度也可能增加。
        *   **2016年：** 从 0.0mm/d 的 0.5134 上升到 0.1mm/d 的 0.5696，之后在 0.51-0.56 之间波动，整体略有下降趋势。
        *   **2017年：** 从 0.0mm/d 的 0.4975 上升到 0.1mm/d 的 0.5493，之后在 0.50-0.54 之间波动，整体趋势不明显，但高阈值下略有下降。
        *   **2018年：** 从 0.0mm/d 的 0.5052 上升到 0.1mm/d 的 0.5551，之后在 0.50-0.54 之间波动，高阈值下有下降。
        *   **2019年：** 从 0.0mm/d 的 0.4797 上升到 0.1mm/d 的 0.5340，之后在 0.49-0.53 之间波动，高阈值下略有下降。
        *   **2020年：** 从 0.0mm/d 的 0.4787 上升到 0.1mm/d 的 0.5384，之后在 0.52-0.54 之间波动，整体趋势相对平稳，但在极高阈值下略有下降。
    *   **空间 POD 离散度 (标准差)：**
        *   **普遍趋势：** CMORPH 的 POD 空间标准差在各年份通常维持在 0.07 至 0.10 之间，表明其命中率在全国范围内存在一定的空间差异。
        *   **随阈值变化：** 标准差随阈值的变化没有非常一致的模式，有时略增，有时略减，但整体波动不大。例如，2016年标准差在0.078-0.088之间；2017年在0.091-0.103之间，显示出更大的空间不一致性。
    *   **空间 POD 分布形态 (偏度、峰度)：**
        *   **偏度：** 在大多数年份和阈值下，POD 的空间偏度为正（如 2016 年在 0.0 到 0.65 之间波动，2018 年在 0.1 到 0.78 之间），表明 POD 空间分布略微右偏，即存在一些 POD 表现显著高于平均值的区域。随着阈值增加，偏度值有时会减小，甚至变为负值（如 2016 年高阈值下 POD 偏度接近 -0.5），说明高强度降雨的命中率空间差异模式可能发生改变。
        *   **峰度：** POD 的空间峰度值多数情况下接近 0 或为正（如 2016 年在 -0.02 到 1.7 之间，2017 年在 0.18 到 2.15 之间），表明其分布形态与正态分布相似或略尖峭。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 POD 在 2016 年 (0.5696), 2017 年 (0.5493), 2018 年 (0.5551), 2019 年 (0.5340), 2020 年 (0.5384)。年际间存在一定波动，但幅度不算特别剧烈。2016年表现相对较好。
        *   2017年和2020年在较低阈值下的POD均值相对其他年份偏低，且2017年POD的空间标准差较大，说明这两年CMORPH在探测小雨和空间一致性上可能面临更大挑战。

*   **10.2.1.2 FAR (空报率) 空间统计特征**
    *   **平均空间 FAR：**
        *   **整体水平：** CMORPH 的平均空间 FAR 在所有年份和阈值下都保持在非常低的水平，通常在 0.008 到 0.023 之间。这是一个积极的信号，表明 CMORPH 整体的误报情况控制得较好。
        *   **随阈值变化：** 平均空间 FAR 随着阈值的增加呈现缓慢上升的趋势。例如，2016 年从 0.0mm/d 的 0.0088 上升到 0.95mm/d 的 0.0213。这可能是因为随着阈值提高，实际有雨的样本减少，使得少数误报事件在比例上更为显著。
    *   **空间 FAR 中位数：**
        *   在所有年份和所有阈值下，CMORPH 的 FAR 空间中位数几乎**始终为 0.0000**。这表明在全国大部分格点上，CMORPH 产品的误报率极低，误报可能主要集中在少数区域。
    *   **空间 FAR 离散度 (标准差)：**
        *   FAR 的空间标准差也相对较低，通常在 0.03 到 0.09 之间波动，并随阈值增加而略有增大。这与中位数为0相呼应，说明误报主要由少数离群的高值贡献。
    *   **空间 FAR 分布形态 (偏度、峰度)：**
        *   **偏度：** FAR 的空间偏度值在所有年份和阈值下均表现出**极高的正偏** (通常在 4.0 到 6.5 之间)。这强烈指示 FAR 的空间分布是高度不对称的，存在少数格点的 FAR 值远高于平均水平，即误报具有显著的局部集中性。
        *   **峰度：** FAR 的空间峰度值同样表现出**极高的正峰度** (通常在 18 到 50+ 之间)。这进一步证实了 FAR 分布的尖峰厚尾特征，即大部分区域 FAR 极低，但存在少数区域误报非常严重。
        *   **对误报研究的意义：** FAR 的高偏度和高峰度特性是本项目需要重点关注的，它提示误报并非随机均匀分布，而是有其特定的空间聚集模式，这为后续分析误报成因、改进模型提供了重要线索。例如，可以针对这些高 FAR 区域进行更细致的特征分析和建模。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 FAR 在 2016 年 (0.0142), 2017 年 (0.0147), 2018 年 (0.0136), 2019 年 (0.0141), 2020 年 (0.0138)。年际间波动非常小，表现出较好的一致性。

*   **10.2.1.3 CSI (临界成功指数) 空间统计特征**
    *   **平均空间 CSI：**
        *   **整体水平：** CMORPH 的平均空间 CSI 通常在 0.42 到 0.50 之间波动。
        *   **随阈值变化：** CSI 随阈值的变化趋势通常是先略微上升（在0.0mm/d到0.1mm/d或0.2mm/d之间达到峰值），然后逐渐下降。例如，2016年从0.0mm/d的0.4759上升到0.1mm/d的0.4989，之后下降至0.95mm/d的0.4352。这反映了在极小阈值时，虽然POD可能增加，但FAR的轻微增加也可能影响CSI；而在高阈值时，POD的下降成为影响CSI的主要因素。
    *   **空间 CSI 离散度 (标准差)：**
        *   CSI 的空间标准差通常在 0.06 到 0.09 之间，与 POD 的标准差水平相似，表明其综合评分在空间上也存在一定的变异。
    *   **空间 CSI 分布形态 (偏度、峰度)：**
        *   **偏度：** CSI 的空间偏度在多数情况下为负值（尤其是在中高阈值下，如 2016 年多数阈值下在 -0.6 到 -0.2 之间），表明存在一些 CSI 表现显著低于平均值的区域。
        *   **峰度：** CSI 的空间峰度值多在 -0.5 到 1.0 之间，分布形态相对接近正态或略平坦/略尖。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 CSI 在 2016 年 (0.4989), 2017 年 (0.4800), 2018 年 (0.4914), 2019 年 (0.4719), 2020 年 (0.4782)。2016年和2018年表现相对较好。

*   **10.2.1.4 产品间性能指标空间相关性 (基于每年 0.95mm/d 阈值)**
    *   **与 CHIRPS：** POD 相关性中等 (0.52-0.64)，FAR 相关性非常高 (0.91-0.93)，CSI 相关性中高 (0.50-0.66)。表明两者在误报的空间分布上高度一致，在命中和综合评分上也有一定相似性。
    *   **与 SM2RAIN：** POD 相关性较低 (0.31-0.41)，FAR 相关性高 (0.88-0.90)，CSI 相关性较低至中等 (0.13-0.44)。表明两者在误报空间分布上有一定相似性，但在命中和综合评分的空间模式上差异较大。2017年CSI相关性仅0.1307，差异尤为显著。
    *   **与 IMERG：** POD 相关性中高 (0.55-0.67)，FAR 相关性非常高 (0.93-0.95)，CSI 相关性高 (0.58-0.76)。表明两者在各类性能指标的空间分布上都表现出较强的一致性，尤其是在误报和综合评分上。
    *   **与 GSMAP：** POD 相关性中等 (0.37-0.56)，FAR 相关性高 (0.89-0.93)，CSI 相关性中高 (0.56-0.67)。表明两者在误报和综合评分的空间分布上有较好的一致性。
    *   **与 PERSIANN：** POD 相关性中高 (0.56-0.60)，FAR 相关性非常高 (0.93-0.96)，CSI 相关性中高 (0.51-0.67)。表明两者在各类性能指标的空间分布上也表现出较强的一致性。
    *   **总结：** CMORPH 在 FAR 的空间分布模式上与所有其他产品都表现出高度一致性。在 POD 和 CSI 方面，与 IMERG、PERSIANN、GSMAP 和 CHIRPS 的空间分布模式有中高程度的相似性，而与 SM2RAIN 的相似性较低。

*   **10.2.1.5 CMORPH 年度表现小结**
    *   **整体性能：** CMORPH 在全国范围内的平均 CSI 大约在 0.45-0.50 之间（针对中低阈值）。其 FAR 控制得非常好，空间中位数常年为0，但误报呈现高度局部化的特点（高偏度和峰度）。
    *   **年际差异：** 2016年和2018年在POD和CSI的平均水平上略优于其他年份。2017年POD的空间变异性较大。FAR的年际稳定性非常好。
    *   **空间特征：** POD 和 CSI 的空间分布存在一定变异，而 FAR 的误报高度集中在少数区域。
    *   **与其他产品关系：** 其误报高发区的空间位置可能与其他产品相似；在综合性能的空间好坏区域分布上，与 IMERG, PERSIANN 等产品有较强的同步性。

**10.2 各降雨产品逐年性能指标的空间统计特征详析**

**10.2.1 CMORPH 产品性能分析**

CMORPH 产品作为一种常用的卫星降雨产品，其在 2016 年至 2020 年间的性能表现出一定的时空变异性。

*   **10.2.1.1 POD (命中率) 空间统计特征**
    *   **平均空间 POD 随阈值变化：**
        *   **普遍趋势：** 在大多数年份（如 2016, 2017, 2018, 2019），CMORPH 的平均空间 POD 在非常小的阈值（0.0mm/d 至 0.1mm/d 或 0.2mm/d）下通常会略有上升，表明在探测微小降雨事件时，略微提高阈值有助于排除一些噪声，反而提升名义上的命中率。然而，随着阈值的进一步增高（超过 0.2mm/d 或 0.3mm/d），平均空间 POD 整体呈现下降趋势或在高位波动后缓慢下降。这符合预期，因为更高强度的降雨事件本身发生频率较低，探测难度也可能增加。
        *   **2016年：** 从 0.0mm/d 的 0.5134 上升到 0.1mm/d 的 0.5696，之后在 0.51-0.56 之间波动，整体略有下降趋势。
        *   **2017年：** 从 0.0mm/d 的 0.4975 上升到 0.1mm/d 的 0.5493，之后在 0.50-0.54 之间波动，整体趋势不明显，但高阈值下略有下降。
        *   **2018年：** 从 0.0mm/d 的 0.5052 上升到 0.1mm/d 的 0.5551，之后在 0.50-0.54 之间波动，高阈值下有下降。
        *   **2019年：** 从 0.0mm/d 的 0.4797 上升到 0.1mm/d 的 0.5340，之后在 0.49-0.53 之间波动，高阈值下略有下降。
        *   **2020年：** 从 0.0mm/d 的 0.4787 上升到 0.1mm/d 的 0.5384，之后在 0.52-0.54 之间波动，整体趋势相对平稳，但在极高阈值下略有下降。
    *   **空间 POD 离散度 (标准差)：**
        *   **普遍趋势：** CMORPH 的 POD 空间标准差在各年份通常维持在 0.07 至 0.10 之间，表明其命中率在全国范围内存在一定的空间差异。
        *   **随阈值变化：** 标准差随阈值的变化没有非常一致的模式，有时略增，有时略减，但整体波动不大。例如，2016年标准差在0.078-0.088之间；2017年在0.091-0.103之间，显示出更大的空间不一致性。
    *   **空间 POD 分布形态 (偏度、峰度)：**
        *   **偏度：** 在大多数年份和阈值下，POD 的空间偏度为正（如 2016 年在 0.0 到 0.65 之间波动，2018 年在 0.1 到 0.78 之间），表明 POD 空间分布略微右偏，即存在一些 POD 表现显著高于平均值的区域。随着阈值增加，偏度值有时会减小，甚至变为负值（如 2016 年高阈值下 POD 偏度接近 -0.5），说明高强度降雨的命中率空间差异模式可能发生改变。
        *   **峰度：** POD 的空间峰度值多数情况下接近 0 或为正（如 2016 年在 -0.02 到 1.7 之间，2017 年在 0.18 到 2.15 之间），表明其分布形态与正态分布相似或略尖峭。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 POD 在 2016 年 (0.5696), 2017 年 (0.5493), 2018 年 (0.5551), 2019 年 (0.5340), 2020 年 (0.5384)。年际间存在一定波动，但幅度不算特别剧烈。2016年表现相对较好。
        *   2017年和2020年在较低阈值下的POD均值相对其他年份偏低，且2017年POD的空间标准差较大，说明这两年CMORPH在探测小雨和空间一致性上可能面临更大挑战。

*   **10.2.1.2 FAR (空报率) 空间统计特征**
    *   **平均空间 FAR：**
        *   **整体水平：** CMORPH 的平均空间 FAR 在所有年份和阈值下都保持在非常低的水平，通常在 0.008 到 0.023 之间。这是一个积极的信号，表明 CMORPH 整体的误报情况控制得较好。
        *   **随阈值变化：** 平均空间 FAR 随着阈值的增加呈现缓慢上升的趋势。例如，2016 年从 0.0mm/d 的 0.0088 上升到 0.95mm/d 的 0.0213。这可能是因为随着阈值提高，实际有雨的样本减少，使得少数误报事件在比例上更为显著。
    *   **空间 FAR 中位数：**
        *   在所有年份和所有阈值下，CMORPH 的 FAR 空间中位数几乎**始终为 0.0000**。这表明在全国大部分格点上，CMORPH 产品的误报率极低，误报可能主要集中在少数区域。
    *   **空间 FAR 离散度 (标准差)：**
        *   FAR 的空间标准差也相对较低，通常在 0.03 到 0.09 之间波动，并随阈值增加而略有增大。这与中位数为0相呼应，说明误报主要由少数离群的高值贡献。
    *   **空间 FAR 分布形态 (偏度、峰度)：**
        *   **偏度：** FAR 的空间偏度值在所有年份和阈值下均表现出**极高的正偏** (通常在 4.0 到 6.5 之间)。这强烈指示 FAR 的空间分布是高度不对称的，存在少数格点的 FAR 值远高于平均水平，即误报具有显著的局部集中性。
        *   **峰度：** FAR 的空间峰度值同样表现出**极高的正峰度** (通常在 18 到 50+ 之间)。这进一步证实了 FAR 分布的尖峰厚尾特征，即大部分区域 FAR 极低，但存在少数区域误报非常严重。
        *   **对误报研究的意义：** FAR 的高偏度和高峰度特性是本项目需要重点关注的，它提示误报并非随机均匀分布，而是有其特定的空间聚集模式，这为后续分析误报成因、改进模型提供了重要线索。例如，可以针对这些高 FAR 区域进行更细致的特征分析和建模。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 FAR 在 2016 年 (0.0142), 2017 年 (0.0147), 2018 年 (0.0136), 2019 年 (0.0141), 2020 年 (0.0138)。年际间波动非常小，表现出较好的一致性。

*   **10.2.1.3 CSI (临界成功指数) 空间统计特征**
    *   **平均空间 CSI：**
        *   **整体水平：** CMORPH 的平均空间 CSI 通常在 0.42 到 0.50 之间波动。
        *   **随阈值变化：** CSI 随阈值的变化趋势通常是先略微上升（在0.0mm/d到0.1mm/d或0.2mm/d之间达到峰值），然后逐渐下降。例如，2016年从0.0mm/d的0.4759上升到0.1mm/d的0.4989，之后下降至0.95mm/d的0.4352。这反映了在极小阈值时，虽然POD可能增加，但FAR的轻微增加也可能影响CSI；而在高阈值时，POD的下降成为影响CSI的主要因素。
    *   **空间 CSI 离散度 (标准差)：**
        *   CSI 的空间标准差通常在 0.06 到 0.09 之间，与 POD 的标准差水平相似，表明其综合评分在空间上也存在一定的变异。
    *   **空间 CSI 分布形态 (偏度、峰度)：**
        *   **偏度：** CSI 的空间偏度在多数情况下为负值（尤其是在中高阈值下，如 2016 年多数阈值下在 -0.6 到 -0.2 之间），表明存在一些 CSI 表现显著低于平均值的区域。
        *   **峰度：** CSI 的空间峰度值多在 -0.5 到 1.0 之间，分布形态相对接近正态或略平坦/略尖。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 CSI 在 2016 年 (0.4989), 2017 年 (0.4800), 2018 年 (0.4914), 2019 年 (0.4719), 2020 年 (0.4782)。2016年和2018年表现相对较好。

*   **10.2.1.4 产品间性能指标空间相关性 (基于每年 0.95mm/d 阈值)**
    *   **与 CHIRPS：** POD 相关性中等 (0.52-0.64)，FAR 相关性非常高 (0.91-0.93)，CSI 相关性中高 (0.50-0.66)。表明两者在误报的空间分布上高度一致，在命中和综合评分上也有一定相似性。
    *   **与 SM2RAIN：** POD 相关性较低 (0.31-0.41)，FAR 相关性高 (0.88-0.90)，CSI 相关性较低至中等 (0.13-0.44)。表明两者在误报空间分布上有一定相似性，但在命中和综合评分的空间模式上差异较大。2017年CSI相关性仅0.1307，差异尤为显著。
    *   **与 IMERG：** POD 相关性中高 (0.55-0.67)，FAR 相关性非常高 (0.93-0.95)，CSI 相关性高 (0.58-0.76)。表明两者在各类性能指标的空间分布上都表现出较强的一致性，尤其是在误报和综合评分上。
    *   **与 GSMAP：** POD 相关性中等 (0.37-0.56)，FAR 相关性高 (0.89-0.93)，CSI 相关性中高 (0.56-0.67)。表明两者在误报和综合评分的空间分布上有较好的一致性。
    *   **与 PERSIANN：** POD 相关性中高 (0.56-0.60)，FAR 相关性非常高 (0.93-0.96)，CSI 相关性中高 (0.51-0.67)。表明两者在各类性能指标的空间分布上也表现出较强的一致性。
    *   **总结：** CMORPH 在 FAR 的空间分布模式上与所有其他产品都表现出高度一致性。在 POD 和 CSI 方面，与 IMERG、PERSIANN、GSMAP 和 CHIRPS 的空间分布模式有中高程度的相似性，而与 SM2RAIN 的相似性较低。

*   **10.2.1.5 CMORPH 年度表现小结**
    *   **整体性能：** CMORPH 在全国范围内的平均 CSI 大约在 0.45-0.50 之间（针对中低阈值）。其 FAR 控制得非常好，空间中位数常年为0，但误报呈现高度局部化的特点（高偏度和峰度）。
    *   **年际差异：** 2016年和2018年在POD和CSI的平均水平上略优于其他年份。2017年POD的空间变异性较大。FAR的年际稳定性非常好。
    *   **空间特征：** POD 和 CSI 的空间分布存在一定变异，而 FAR 的误报高度集中在少数区域。
    *   **与其他产品关系：** 其误报高发区的空间位置可能与其他产品相似；在综合性能的空间好坏区域分布上，与 IMERG, PERSIANN 等产品有较强的同步性。

**10.2.2 CHIRPS 产品性能分析**

CHIRPS 产品作为另一种广泛应用的降雨数据集，其在 2016 年至 2020 年的性能表现如下：

*   **10.2.2.1 POD (命中率) 空间统计特征**
    *   **平均空间 POD 随阈值变化：**
        *   **普遍趋势：** CHIRPS 的平均空间 POD 整体水平相较于 CMORPH 偏低，通常在 0.38 到 0.46 之间波动 (2020年略高，达到0.44-0.50)。与 CMORPH 类似，在极低阈值下，POD 随阈值略微增加后趋于平稳或缓慢下降。
        *   **2016年：** 从 0.0mm/d 的 0.4234 缓慢上升至 0.25-0.45mm/d 区间的约 0.46，之后略有下降。
        *   **2017年：** 从 0.0mm/d 的 0.3838 缓慢上升至 0.4-0.55mm/d 区间的约 0.42-0.423，之后变化不大。
        *   **2018年：** 从 0.0mm/d 的 0.4284 上升至 0.2-0.65mm/d 区间的约 0.46，之后略有下降。
        *   **2019年：** 从 0.0mm/d 的 0.3876 上升至 0.2-0.55mm/d 区间的约 0.416-0.418，之后变化不大。
        *   **2020年：** 从 0.0mm/d 的 0.4424 上升至 0.5-0.7mm/d 区间的约 0.498-0.499，是历年中POD表现最好的。
    *   **空间 POD 离散度 (标准差)：**
        *   **普遍趋势：** CHIRPS 的 POD 空间标准差相对较小，通常在 0.05 至 0.07 之间，这表明其命中率在全国范围内的空间一致性相对较好，优于CMORPH。
        *   **随阈值变化：** 标准差随阈值的变化不明显，整体保持在一个较低的稳定水平。
    *   **空间 POD 分布形态 (偏度、峰度)：**
        *   **偏度：** POD 的空间偏度值在不同年份和阈值下正负皆有，但绝对值通常较小（例如，2016年多数为负，在-0.3到0.1之间；2017年多数为正，在0.1到0.3之间）。这表明其空间分布相对接近对称，或轻微偏斜。
        *   **峰度：** POD 的空间峰度值多数情况下为负值（例如，2016年普遍在-0.2到-0.7之间，2019年也多为负），表明其分布形态通常比正态分布更平坦（扁平峰）。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 POD 在 2016 年 (0.4498), 2017 年 (0.4082), 2018 年 (0.4517), 2019 年 (0.4094), 2020 年 (0.4783)。2017年和2019年表现相对较差，2020年表现最好。CHIRPS 的POD年际波动较CMORPH更为明显。

*   **10.2.2.2 FAR (空报率) 空间统计特征**
    *   **平均空间 FAR：**
        *   **整体水平：** CHIRPS 的平均空间 FAR 整体水平与 CMORPH 相当，甚至略优，通常在 0.007 到 0.027 之间。
        *   **随阈值变化：** 与 CMORPH 类似，平均空间 FAR 随着阈值的增加呈现缓慢上升的趋势。例如，2016 年从 0.0mm/d 的 0.0107 上升到 0.95mm/d 的 0.0269。
    *   **空间 FAR 中位数：**
        *   与 CMORPH 一致，在所有年份和所有阈值下，CHIRPS 的 FAR 空间中位数几乎**始终为 0.0000**。表明大部分区域误报控制良好。
    *   **空间 FAR 离散度 (标准差)：**
        *   FAR 的空间标准差也与 CMORPH 相似，通常在 0.03 到 0.10 之间波动，并随阈值增加而略有增大。
    *   **空间 FAR 分布形态 (偏度、峰度)：**
        *   **偏度：** CHIRPS 的 FAR 空间偏度值同样表现出**极高的正偏** (通常在 3.4 到 5.0 之间)，指示误报具有显著的局部集中性。
        *   **峰度：** CHIRPS 的 FAR 空间峰度值同样表现出**极高的正峰度** (通常在 10 到 30+ 之间)，进一步证实了误报分布的尖峰厚尾特征。
        *   **与CMORPH比较：** CHIRPS的FAR偏度和峰度值通常略低于CMORPH在相应条件下的值，但依然属于高度偏斜和尖峰的分布。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 FAR 在 2016 年 (0.0165), 2017 年 (0.0165), 2018 年 (0.0148), 2019 年 (0.0158), 2020 年 (0.0133)。年际间波动非常小，表现出较好的一致性。2020年FAR控制略好。

*   **10.2.2.3 CSI (临界成功指数) 空间统计特征**
    *   **平均空间 CSI：**
        *   **整体水平：** CHIRPS 的平均空间 CSI 通常在 0.34 到 0.43 之间波动，整体水平低于 CMORPH。
        *   **随阈值变化：** CSI 随阈值的变化趋势与 CMORPH 类似，通常是先略微上升或保持平稳，然后在较高阈值下逐渐下降。例如，2016年从0.0mm/d的0.3942，在0.05-0.2mm/d附近达到约0.40的峰值，之后缓慢下降至0.95mm/d的0.3717。
    *   **空间 CSI 离散度 (标准差)：**
        *   CSI 的空间标准差通常在 0.045 到 0.065 之间，相对较小，表明其综合评分在空间上的差异性也较小，表现出比CMORPH更好的空间均一性。
    *   **空间 CSI 分布形态 (偏度、峰度)：**
        *   **偏度：** CSI 的空间偏度在不同年份和阈值下表现不一，有时为正，有时为负，但绝对值通常不大（多数在-0.3到0.3之间）。
        *   **峰度：** CSI 的空间峰度值多数情况下为负值（通常在-0.7到-0.1之间），表明其空间分布通常比正态分布更平坦。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 CSI 在 2016 年 (0.4011), 2017 年 (0.3680), 2018 年 (0.4082), 2019 年 (0.3701), 2020 年 (0.4347)。2017年和2019年表现较差，2020年表现最好。

*   **10.2.2.4 产品间性能指标空间相关性 (基于每年 0.95mm/d 阈值)**
    *   **与 SM2RAIN：** POD 相关性较低 (0.25-0.50)，FAR 相关性非常高 (0.96-0.98)，CSI 相关性较低至中等 (0.16-0.49)。
    *   **与 IMERG：** POD 相关性中高 (0.56-0.61)，FAR 相关性非常高 (0.97-0.98)，CSI 相关性高 (0.65-0.73)。
    *   **与 GSMAP：** POD 相关性中等 (0.42-0.61)，FAR 相关性非常高 (0.96-0.97)，CSI 相关性中高 (0.53-0.74)。
    *   **与 PERSIANN：** POD 相关性中等 (0.40-0.67)，FAR 相关性非常高 (0.98-0.99)，CSI 相关性高 (0.65-0.78)。
    *   **总结：** CHIRPS 在 FAR 的空间分布模式上与所有其他产品都表现出极高的一致性。在 POD 和 CSI 方面，与 IMERG, PERSIANN, GSMAP 的空间分布模式有中高至较高程度的相似性，与 SM2RAIN 的相似性相对较低。

*   **10.2.2.5 CHIRPS 年度表现小结**
    *   **整体性能：** CHIRPS 的平均 CSI 略低于 CMORPH，但其 POD 和 CSI 的空间一致性（标准差较小）通常优于 CMORPH。FAR 控制良好，与 CMORPH 类似，误报也呈现高度局部化特征。
    *   **年际差异：** 2020 年是 CHIRPS 表现最好的年份，在 POD 和 CSI 上均有明显提升。2017 年和 2019 年相对表现较弱。
    *   **空间特征：** POD 和 CSI 的空间分布相对均匀，峰度多为负，表明空间上极端好或差的区域较少。FAR 的误报同样高度集中在少数区域。
    *   **与其他产品关系：** 其误报高发区的空间位置与其他产品高度相似；在综合性能的空间好坏区域分布上，与IMERG, PERSIANN等产品有较强的同步性。

**10.2.3 SM2RAIN 产品性能分析**

SM2RAIN 产品基于土壤湿度反演降雨，其性能特征与其他直接遥感降雨的产品有所不同。

*   **10.2.3.1 POD (命中率) 空间统计特征**
    *   **平均空间 POD 随阈值变化：**
        *   **普遍趋势：** SM2RAIN 的平均空间 POD 在所有产品中表现**最高**，通常在 0.85 到 0.92 之间。这是一个非常显著的特点。随阈值增加，POD 整体呈现非常缓慢的下降趋势，但在所有测试阈值下均保持较高水平。
        *   **2016年：** 从 0.0mm/d 的 0.9070 缓慢下降至 0.95mm/d 的 0.8494。
        *   **2017年：** 从 0.0mm/d 的 0.9168 缓慢下降至 0.95mm/d 的 0.8744。
        *   **2018年：** 从 0.0mm/d 的 0.9120 缓慢下降至 0.95mm/d 的 0.8765。
        *   **2019年：** 从 0.0mm/d 的 0.9128 缓慢下降至 0.95mm/d 的 0.8429。
        *   **2020年：** 从 0.0mm/d 的 0.9146 缓慢下降至 0.95mm/d 的 0.8573。
    *   **空间 POD 离散度 (标准差)：**
        *   **普遍趋势：** SM2RAIN 的 POD 空间标准差相对较小，通常在 0.07 至 0.11 之间，表明其高命中率在全国范围内也具有较好的一致性。
        *   **随阈值变化：** 标准差随阈值的变化不大，整体维持在一个相对稳定的水平。
    *   **空间 POD 分布形态 (偏度、峰度)：**
        *   **偏度：** POD 的空间偏度值在所有年份和阈值下均表现出显著的**负偏** (通常在 -1.6 到 -1.0 之间)。这表明 POD 空间分布是左偏的，即大部分区域的 POD 都非常高，接近其最大值，而少数区域的 POD 表现相对较差，拉低了平均值。
        *   **峰度：** POD 的空间峰度值通常为正（多数在 0.5 到 3.5 之间），表明其分布比正态分布更尖峭，进一步印证了大部分区域 POD 集中在高值区。
    *   **年际变化：**
        *   SM2RAIN 的平均空间 POD 在各年份间表现非常稳定，例如在0.1mm/d阈值下，均在0.89-0.91之间，波动很小。

*   **10.2.3.2 FAR (空报率) 空间统计特征**
    *   **平均空间 FAR：**
        *   **整体水平：** SM2RAIN 的平均空间 FAR 相比 CMORPH 和 CHIRPS 略高，通常在 0.015 到 0.035 之间。
        *   **随阈值变化：** 与其他产品类似，平均空间 FAR 随着阈值的增加呈现缓慢上升的趋势。例如，2016 年从 0.0mm/d 的 0.0168 上升到 0.95mm/d 的 0.0341。
    *   **空间 FAR 中位数：**
        *   与 CMORPH 和 CHIRPS 一致，在所有年份和所有阈值下，SM2RAIN 的 FAR 空间中位数几乎**始终为 0.0000**。表明其误报也主要集中在少数区域。
    *   **空间 FAR 离散度 (标准差)：**
        *   FAR 的空间标准差在 0.05 到 0.12 之间波动，略高于 CMORPH 和 CHIRPS，表明其误报的空间差异性可能稍大一些。
    *   **空间 FAR 分布形态 (偏度、峰度)：**
        *   **偏度：** SM2RAIN 的 FAR 空间偏度值同样表现出**极高的正偏** (通常在 3.3 到 3.8 之间)，指示误报具有显著的局部集中性。
        *   **峰度：** SM2RAIN 的 FAR 空间峰度值同样表现出**极高的正峰度** (通常在 9 到 15+ 之间，个别年份在低阈值下可达20-30)，证实了误报分布的尖峰厚尾特征。其峰度值相比CMORPH和CHIRPS可能略低一些，但依然显著。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 FAR 在 2016 年 (0.0240), 2017 年 (0.0244), 2018 年 (0.0224), 2019 年 (0.0244), 2020 年 (0.0241)。年际间波动非常小，表现出良好的一致性。

*   **10.2.3.3 CSI (临界成功指数) 空间统计特征**
    *   **平均空间 CSI：**
        *   **整体水平：** SM2RAIN 的平均空间 CSI 表现优异，通常在 0.50 到 0.75 之间波动，在低阈值下表现尤为突出，显著高于其他产品。
        *   **随阈值变化：** CSI 随阈值的增加呈现清晰的下降趋势，尤其是在从极低阈值（如0.0mm/d）向中低阈值过渡时下降较快，之后趋于平缓下降。例如，2016年从0.0mm/d的0.7260下降至0.1mm/d的0.6396，再缓慢下降至0.95mm/d的0.5118。这表明SM2RAIN在探测微小降雨事件方面的综合技巧非常高，但对稍大降雨事件的区分能力相对减弱（尽管CSI绝对值仍然较高）。
    *   **空间 CSI 离散度 (标准差)：**
        *   CSI 的空间标准差通常在 0.05 到 0.08 之间，表明其较高的综合评分在空间上也具有较好的一致性。
    *   **空间 CSI 分布形态 (偏度、峰度)：**
        *   **偏度：** CSI 的空间偏度在低阈值下多为负或接近零（如2016年0.0mm/d时为-0.31），随着阈值增加，偏度值趋向于正值或在零附近波动（如2016年0.95mm/d时为0.1279）。这表明在探测微小降雨时，大部分区域CSI表现优异；而在探测稍大降雨时，空间差异模式有所改变。
        *   **峰度：** CSI 的空间峰度值变化较大，低阈值下可能为正（如2016年0.0mm/d时为0.46），高阈值下多接近零或略为负。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 CSI 在 2016 年 (0.6396), 2017 年 (0.6402), 2018 年 (0.6583), 2019 年 (0.6343), 2020 年 (0.6399)。年际间表现非常稳定。

*   **10.2.3.4 产品间性能指标空间相关性 (基于每年 0.95mm/d 阈值)**
    *   **与 IMERG：** POD 相关性较低 (0.11-0.35)，FAR 相关性高 (0.95-0.97)，CSI 相关性中等 (0.33-0.52)。
    *   **与 GSMAP：** POD 相关性中等 (0.30-0.50)，FAR 相关性高 (0.95-0.96)，CSI 相关性较低至中等 (0.10-0.46)。
    *   **与 PERSIANN：** POD 相关性极低甚至为负 (-0.13 至 0.015)，FAR 相关性高 (0.96-0.98)，CSI 相关性中等 (0.51-0.63)。
    *   **回顾与CMORPH/CHIRPS的关系：** 与CMORPH的POD相关性低，FAR相关性高，CSI相关性较低。与CHIRPS的POD相关性低，FAR相关性高，CSI相关性较低。
    *   **总结：** SM2RAIN 在 FAR 的空间分布模式上与所有其他产品都表现出高度一致性。然而，在 POD 和 CSI 的空间分布模式上，SM2RAIN 与其他所有直接遥感降雨产品（CMORPH, CHIRPS, IMERG, GSMAP, PERSIANN）均表现出较低的相似性。这突显了 SM2RAIN 作为一种基于不同物理原理（土壤湿度反演）的降雨产品的独特性。

*   **10.2.3.5 SM2RAIN 年度表现小结**
    *   **整体性能：** SM2RAIN 的最大特点是其**极高的 POD** 和在**低阈值下非常优异的 CSI**。这意味着它在探测“是否有雨”以及小雨量级事件方面能力很强。其 FAR 水平略高于 CMORPH/CHIRPS，但误报也呈现高度局部化特征。
    *   **年际差异：** SM2RAIN 的各项性能指标在年际间都表现出高度的稳定性。
    *   **空间特征：** POD 空间分布高度左偏，大部分区域表现优异。CSI 在低阈值下也有类似趋势。FAR 的误报同样高度集中在少数区域。
    *   **与其他产品关系：** 其误报高发区的空间位置可能与其他产品相似；但在命中能力和综合评分的空间好坏区域分布上，与传统卫星遥感产品差异较大，这使其在数据融合中可能提供独特的补充信息。

**10.2.4 IMERG 产品性能分析**

IMERG 作为 GPM 时代的核心降雨产品之一，其在 2016 年至 2020 年间的性能表现备受关注。

*   **10.2.4.1 POD (命中率) 空间统计特征**
    *   **平均空间 POD 随阈值变化：**
        *   **普遍趋势：** IMERG 的平均空间 POD 整体水平较高，通常在 0.61 到 0.77 之间波动。与其他产品类似，POD 随阈值增加呈现下降趋势，但在高阈值下仍能维持一个相对不错的水平。
        *   **2016年：** 从 0.0mm/d 的 0.7567 持续下降至 0.95mm/d 的 0.6147。
        *   **2017年：** 从 0.0mm/d 的 0.7510 持续下降至 0.95mm/d 的 0.6160。
        *   **2018年：** 从 0.0mm/d 的 0.7688 持续下降至 0.95mm/d 的 0.6286。
        *   **2019年：** 从 0.0mm/d 的 0.7480 持续下降至 0.95mm/d 的 0.6026。
        *   **2020年：** 从 0.0mm/d 的 0.7501 持续下降至 0.95mm/d 的 0.6493 (2020年在高阈值下POD表现相对突出)。
    *   **空间 POD 离散度 (标准差)：**
        *   **普遍趋势：** IMERG 的 POD 空间标准差通常在 0.068 至 0.095 之间，表明其命中率在全国范围内存在一定的空间差异，与CMORPH的变异程度相似或略好。
        *   **随阈值变化：** 标准差随阈值的变化没有非常一致的模式，但整体波动不大。
    *   **空间 POD 分布形态 (偏度、峰度)：**
        *   **偏度：** POD 的空间偏度值在所有年份和阈值下几乎都为**负偏** (通常在 -0.6 到 -0.2 之间)。这表明 POD 空间分布是左偏的，即大部分区域的 POD 表现较好，接近其最大值，而少数区域的 POD 表现相对较差。
        *   **峰度：** POD 的空间峰度值多数情况下接近 0 或略为正（例如，2016年多数在0.0到0.3之间），表明其分布形态与正态分布相似或略尖峭。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 POD 在 2016 年 (0.7100), 2017 年 (0.6994), 2018 年 (0.7206), 2019 年 (0.6975), 2020 年 (0.7148)。年际间波动相对较小，2018年表现略优。

*   **10.2.4.2 FAR (空报率) 空间统计特征**
    *   **平均空间 FAR：**
        *   **整体水平：** IMERG 的平均空间 FAR 水平与 CMORPH 和 CHIRPS 相当，甚至在某些情况下略优，通常在 0.010 到 0.023 之间。
        *   **随阈值变化：** 与其他产品类似，平均空间 FAR 随着阈值的增加呈现缓慢上升的趋势。例如，2016 年从 0.0mm/d 的 0.0119 上升到 0.95mm/d 的 0.0212。
    *   **空间 FAR 中位数：**
        *   与前面分析的产品一致，在所有年份和所有阈值下，IMERG 的 FAR 空间中位数几乎**始终为 0.0000**。表明大部分区域误报控制良好。
    *   **空间 FAR 离散度 (标准差)：**
        *   FAR 的空间标准差也与 CMORPH 和 CHIRPS 相似，通常在 0.035 到 0.08 之间波动，并随阈值增加而略有增大。
    *   **空间 FAR 分布形态 (偏度、峰度)：**
        *   **偏度：** IMERG 的 FAR 空间偏度值同样表现出**极高的正偏** (通常在 3.5 到 4.2 之间)，指示误报具有显著的局部集中性。
        *   **峰度：** IMERG 的 FAR 空间峰度值同样表现出**极高的正峰度** (通常在 11 到 20+ 之间)，证实了误报分布的尖峰厚尾特征。其偏度和峰度值与CMORPH和CHIRPS在同一量级。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 FAR 在 2016 年 (0.0153), 2017 年 (0.0156), 2018 年 (0.0145), 2019 年 (0.0151), 2020 年 (0.0151)。年际间波动非常小，表现出良好的一致性。

*   **10.2.4.3 CSI (临界成功指数) 空间统计特征**
    *   **平均空间 CSI：**
        *   **整体水平：** IMERG 的平均空间 CSI 表现较好，通常在 0.50 到 0.68 之间波动，整体优于 CMORPH 和 CHIRPS，但通常略低于 SM2RAIN 在极低阈值下的表现。
        *   **随阈值变化：** CSI 随阈值的增加呈现清晰的下降趋势。例如，2016年从0.0mm/d的0.6636下降至0.95mm/d的0.5017。
    *   **空间 CSI 离散度 (标准差)：**
        *   CSI 的空间标准差通常在 0.05 到 0.07 之间，表明其综合评分在空间上也具有较好的一致性，与CHIRPS类似，优于CMORPH。
    *   **空间 CSI 分布形态 (偏度、峰度)：**
        *   **偏度：** CSI 的空间偏度在不同年份和阈值下表现不一，但多数情况下绝对值较小（例如，2016年多数在0.0到0.3之间，2017年多数在-0.4到-0.1之间）。
        *   **峰度：** CSI 的空间峰度值多数情况下接近0或为负值（例如，2016年多数在-0.1到0.2之间），表明其空间分布形态相对接近正态或略平坦。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 CSI 在 2016 年 (0.6044), 2017 年 (0.5933), 2018 年 (0.6166), 2019 年 (0.5941), 2020 年 (0.6050)。年际间表现非常稳定。

*   **10.2.4.4 产品间性能指标空间相关性 (基于每年 0.95mm/d 阈值)**
    *   **回顾与CMORPH/CHIRPS/SM2RAIN的关系：** 与CMORPH的POD、FAR、CSI空间相关性均较高。与CHIRPS的FAR空间相关性极高，POD、CSI相关性较高。与SM2RAIN的FAR空间相关性高，但POD、CSI相关性较低。
    *   **与 GSMAP：** POD 相关性中高 (0.42-0.54)，FAR 相关性非常高 (0.96-0.98)，CSI 相关性高 (0.58-0.71)。
    *   **与 PERSIANN：** POD 相关性中高 (0.55-0.65)，FAR 相关性非常高 (0.98-0.99)，CSI 相关性高 (0.72-0.78)。
    *   **总结：** IMERG 在 FAR 的空间分布模式上与所有其他产品都表现出高度一致性。在 POD 和 CSI 方面，与 CMORPH, CHIRPS, GSMAP, PERSIANN 的空间分布模式都有较高程度的相似性，而与 SM2RAIN 的相似性较低。

*   **10.2.4.5 IMERG 年度表现小结**
    *   **整体性能：** IMERG 是一款综合性能较强的产品，其平均 POD 和 CSI 均处于较高水平，尤其是在中低阈值下表现稳健。FAR 控制良好，误报同样呈现局部化特征。
    *   **年际差异：** IMERG 的各项性能指标在年际间均表现出高度的稳定性。2020年在高阈值下的POD保持能力略有优势。
    *   **空间特征：** POD 空间分布通常左偏，大部分区域表现良好。CSI 空间分布相对均匀。FAR 的误报高度集中。
    *   **与其他产品关系：** 在各项性能指标的空间分布上，IMERG 与 CMORPH、PERSIANN、GSMAP、CHIRPS 等传统卫星遥感产品展现出较强的一致性，而与基于土壤湿度反演的 SM2RAIN 在命中和综合评分模式上差异较大。这使得 IMERG 成为一个可靠的基准产品，并且在融合时可以与其他传统产品形成良好的协同。

**10.2.5 GSMAP 产品性能分析**

GSMAP 是另一款重要的全球降雨产品，其在 2016 年至 2020 年间的性能表现如下：

*   **10.2.5.1 POD (命中率) 空间统计特征**
    *   **平均空间 POD 随阈值变化：**
        *   **普遍趋势：** GSMAP 的平均空间 POD 整体水平属于中等偏上，通常在 0.53 到 0.75 之间波动。与其他产品类似，POD 在极低阈值下可能略有上升，之后随阈值增加整体呈现缓慢上升或在高位平稳波动的趋势，这与其他产品在高阈值下POD下降的趋势有所不同，显示出其在探测较高强度降雨方面可能具有一定优势或不同特性。
        *   **2016年：** 从 0.0mm/d 的 0.5554 持续缓慢上升至 0.95mm/d 的 0.6690。
        *   **2017年：** 从 0.0mm/d 的 0.5444 持续缓慢上升至 0.95mm/d 的 0.6690。
        *   **2018年：** 从 0.0mm/d 的 0.5662 持续缓慢上升至 0.95mm/d 的 0.6779。
        *   **2019年：** 从 0.0mm/d 的 0.5389 持续缓慢上升至 0.95mm/d 的 0.6675。
        *   **2020年：** 从 0.0mm/d 的 0.5698 持续缓慢上升至 0.95mm/d 的 0.7450 (2020年在高阈值下POD表现非常突出)。
    *   **空间 POD 离散度 (标准差)：**
        *   **普遍趋势：** GSMAP 的 POD 空间标准差非常小，通常在 0.05 至 0.07 之间，这表明其命中率在全国范围内的空间一致性非常好，是所有分析产品中表现最佳的之一。
        *   **随阈值变化：** 标准差随阈值的变化非常小，整体保持在一个极低的稳定水平。
    *   **空间 POD 分布形态 (偏度、峰度)：**
        *   **偏度：** POD 的空间偏度值在所有年份和阈值下几乎都为**负偏** (通常在 -0.7 到 -0.1 之间)。这表明 POD 空间分布是左偏的，即大部分区域的 POD 表现较好。
        *   **峰度：** POD 的空间峰度值多数情况下为正或接近零（例如，2016年多数在0.0到0.8之间），表明其分布形态与正态分布相似或略尖峭。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 POD 在 2016 年 (0.6073), 2017 年 (0.5929), 2018 年 (0.6127), 2019 年 (0.5903), 2020 年 (0.6353)。年际间波动相对较小，2020年表现最佳。

*   **10.2.5.2 FAR (空报率) 空间统计特征**
    *   **平均空间 FAR：**
        *   **整体水平：** GSMAP 的平均空间 FAR 在所有产品中表现**最优异**，始终保持在极低的水平，通常在 0.0017 到 0.015 之间。这是一个非常显著的优势。
        *   **随阈值变化：** 平均空间 FAR 随着阈值的增加呈现非常缓慢的上升趋势，但即使在高阈值下也远低于其他产品。例如，2016 年从 0.0mm/d 的 0.0025 上升到 0.95mm/d 的 0.0145。
    *   **空间 FAR 中位数：**
        *   与前面分析的产品一致，在所有年份和所有阈值下，GSMAP 的 FAR 空间中位数几乎**始终为 0.0000**。
    *   **空间 FAR 离散度 (标准差)：**
        *   FAR 的空间标准差也极低，通常在 0.007 到 0.05 之间波动，显著低于其他产品。
    *   **空间 FAR 分布形态 (偏度、峰度)：**
        *   **偏度：** GSMAP 的 FAR 空间偏度值同样表现出**极高的正偏** (通常在 4.0 到 5.4 之间)，指示误报具有显著的局部集中性，但其偏度值相较于其他产品可能略低或在相似范围内。
        *   **峰度：** GSMAP 的 FAR 空间峰度值同样表现出**极高的正峰度** (通常在 14 到 30+ 之间)，证实了误报分布的尖峰厚尾特征。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 FAR 在 2016 年 (0.0053), 2017 年 (0.0049), 2018 年 (0.0042), 2019 年 (0.0050), 2020 年 (0.0046)。年际间波动非常小，且始终维持在极低水平。

*   **10.2.5.3 CSI (临界成功指数) 空间统计特征**
    *   **平均空间 CSI：**
        *   **整体水平：** GSMAP 的平均空间 CSI 表现非常出色，通常在 0.53 到 0.65 之间波动，整体优于 CMORPH, CHIRPS，与 IMERG 相当或略优，尤其是在中高阈值下表现稳健。
        *   **随阈值变化：** CSI 随阈值的变化相对平稳，通常在低阈值处达到一个平台期后，在高阈值下也仅有轻微下降或甚至继续小幅上升（如2020年）。例如，2016年从0.0mm/d的0.5454，在0.3-0.5mm/d附近达到约0.596的峰值，之后略降至0.95mm/d的0.5816。这种在高阈值下CSI不明显下降的特性是GSMAP的一个优点。
    *   **空间 CSI 离散度 (标准差)：**
        *   CSI 的空间标准差通常在 0.05 至 0.07 之间，与 IMERG 和 CHIRPS 类似，表明其综合评分在空间上也具有较好的一致性。
    *   **空间 CSI 分布形态 (偏度、峰度)：**
        *   **偏度：** CSI 的空间偏度在所有年份和阈值下几乎都为**负偏** (通常在 -0.8 到 -0.1 之间)。这表明 CSI 空间分布是左偏的，大部分区域表现较好。
        *   **峰度：** CSI 的空间峰度值多数情况下接近0或为正值（如2016年多数在0.0到0.8之间），表明其分布形态与正态分布相似或略尖峭。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 CSI 在 2016 年 (0.5815), 2017 年 (0.5704), 2018 年 (0.5915), 2019 年 (0.5670), 2020 年 (0.6096)。年际间表现相对稳定，2020年表现最佳。

*   **10.2.5.4 产品间性能指标空间相关性 (基于每年 0.95mm/d 阈值)**
    *   **回顾与其他产品的关系：** 与CMORPH的POD、FAR、CSI空间相关性均较高。与CHIRPS的FAR空间相关性极高，POD、CSI相关性较高。与SM2RAIN的FAR空间相关性高，但POD、CSI相关性较低。与IMERG的FAR空间相关性极高，POD、CSI相关性高。
    *   **与 PERSIANN：** POD 相关性较低至中等 (0.22-0.35)，FAR 相关性非常高 (0.96-0.97)，CSI 相关性中高 (0.50-0.67)。
    *   **总结：** GSMAP 在 FAR 的空间分布模式上与所有其他产品都表现出高度一致性。在 POD 和 CSI 方面，与 CMORPH, CHIRPS, IMERG 的空间分布模式都有较高程度的相似性，与 PERSIANN 的 POD 相似性较低但 CSI 相似性尚可，而与 SM2RAIN 的 POD 和 CSI 相似性均较低。

*   **10.2.5.5 GSMAP 年度表现小结**
    *   **整体性能：** GSMAP 最显著的优势在于其**极低的 FAR**，在所有分析产品中误报控制最佳。其 POD 随阈值增加有缓慢上升趋势，CSI 在中高阈值下表现稳健甚至略有提升，显示出良好的综合性能，尤其是在区分中高强度降雨事件上。
    *   **年际差异：** GSMAP 的各项性能指标在年际间表现出较好的稳定性，其中2020年在高阈值下的POD和CSI表现尤为突出。
    *   **空间特征：** POD 和 CSI 的空间分布通常左偏，且空间一致性非常好（标准差小）。FAR 的误报同样高度集中在少数区域，但整体误报水平极低。
    *   **与其他产品关系：** 其误报高发区的空间位置（尽管误报本身很少）与其他产品相似；在综合性能的空间好坏区域分布上，与IMERG、CMORPH等产品有较强的同步性。GSMAP的低FAR特性使其在数据融合中可能扮演关键角色，尤其是在对误报敏感的应用场景。

**10.2.6 PERSIANN 产品性能分析**

PERSIANN 系列产品也是一类常用的历史较久的卫星降雨估算产品。

*   **10.2.6.1 POD (命中率) 空间统计特征**
    *   **平均空间 POD 随阈值变化：**
        *   **普遍趋势：** PERSIANN 的平均空间 POD 整体水平属于中等，通常在 0.58 到 0.69 之间波动。其POD随阈值增加的变化趋势与其他产品（除GSMAP外）类似，即在极低阈值下可能略有上升，之后趋于平稳或缓慢下降。
        *   **2016年：** 从 0.0mm/d 的 0.6326 上升至 0.2-0.4mm/d 区间的约 0.68-0.69，之后缓慢下降至 0.95mm/d 的 0.6596。
        *   **2017年：** 从 0.0mm/d 的 0.5959 上升至 0.35-0.45mm/d 区间的约 0.658-0.659，之后略有下降至 0.95mm/d 的 0.6329。
        *   **2018年：** 从 0.0mm/d 的 0.6197 上升至 0.3-0.45mm/d 区间的约 0.667-0.668，之后在高位波动。
        *   **2019年：** 从 0.0mm/d 的 0.5817 上升至 0.3-0.45mm/d 区间的约 0.64-0.645，之后在高位波动或略降。
        *   **2020年：** 从 0.0mm/d 的 0.6020 上升至 0.4-0.55mm/d 区间的约 0.675-0.678，之后在高位波动或略降。
    *   **空间 POD 离散度 (标准差)：**
        *   **普遍趋势：** PERSIANN 的 POD 空间标准差相对较大，通常在 0.07 至 0.14 之间，表明其命中率在全国范围内的空间差异性较大，是所有分析产品中空间变异性最大的之一（尤其是2016和2019年）。
        *   **随阈值变化：** 标准差随阈值的变化没有非常一致的模式，但整体维持在一个相对较高的水平。
    *   **空间 POD 分布形态 (偏度、峰度)：**
        *   **偏度：** POD 的空间偏度值在不同年份和阈值下正负皆有，但绝对值通常不大（多数在-0.6到0.8之间），表明其空间分布相对接近对称或轻微偏斜。
        *   **峰度：** POD 的空间峰度值多数情况下为负值（通常在-0.9到-0.0之间），表明其分布形态通常比正态分布更平坦。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 POD 在 2016 年 (0.6711), 2017 年 (0.6313), 2018 年 (0.6519), 2019 年 (0.6184), 2020 年 (0.6452)。年际间存在较明显的波动，2016年表现最好，2019年相对较差。

*   **10.2.6.2 FAR (空报率) 空间统计特征**
    *   **平均空间 FAR：**
        *   **整体水平：** PERSIANN 的平均空间 FAR 水平与 CMORPH、CHIRPS、IMERG 相当，通常在 0.010 到 0.03 之间。
        *   **随阈值变化：** 与其他产品类似，平均空间 FAR 随着阈值的增加呈现缓慢上升的趋势。例如，2016 年从 0.0mm/d 的 0.0126 上升到 0.95mm/d 的 0.0301。
    *   **空间 FAR 中位数：**
        *   与前面分析的产品一致，在所有年份和所有阈值下，PERSIANN 的 FAR 空间中位数几乎**始终为 0.0000**。
    *   **空间 FAR 离散度 (标准差)：**
        *   FAR 的空间标准差通常在 0.04 到 0.11 之间波动，与CMORPH、CHIRPS、IMERG在相似的范围内。
    *   **空间 FAR 分布形态 (偏度、峰度)：**
        *   **偏度：** PERSIANN 的 FAR 空间偏度值同样表现出**极高的正偏** (通常在 3.3 到 5.2 之间)，指示误报具有显著的局部集中性。
        *   **峰度：** PERSIANN 的 FAR 空间峰度值同样表现出**极高的正峰度** (通常在 10 到 30+ 之间)，证实了误报分布的尖峰厚尾特征。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 FAR 在 2016 年 (0.0193), 2017 年 (0.0190), 2018 年 (0.0183), 2019 年 (0.0181), 2020 年 (0.0174)。年际间波动非常小，表现出良好的一致性，且有逐年略微下降的趋势。

*   **10.2.6.3 CSI (临界成功指数) 空间统计特征**
    *   **平均空间 CSI：**
        *   **整体水平：** PERSIANN 的平均空间 CSI 通常在 0.44 到 0.55 之间波动，整体水平与CMORPH相当或略低，低于IMERG和GSMAP。
        *   **随阈值变化：** CSI 随阈值的变化趋势通常是先略微上升或保持平稳，然后在较高阈值下逐渐下降。例如，2016年从0.0mm/d的0.5495，在0.05-0.25mm/d附近达到约0.53-0.54的平台期，之后缓慢下降至0.95mm/d的0.4663。
    *   **空间 CSI 离散度 (标准差)：**
        *   CSI 的空间标准差通常在 0.045 到 0.09 之间，其中2016年和2019年的标准差较大，与POD的空间变异性相对应。
    *   **空间 CSI 分布形态 (偏度、峰度)：**
        *   **偏度：** CSI 的空间偏度在不同年份和阈值下多为正值或接近零（例如，2016年多数在0.1到0.3之间），表明其空间分布可能略微右偏或接近对称。
        *   **峰度：** CSI 的空间峰度值多数情况下为负值（通常在-0.6到-0.0之间），表明其空间分布通常比正态分布更平坦。
    *   **年际变化：**
        *   以 0.1mm/d 阈值为例，平均空间 CSI 在 2016 年 (0.5389), 2017 年 (0.5156), 2018 年 (0.5346), 2019 年 (0.5067), 2020 年 (0.5343)。2016年和2018/2020年表现相对较好，2019年表现最差。

*   **10.2.6.4 产品间性能指标空间相关性 (基于每年 0.95mm/d 阈值)**
    *   **回顾与其他产品的关系：** 与CMORPH的POD、FAR、CSI空间相关性均较高。与CHIRPS的FAR空间相关性极高，POD、CSI相关性较高。与SM2RAIN的FAR空间相关性高，但POD相关性极低，CSI相关性中等。与IMERG的FAR空间相关性极高，POD、CSI相关性较高。与GSMAP的FAR空间相关性极高，POD相关性较低，CSI相关性中高。
    *   **总结：** PERSIANN 在 FAR 的空间分布模式上与所有其他产品都表现出高度一致性。在 POD 和 CSI 方面，与 CMORPH, CHIRPS, IMERG 的空间分布模式都有较高程度的相似性。与 GSMAP 的 POD 相似性较低，但 CSI 相似性尚可。与 SM2RAIN 的 POD 相似性极低，但 CSI 相似性中等。

*   **10.2.6.5 PERSIANN 年度表现小结**
    *   **整体性能：** PERSIANN 是一款性能表现中规中矩的产品，其平均 POD 和 CSI 水平与 CMORPH 接近。FAR 控制良好，误报也呈现局部化特征。其 POD 的空间变异性相对较大。
    *   **年际差异：** PERSIANN 的性能在年际间存在一定波动，2016年整体表现稍好，而2019年相对偏弱。FAR逐年有微弱改善。
    *   **空间特征：** POD 的空间一致性较差，是其一个弱点。CSI 空间分布相对平坦。FAR 的误报同样高度集中。
    *   **与其他产品关系：** 其误报高发区的空间位置与其他产品高度相似；在综合性能的空间好坏区域分布上，与多数传统卫星遥感产品有较强的同步性。

**10.3 跨产品横向比较与综合评估**

在对各产品进行逐年逐阈值分析的基础上，本节进行跨产品的横向比较，旨在更清晰地揭示各产品间的相对性能优劣、共性与特性。

*   **10.3.1 总体性能均值对比 (基于多年平均)**

    为了更直观地比较各产品在不同降雨强度下的平均表现，我们选取关键阈值（例如，代表小雨的 0.1 mm/d，代表中等强度关注点的 0.5 mm/d，以及接近常用评估上限的 0.95 mm/d），对各产品在 2016-2020 年间的平均空间 POD, FAR, CSI 进行比较。*(注：由于原始文本未直接给出多年平均值，此处基于对各年数据的观察进行定性总结，后续可补充精确计算值)*

    *   **POD (命中率)：**
        *   **SM2RAIN：** 在所有阈值下，其多年平均空间 POD 均显著高于其他所有产品，通常在 0.85 以上，展现出在“有无降雨”判断上的绝对优势。
        *   **IMERG：** 多年平均空间 POD 表现优异，通常在 0.60-0.75 范围，仅次于 SM2RAIN。
        *   **GSMAP：** 其 POD 随阈值增加而上升的特性使其在高阈值下（如0.95mm/d）的 POD 表现突出，多年平均可能接近或略高于 IMERG 在该阈值下的表现。在低阈值下表现中等偏上。
        *   **CMORPH & PERSIANN：** 两者 POD 水平相当，属于中等水平，通常在 0.50-0.68 范围波动，PERSIANN 某些年份在特定阈值下略高。
        *   **CHIRPS：** 多年平均空间 POD 相对最低，通常在 0.38-0.50 范围。
    *   **FAR (空报率)：**
        *   **GSMAP：** 多年平均空间 FAR 在所有阈值下均表现**最优异**，始终维持在极低水平 (约 0.002-0.015)。
        *   **CMORPH, CHIRPS, IMERG, PERSIANN：** 这四类产品的多年平均空间 FAR 水平相当，均控制在较低水平 (约 0.01-0.03)，略高于 GSMAP，但整体表现良好。它们之间的细微差异不显著。
        *   **SM2RAIN：** 多年平均空间 FAR 略高于其他产品 (约 0.015-0.035)，但考虑到其极高的 POD，这种略高的 FAR 在某些应用场景下可能是可接受的。
    *   **CSI (临界成功指数)：**
        *   **SM2RAIN：** 在**极低阈值 (如 0.0-0.1 mm/d)** 下，其多年平均空间 CSI 表现最佳，显著优于其他产品，通常可达 0.60-0.70+。
        *   **GSMAP & IMERG：** 在**中高阈值 (如 0.5 mm/d 及以上)** 下，这两款产品的多年平均空间 CSI 表现最为出色，通常在 0.50-0.65 范围，GSMAP 可能因其极低的 FAR 而在综合评分上略占优势或在高阈值下更稳定。
        *   **CMORPH & PERSIANN：** 两者的多年平均空间 CSI 水平相当，属于中等水平，通常在 0.45-0.55 范围。
        *   **CHIRPS：** 多年平均空间 CSI 相对最低，通常在 0.35-0.45 范围。

*   **10.3.2 空间稳定性对比 (基于多年平均的空间标准差)**

    评估产品性能在全国范围内的空间一致性。空间标准差越小，表明产品在不同地区的表现越均一。

    *   **POD 空间标准差：**
        *   **GSMAP & CHIRPS：** 这两款产品的 POD 空间标准差多年平均表现最小（约 0.05-0.07），表明其命中率在空间分布上最为均匀。
        *   **IMERG & SM2RAIN：** POD 空间标准差处于中等水平（约 0.07-0.09）。
        *   **CMORPH & PERSIANN：** POD 空间标准差相对较大（约 0.07-0.14，PERSIANN波动更大），表明其命中率在空间上的变异性较大。
    *   **FAR 空间标准差：**
        *   **GSMAP：** FAR 空间标准差最小（约 0.007-0.05），再次印证其误报控制的优异性和空间一致性。
        *   **CMORPH, CHIRPS, IMERG, PERSIANN, SM2RAIN：** 其他产品的 FAR 空间标准差处于相似的较高水平（约 0.03-0.12），表明它们的误报（尽管中位数都为0）在空间上的离散程度相似，即少数高误报区域的离群程度相似。
    *   **CSI 空间标准差：**
        *   **GSMAP, CHIRPS, IMERG：** 这三款产品的 CSI 空间标准差多年平均表现较小（约 0.05-0.07），表明其综合评分在空间上较为均一。
        *   **SM2RAIN：** CSI 空间标准差略高于上述三者（约 0.05-0.08）。
        *   **CMORPH & PERSIANN：** CSI 空间标准差相对较大（约 0.06-0.09，PERSIANN波动更大），与它们 POD 的空间变异性一致。

*   **10.3.3 误报 (FAR) 特征深度对比**

    误报是本项目关注的重点。

    *   **FAR 均值与中位数：**
        *   **GSMAP** 的 FAR 均值显著低于所有其他产品。
        *   所有产品的 FAR **中位数常年为 0**，这表明误报问题在空间上是高度集中的，而非普遍现象。
    *   **FAR 空间偏度和峰度：**
        *   **所有产品**的 FAR 空间分布均呈现**极高的正偏度（右偏）和极高的正峰度（尖峰厚尾）**。这意味着：
            1.  绝大多数地区的误报率非常低（接近于零）。
            2.  存在少数“热点”区域，其误报率远高于平均水平，这些区域是导致整体平均 FAR 上升的主要原因，也是未来误差分析和模型优化的关键靶区。
        *   **CMORPH** 和 **CHIRPS** 的 FAR 偏度和峰度值通常是最高的，表明其误报可能在空间上更为集中于极少数区域，或者这些区域的误报程度更为极端。
        *   **GSMAP** 虽然整体 FAR 最低，但其误报同样呈现高度集中的空间格局。
        *   理解这种空间分布特性对于设计针对性的误报修正策略至关重要。

*   **10.3.4 年际稳定性综合对比**

    评估各产品关键性能指标在 2016-2020 年间的波动幅度。

    *   **POD 均值：** SM2RAIN 的年际稳定性最好；其次是 IMERG, GSMAP, CMORPH；CHIRPS 和 PERSIANN 的年际波动相对较大。
    *   **FAR 均值：** 所有产品的 FAR 均值在年际间都表现出非常高的一致性和稳定性。
    *   **CSI 均值：** SM2RAIN, IMERG, GSMAP 的年际稳定性较好；CMORPH, CHIRPS, PERSIANN 的年际波动相对更明显一些。
    *   **结论：** 在误报控制方面，所有产品都表现出良好的年际稳定性。在命中能力和综合评分方面，SM2RAIN、IMERG 和 GSMAP 的表现更为稳健。

*   **10.3.5 产品间性能空间分布相关性格局**

    总结不同产品在性能指标空间分布模式上的相似性。

    *   **FAR 的空间分布模式高度一致：** 这是一个非常重要的发现。所有六种降雨产品，尽管其物理原理和算法各不相同，但在**误报事件高发的空间区域上表现出惊人的一致性**（FAR指标间的空间相关系数普遍在0.88以上，很多接近0.95）。这强烈暗示这些误报可能与某些共同的、难以准确观测或反演的地理环境因素、特定天气系统或遥感探测的固有局限性有关。
    *   **POD 和 CSI 的空间分布模式：**
        *   **传统卫星产品组 (CMORPH, CHIRPS, IMERG, GSMAP, PERSIANN)：** 这些产品在 POD 和 CSI 的空间分布模式上表现出中高到高度的相关性。这意味着它们往往在相似的区域表现良好，也在相似的区域表现较差。IMERG 通常与其他产品有较高的相关性，可以看作是这个组的一个性能较好的代表。
        *   **SM2RAIN 的独特性：** SM2RAIN 在 POD 和 CSI 的空间分布模式上与其他所有产品均表现出较低的相关性。这再次突显了其基于土壤湿度反演的独特性，其性能好的区域和差的区域可能与其他卫星产品有显著不同。


**10.4 分析总结与关键洞察**

综合以上对各降雨产品逐年逐阈值空间性能统计特征的深度分析以及跨产品的横向比较，可以总结出以下关键规律、洞察和对本项目研究的启示：

*   **10.4.1 各类产品性能指标随降雨阈值变化的普遍规律与独特模式**
    *   **POD (命中率)：**
        *   **普遍规律：** 大多数产品 (CMORPH, CHIRPS, IMERG, PERSIANN) 的 POD 在极低阈值下略微上升后，随阈值增加而平稳或下降。这可能是因为极小阈值包含了更多噪声或微量降水，略微提高阈值有助于识别更确切的降雨事件。
        *   **独特模式：**
            *   **SM2RAIN** 的 POD 始终维持在极高水平，并随阈值增加缓慢下降，显示其对“有无降雨”的判断非常敏感。
            *   **GSMAP** 的 POD 随阈值增加反而呈现缓慢上升或在高位持平的趋势，这表明其在探测中高强度降雨事件方面具有相对优势或不同的响应机制。
    *   **FAR (空报率)：**
        *   **普遍规律：** 所有产品的平均空间 FAR 都随阈值的增加而缓慢上升。这可能是因为随着阈值提高，真实降雨事件的样本量减少，使得少量误报事件在比例计算中更为突出。
        *   **关键特征：** 所有产品的 FAR 空间中位数几乎恒为0，且其空间分布均呈现极高的正偏度和高峰度。这揭示了一个核心现象：**误报并非均匀随机发生，而是高度集中在特定的少数“热点”区域。**
    *   **CSI (临界成功指数)：**
        *   **普遍规律：** 大多数产品的 CSI 在中低阈值达到峰值后，随阈值增加而下降，这反映了 POD 下降在高阈值区间的主导作用。
        *   **独特模式：**
            *   **SM2RAIN** 在极低阈值下的 CSI 表现最佳。
            *   **GSMAP** 的 CSI 在中高阈值下表现稳健，下降趋势平缓，甚至在某些年份（如2020）有所上升，这得益于其持续上升的 POD 和极低的 FAR。

*   **10.4.2 不同产品在命中率、误报控制和综合评分上的优势与劣势区间**
    *   **SM2RAIN：**
        *   **优势：** 极高的 POD（尤其擅长判断有无降雨），在小雨量级（低阈值）下拥有最高的 CSI。年际稳定性极好。
        *   **劣势：** FAR 相对略高于其他产品（尽管仍属低水平）；其 POD 和 CSI 的空间分布模式与其他产品差异大。
    *   **GSMAP：**
        *   **优势：** **FAR 控制最佳，误报率最低**；POD 随阈值增加而上升；CSI 在中高阈值下表现优异且稳定；POD 和 CSI 的空间一致性好。
        *   **劣势：** 在极低阈值下的 POD 和 CSI 不如 SM2RAIN。
    *   **IMERG：**
        *   **优势：** 综合性能强且稳定，POD 和 CSI 均处于较高水平；FAR 控制良好；各项指标的年际稳定性好，空间一致性也不错。
        *   **劣势：** 各项指标均非最优，但没有明显短板。
    *   **CMORPH & PERSIANN：**
        *   **优势：** FAR 控制良好；POD 和 CSI 属于中等水平。
        *   **劣势：** POD 和 CSI 的空间变异性相对较大；年际稳定性一般。PERSIANN 的 POD 空间变异性尤其突出。
    *   **CHIRPS：**
        *   **优势：** FAR 控制良好；POD 和 CSI 的空间一致性好。
        *   **劣势：** POD 和 CSI 的整体水平均相对较低。

*   **10.4.3 产品性能在年际间的共性波动与特性差异，可能的气候影响因素探讨（初步）**
    *   **共性波动：** 虽然各产品有其固有性能水平，但在某些年份，如 2020 年，多数产品（如 CHIRPS, GSMAP, IMERG）的 POD 和/或 CSI 表现均有不同程度的提升，尤其是在较高阈值下。这可能与当年的整体降雨特征（如大范围强降水事件增多）有关，使得产品的探测能力得到更好发挥。相反，在某些年份（如2017或2019年对某些产品而言），性能可能相对偏弱。
    *   **特性差异：** SM2RAIN 和 IMERG 展现出非常好的年际稳定性。而 CHIRPS 和 PERSIANN 的年际波动相对更明显。
    *   **气候影响探讨（初步）：** 年际间的气候背景（如 ENSO 事件、季风强度异常等）可能通过改变降雨类型、强度、空间分布等，从而影响各卫星产品的遥感物理机制和反演算法的适用性，导致性能的年际波动。例如，某年若小雨、层云降水偏多，可能对某些产品的探测构成挑战。

*   **10.4.4 空间异质性表现：哪些产品在全国范围内表现更稳定，哪些产品性能空间差异大**
    *   **空间表现更稳定 (低空间标准差)：**
        *   **GSMAP** 和 **CHIRPS** 在 POD 和 CSI 的空间一致性上表现突出。
        *   **IMERG** 在 CSI 的空间一致性上也表现良好。
        *   所有产品在 FAR 中位数上表现出高度的空间一致性（均为0）。
    *   **空间差异大 (高空间标准差)：**
        *   **CMORPH** 和 **PERSIANN** (尤其是 PERSIANN) 在 POD 和 CSI 上的空间标准差相对较大，表明其性能在不同区域差异显著。
        *   尽管所有产品的 FAR 中位数均为0，但其 FAR 的空间标准差、偏度和峰度均较高，表明少数高误报区域的“离群”程度是普遍存在的。

*   **10.4.5 对特征工程和模型融合策略的启示**
    *   **特征工程：**
        *   **误报热点区域特征挖掘：** 鉴于所有产品 FAR 空间分布的高度相关性和局部集中性，可以重点针对这些误报高发区域，挖掘其独特的地理、气象或产品自身特征（例如，特定地形、特定季节的特定天气系统影响、产品在这些区域的原始反演质量指标等），以期在模型中学习并修正这些系统性偏差。
        *   **产品独特性特征：** SM2RAIN 的性能模式与其他产品差异显著，其数据或基于其数据衍生的特征（如土壤湿度相关的特征）可能为融合模型提供独特的、其他产品难以捕捉的信息，尤其是在小雨和降雨启动阶段。
        *   **阈值依赖特征：** 不同产品在不同降雨强度（阈值）下的表现各异，可以考虑设计随降雨强度变化的特征权重，或构建针对不同强度区间的子模型。
    *   **模型融合：**
        *   **优势互补：**
            *   可考虑在小雨量级（低阈值）预测时赋予 SM2RAIN 更高权重。
            *   在需要严格控制误报的应用中，GSMAP 的权重应较高。
            *   IMERG 作为综合性能稳健的产品，可作为融合模型的坚实基础。
        *   **空间适应性融合：** 考虑到 CMORPH 和 PERSIANN 性能的空间变异性较大，如果计算资源允许，可以探索分区建模或地理加权融合策略，即在不同区域赋予不同产品组合或权重。
        *   **FAR 修正模型：** 鉴于 FAR 的高度局部化，可以考虑训练一个专门的“误报识别与修正”子模型（类似项目中已探索的 FP 专家模型），该模型可以利用所有产品在误报高发区的共性特征进行学习。

*   **10.4.6 未来研究方向建议**
    *   **误报/漏报成因的精细化地理诊断：** 结合高分辨率地形、土地利用、气候分区以及典型天气过程分析，深入探究导致各产品（尤其是共性）误报和漏报高发区的具体物理机制。
    *   **极端降雨事件的评估：** 本分析主要基于0-1mm/d的阈值，未来可扩展到更高阈值，专门评估各产品对暴雨等极端降雨事件的探测能力和空间特征。
    *   **不同季节性能差异：** 分析各产品在不同季节（如汛期 vs. 非汛期，夏季 vs. 冬季）的性能表现差异。
    *   **动态融合策略研究：** 基于实时气象条件、产品自身质量控制信息等，开发动态调整各产品融合权重的先进算法。
    *   **不确定性量化：** 不仅评估确定性预报性能，还需关注各产品及融合结果的不确定性量化。
