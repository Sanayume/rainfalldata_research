# rainfalldata_research
# 高分辨率降雨融合与机器学习预测研究项目

## 1. 项目概述与研究意义

**背景:** 精准的降雨预测对于洪水预警、农业生产、水资源管理等领域至关重要。然而，单一数据源往往存在时空覆盖不完整、精度不足等问题。本项目旨在应对这一挑战，通过 **融合多种先进的卫星遥感降雨产品** (CMORPH, CHIRPS, GSMAP, IMERG, PERSIANN, SM2RAIN) 与 **地面观测融合数据** (CHM)，结合 **前沿的机器学习技术**，探索和构建高性能、高分辨率的降雨预测模型。

**目标:**
*   开发一套稳健的数据处理与融合流程，有效整合多源异构降雨数据。
*   设计并实现大规模、多维度的特征工程体系，深度挖掘数据中蕴含的降雨相关信息。
*   系统性地评估和优化多种机器学习模型（特别是梯度提升树如 XGBoost, LightGBM，并辅以贝叶斯方法等）在降雨预测任务上的性能。
*   深入分析模型误差，理解预测偏差来源，并驱动特征和模型的迭代优化。
*   针对重点区域（如长江流域）进行精细化建模，探索区域适应性预测策略。
*   重点提升在于降雨的命中率误报率以及临界成功指数, 主要看误报率是否有突破

**核心价值:** 本项目不仅致力于提升降雨预测精度，也深入探索了数据融合、特征工程和机器学习在复杂气象问题中的应用潜力，为相关领域的研究和应用提供方法论参考和技术积累。

## 2. 项目技术架构与实施细节

### 2.1 数据体系 (`data/`)

*   **多源数据整合:**
    *   **原始数据 (`raw/`)**: 涵盖 CMORPH, CHIRPS, GSMAP, IMERG, PERSIANN, SM2RAIN, CHM 等 **7 种主流降雨产品** 的原始数据（如 `.nc`, `.zip` 格式），时间跨度覆盖 **多年** (例如 2016-2020 年数据被重点处理)，空间分辨率各异，总数据量达到 **数十 GB 甚至 TB 级别**。相关的初步读取脚本位于 `src/readdata/` 目录下，例如 `CHM.py`, `CMORPH.py` 等。
    *   **挑战**: 处理不同产品的格式差异、坐标系统、时间分辨率不一致等问题。
*   **精细化预处理 (`intermediate/`, `processed/`)**:
    *   **NaN 值处理**: 实施了系统的缺失值处理流程，结合了 **时空插值方法** 与 **阈值替换策略**，确保数据完整性。处理后的数据按产品和年份存储 (`intermediate/`)，并最终生成用于模型输入的合并时间序列 `.mat` 文件 (`processed/`)。
    *   **空间掩码**: 生成并应用了中国大陆及主要流域（如长江流域）的高精度地理掩码 (`processed/.../masks/`)，以精确提取研究区域数据。
    *   **标准化与对齐**: 进行了必要的时间和空间分辨率对齐操作。

### 2.2 特征工程 (主要代码位于 `src/nationwide/project_all_for_deepling_learning/turn*.py`, `src/yangtze/YangTsu/turn*.py`)

构建了一个 **包含数百个潜在特征** 的大规模特征库，体现了对降雨物理机制和数据驱动模式的深度理解：

*   **基础信息**: 各降雨产品在目标点的原始降雨量。
*   **多产品协同**: 利用产品间的统计关系（均值、标准差、中位数、极差、一致降雨产品数）来 **量化不同产品的一致性与不确定性**，这是单一产品分析无法实现的。
*   **时序动态捕捉**:
    *   **周期性**: 采用正余弦函数编码年内周期、季节性虚拟变量等捕捉季节变化规律。
    *   **记忆性**: 引入 **多尺度时间滞后项** (t-1, t-2, t-3 天等) 捕捉降雨的持续性和短期依赖。
    *   **变化率**: 计算 **时间差分** 特征捕捉降雨强度的变化趋势。
    *   **累积效应**: 设计了 **多窗口滑动统计** (如 3, 7, 15 天窗口的均值、标准差、最值、范围) 以捕捉不同时间尺度下的降雨累积和波动特征。
*   **空间关联**: 引入 **3x3 邻域** 的空间统计量（均值、标准差、最大值）及其与中心点的差异，以 **刻画降雨事件的空间展布和局部梯度**。
*   **弱信号增强**: 特别设计了针对 **毛毛雨、小雨等低强度降雨** 的探测特征（如距 0.1mm 阈值距离、变异系数 CV、特定强度分箱），旨在提升模型对这类易被忽略但重要的降雨事件的敏感度。
*   **高阶交互**: 探索性地构建了 **交互特征** (如 `产品标准差 * 季节性因子`)，试图捕捉非线性、多因素耦合的复杂降雨模式。
*   **迭代优化**: 特征集经历了 **至少 5 个主要版本 (`v1` 到 `v5.1`) 的迭代** (具体体现在 `src/nationwide/project_all_for_deepling_learning/turn1.py` 至 `turn5_1.py` 以及 `src/yangtze/YangTsu/turn1.py` 至 `turn5_1.py` 等脚本中，结果存储于 `results/.../features/`)，每一版本的调整都基于前一轮的模型评估和误差分析结果，体现了 **数据驱动的特征选择和优化** 过程。

### 2.3 机器学习建模 (主要代码位于 `src/nationwide/project_all_for_deepling_learning/`, `src/yangtze/YangTsu/`, `src/ensemble_learning/ensemble_learning/`)

系统性地探索和评估了多种先进的机器学习模型：

*   **主力模型**:
    *   **XGBoost / LightGBM**: 作为业界领先的梯度提升树模型，重点用于追求高预测性能，并针对性地调整了目标函数和评估指标。相关脚本包括 `src/nationwide/project_all_for_deepling_learning/xgboost*.py`, `lightGBM1.py` 以及长江流域对应的 `src/yangtze/YangTsu/xgboost*.py`。
*   **辅助与对比模型**:
    *   **Naive Bayes**: 作为基准模型之一，用于快速评估特征效果。相关脚本如 `src/nationwide/project_all_for_deepling_learning/naive_bayes*.py`。
    *   **Bayesian Network**: 探索结合 **专家先验知识** 与数据驱动学习的可能性，特别用于 FP/FN 样本的分析和建模，如 `src/nationwide/project_all_for_deepling_learning/bayesian_network_fp_expert.py` 和 `src/ensemble_learning/ensemble_learning/` 中的相关脚本。
*   **自动化超参数优化**: 广泛应用 **Optuna** 框架，对 XGBoost 和 Naive Bayes 等模型的 **关键超参数** 进行了系统的优化。相关脚本如 `src/nationwide/project_all_for_deepling_learning/xgboost3_optuna.py`, `naive_bayes1_optuna.py`。
*   **性能加速**: 积极探索 **GPU 加速** 技术 (相关探索代码位于 `src/legacy/` 目录，如 `cuda_train.py`, `xgboost_cuda_training.py`)，利用 CUDA 环境优化训练过程，以应对大规模数据和复杂模型的计算挑战。
*   **集成学习探索**: 进行了集成学习的实践，包括训练基模型、FP/FN 专家模型及元学习器等步骤，具体脚本位于 `src/ensemble_learning/ensemble_learning/` 目录下 (例如 `1_generate_base_predictions.py` 至 `5_train_evaluate_meta_learner.py`)，旨在结合多个模型的优势，进一步提升预测稳定性和准确性。
*   **版本化管理**: 严格保存了 **不同版本、不同参数配置** 下训练得到的模型文件 (`.joblib`, `.pkl` 存储于 `results/.../models/`)，便于追溯和比较。

### 2.4 全方位评估与诊断 (主要分析脚本位于 `src/nationwide/analysis/`, `src/nationwide/project_all_for_deepling_learning/feature_of_FP_FN.py`, `src/yangtze/YangTsu/feature_of_FP_FN_Yangtsu.py`)

建立了全面的模型评估和诊断体系，远超标准指标评估：

*   **标准指标**: Accuracy, Precision, Recall, F1-score, ROC AUC 等。
*   **气象相关指标**: 可能探索了如 Heidke Skill Score (HSS), Equitable Threat Score (ETS) 等专业评分。
*   **训练过程监控**: 可视化并分析 **训练/验证损失曲线**，判断模型拟合状态。
*   **特征重要性分析**: 利用模型内置方法（如 SHAP 值或 Gini 不纯度）量化和排序 **特征贡献度**，理解模型决策依据。
*   **特征相关性研究**: 计算并可视化 **特征间的相关系数矩阵**，识别冗余特征，并对比不同特征集 (`v1` vs `v2`) 的差异。相关脚本如 `src/nationwide/analysis/analyze_feature_sets_v1_v2.py`, `analyze_correlations_v1.py`。
*   **误差空间分布**: 绘制 **预测误差（如偏差、均方根误差）的空间分布图**，识别模型表现的地理差异和薄弱区域。
*   **误差时间演变**: 分析误差的 **季节性变化和月度趋势**。
*   **误报/漏报 (FP/FN) 深度诊断**:
    *   识别 **FP/FN 事件高发的热点区域**。
    *   **专门分析 FP/FN 样本对应的特征分布** (通过 `src/nationwide/project_all_for_deepling_learning/feature_of_FP_FN.py` 和长江流域的 `src/yangtze/YangTsu/feature_of_FP_FN_Yangtsu.py` 及 `feature_of_FP_FN_Yangtsu_Mean.py` 等脚本)，反向推断导致预测错误的关键因素，为特征工程优化提供直接依据。
*   **预测阈值敏感性分析**: 系统评估不同 **分类阈值** 对 Precision, Recall 等指标的影响，为实际应用选择最佳阈值提供依据。

## 3. 项目研发历程与关键节点 (深度剖析)

本项目从零起步，经历了从理论学习到复杂系统实现、从全国宏观到区域精细的完整研发周期，充分展现了研究者在跨学科知识融合、大规模数据处理、前沿算法应用和系统性问题解决方面的综合能力。关键节点与活动深度剖析如下：

-   **阶段一：理论奠基与技术预研 (2024年底)**
    *   **跨学科知识储备**: 面对降雨预测这一复杂交叉领域，进行了 **广泛而深入的文献调研**，系统学习了大气科学基础、卫星遥感原理、机器学习/深度学习核心算法（特别是梯度提升、时间序列分析、集成学习等），以及 Python 数据科学生态（Numpy, Pandas, Scipy, Matplotlib 等）。**目标是建立坚实的理论基础，理解问题本质**。
    *   **多源数据理解与挑战识别**: 获取部分早期数据后，投入大量时间 **解析多种卫星产品**（CMORPH, CHIRPS 等）的 **数据格式 (NetCDF, GRIB, HDF等)、投影方式、时空分辨率差异以及各自的优缺点**。识别出 **数据融合、时空对齐、缺失值处理** 等核心技术挑战。
    *   **技术可行性探索与环境搭建**: 搭建了基于 Python 的数据分析与机器学习环境。针对小规模数据子集，**编写了原型脚本** 进行数据读取 (如使用 `xarray`, `netCDF4`)、基础可视化和预处理流程的 **初步验证**，为后续大规模处理积累了宝贵经验，并验证了技术路线的可行性。

-   **阶段二：数据壁垒攻克与基线建立 (2025年1月中旬 - 2月底)**
    *   **全量数据获取与管理**: 成功获取 **覆盖多年、多源的 TB 级完整数据集**，并建立了初步的数据管理方案。
    *   **大规模并行预处理流程设计与实现**: 面对海量数据，设计并实现了 **高效的预处理流程**，关键环节包括：
        *   **地理空间处理**: 利用 `geopandas`, `rasterio` 等库，实现了从全球数据中 **精确、高效地裁剪中国区域** 数据。
        *   **时空对齐**: 开发算法将不同来源、不同分辨率的数据 **插值/重采样到统一的时空网格**，确保后续特征工程和模型输入的有效性。
        *   **智能 NaN 值处理**: 针对降雨数据特性，设计了 **结合时空插值和阈值替换的多阶段 NaN 处理策略**，最大程度保留有效信息，并将处理结果固化为标准化的 `.mat` 文件。
    *   **数据驱动的理解深化**: 对预处理后的各产品数据进行了 **统计分析和可视化对比** (如绘制偏差图、相关性图、季节分布图)，**量化了产品间的差异和一致性**，为后续特征工程和模型选择提供了关键洞见。
    *   **模型技术栈拓展**: 在掌握基础 ML 理论后，开始深入学习 **LSTM 等深度学习模型** 在处理时空序列数据方面的潜力，并调研其在气象领域的应用。
    *   **基线模型快速迭代 (2月底)**: **快速实现了** 包括 XGBoost、LSTM 及基础 MLP 在内的 **多种基线模型**，进行了初步训练和评估。**目的不仅是测试模型效果，更是为了打通整个 "数据-特征-模型-评估" 的流程**，识别瓶颈。

-   **阶段三：核心算法精通与特征体系构建 (2025年3月中旬 - 4月初)**
    *   **核心模型聚焦**: **超越库调用层面**，深入研究了 XGBoost 的 **原理（梯度提升、正则化、分裂算法等）、核心参数含义、调优技巧以及如何针对不平衡数据调整目标函数/评估指标**。
    *   **关键库能力强化**: **系统性地掌握了 scikit-learn** 的核心模块（`Pipeline`, `Preprocessing`, `Metrics`, `Model Selection` 等）和 **PyTorch** 的基础（张量操作、自动微分、模型构建），为复杂模型实现和高效实验奠定基础。
    *   **文献驱动的特征工程设计**: 结合第二阶段的数据分析结果和 **对领域文献的深入研读**，**系统性地设计了多维度特征体系** (详见 2.2 节)，**从理论层面确保了特征的科学性和有效性**。
    *   **问题形式化与基准确立**: **清晰地将任务解构** 为降雨分类和回归两个子问题，并 **严谨地选择 CHM 数据作为参照真值 (Y)**，为后续模型评估提供了统一、可靠的基准。

-   **阶段四：实验迭代、性能优化与区域聚焦 (2025年4月)**
    *   **特征工程"炼金术" - 高速迭代与验证**: 进入 **高强度实验迭代周期**，基于 **模型性能反馈和误差分析**，快速实现、测试并优化了 **至少 5 个核心版本的特征集 (`v1`->`v5.1`)**。**证明了研究者具备快速试错、数据驱动决策和高效实现复杂特征的能力**。特征维度和复杂度显著提升。
    *   **自动化超参数寻优**: 引入并 **熟练运用 Optuna** 对 XGBoost, LightGBM 等模型进行 **系统的贝叶斯超参数优化**，**显著提升了调参效率和模型性能上限**，避免了手动调参的低效和盲目性。
    *   **创新性误差修正 - FP/FN 专家集成模型**: 针对降雨分类中 **误报 (FP) 和漏报 (FN) 的不对称性及关键影响**，**创新性地设计并初步实现了基于误差分析的集成策略**：利用贝叶斯网络等模型 **专门训练识别 FP 和 FN 样本的"专家"**，旨在 **靶向性地提升分类器的 POD, FAR 等关键业务指标**，体现了在模型层面解决实际问题的能力。
    *   **空间异质性洞察与分区建模探索**: 通过误差分析敏锐地 **识别出模型性能的空间异质性**，认识到单一全局模型的局限性，**前瞻性地启动了分区建模** 的探索。
    *   **长江流域精细化研究快速启动 (4月底)**: **高效地将全国范围的分析框架和代码复用并适配到长江流域**，快速完成了区域掩码生成、数据提取、特征工程和初步建模，**展现了研究流程的模块化和可扩展性**。

-   **阶段五：系统重构与知识沉淀 (2025年5月初至今)**
    *   **工程化重构**: **投入大量精力** 对之前快速迭代过程中产生的代码和文件进行 **全面的结构化重构**，**遵循了良好的软件工程实践**，建立了清晰、模块化的项目结构，**极大地提升了代码的可读性、可维护性和未来协作的可能性**。
    *   **系统性总结与文档化**: **全面梳理和总结** 了项目的背景、方法、过程、成果、挑战与未来方向，**形成了高质量、细节丰富的 README 文档**，完成了项目知识的沉淀与展示。

## 4. 项目可持续性与未来展望

本项目已奠定坚实的基础，并展现出强大的可持续发展潜力：

1.  **代码库完善与标准化**:
    *   **【近期重点】** 完成 `src/` 目录下所有脚本的 **文件路径更新**，确保代码在新结构下无缝运行。
    *   将核心功能（特别是数据加载、特征工程、模型训练）**封装为可复用的 Python 模块或包**，提升代码质量和易用性。
    *   **完善文档**: 补充详细的 `README.md`（包括环境设置、数据说明、运行指令）、代码内注释和必要的技术文档。
2.  **区域化研究深化**:
    *   深入对比长江流域与全国范围的模型表现和关键特征差异。
    *   可 **扩展到其他重要流域或气候区**，进行模型迁移性和适应性研究。
    *   考虑引入更高分辨率的 **地形地貌数据 (DEM)** 等地理因子，增强区域模型的精度。
3.  **特征工程与模型前沿探索**:
    *   **特征**: 探索更复杂的时空特征（如 ConvLSTM 提取的时空模式）、引入大气环流因子、探索基于物理过程的特征构建。
    *   **模型**: 深入研究 **深度学习模型** (如 CNN, Transformer, ConvLSTM) 在该任务上的应用；探索 **可解释性 AI (XAI)** 技术增强模型透明度；进一步优化 **集成学习** 策略；尝试 **多任务学习** 或 **迁移学习**。
4.  **应用潜力与拓展 (详细展望)**:
    *   **构建业务化准实时预测系统**:
        *   **目标**: 将当前离线模型框架改造为能够 **接近实时** (例如，每日或每几小时更新) 处理最新卫星数据并输出预测结果的业务化系统。
        *   **技术挑战**: 解决 **数据获取延迟**、**大规模数据流处理**、**计算效率** (需要更快的特征计算和模型推理) 等工程难题。可能需要引入流处理框架 (如 Kafka, Flink) 和更高效的计算架构。
        *   **潜在应用**: 为 **短临强降雨预警**、**山洪灾害风险评估**、**城市内涝管理**、**实时农业灌溉决策** 等提供关键技术支撑，具有显著的社会经济效益。
    *   **极端降雨事件预测能力强化**:
        *   **目标**: 针对 **暴雨、持续性强降水** 等致灾性强的极端事件，显著提升模型的 **预报预警能力 (尤其是提前量和准确率)**。
        *   **技术路径**:
            *   **数据层面**: 重点分析极端事件样本，可能需要采用 **过采样/欠采样** 或 **合成数据生成 (如 SMOTE)** 技术来处理样本不平衡问题。
            *   **特征层面**: 挖掘与极端事件更相关的 **大尺度环流背景特征**、**不稳定能量指标** 等。
            *   **模型层面**: 探索 **代价敏感学习 (Cost-Sensitive Learning)**，赋予极端事件样本更高的错分代价；研究 **异常检测 (Anomaly Detection)** 算法用于识别极端信号；设计 **针对极端事件优化的损失函数**。
        *   **价值**: 直接服务于国家防灾减灾需求，减少极端天气事件带来的生命财产损失。
    *   **与下游应用模型深度耦合**:
        *   **目标**: 将本项目输出的 **高精度、高分辨率降雨预测场** 作为 **驱动数据**，输入到其他相关领域的应用模型中，提升下游模型性能。
        *   **耦合实例**:
            *   **水文模型**: 驱动 **流域水文模型** (如 SWAT, HEC-HMS)，进行更精准的 **径流模拟、洪水演进预测** 和水库调度优化。
            *   **农业模型**: 耦合 **作物生长模型** (如 DSSAT, WOFOST)，进行更准确的 **作物产量预估、病虫害风险评估** 和灌溉需水预测。
            *   **地质灾害模型**: 为 **滑坡、泥石流** 等降雨诱发型地质灾害的风险评估模型提供更可靠的降雨输入。
        *   **价值**: 打破领域壁垒，通过提供高质量的基础气象数据输入，**赋能** 其他相关领域的模型预测能力和应用水平。
    *   **不确定性量化与概率预报**:
        *   **目标**: 不仅提供确定性的降雨预测值，还要提供 **预测结果的不确定性信息**，即输出 **概率预报** (例如，未来 1 小时降雨量超过 5mm 的概率)。
        *   **技术路径**: 探索 **贝叶斯深度学习**、**模型集成 (Ensemble)** 方法（如 Monte Carlo Dropout）、**分位数回归 (Quantile Regression)** 等技术来量化模型预测的不确定性。
        *   **价值**: 为决策者提供更全面的风险信息，支持基于概率的风险管理和决策制定。
        *   **数据同化应用探索**:
            *   **目标**: 将模型的预测结果或提取的关键特征 **反馈** 到数值天气预报 (NWP) 模型或数据同化系统中，**改进 NWP 模式的初始场或物理过程参数化方案**，形成双向促进。
            *   **技术路径**: 需要深入理解数据同化理论（如集合卡尔曼滤波 EnKF, 3DVar/4DVar），研究如何将机器学习输出有效融入同化框架。
            *   **价值**: 探索机器学习与传统数值预报结合的新范式，有望从更根本的层面提升天气预报能力。
5.  **工程实践**:
    *   **引入 Git 进行版本控制**: 强烈建议立即实施，规范管理代码和实验历史。
    *   **构建自动化流水线 (Pipeline)**: 利用 Airflow, Kubeflow 等工具实现数据处理、特征工程、模型训练、评估的自动化流程。

**结论:** 本项目在多源降雨数据融合、大规模特征工程、机器学习建模与深度诊断方面开展了系统性的研究和实践，取得了丰富的阶段性成果，并已构建了一个可持续发展、潜力巨大的研究框架。项目展现了研究者在处理复杂气象数据、应用先进机器学习技术以及系统性解决科学问题方面的综合能力。

## 5. 项目目录结构说明

本项目采用以下目录结构进行组织和管理：

*   **`.git/`**: Git 版本控制系统目录，包含所有版本历史和分支信息。
*   **`data/`**: 存放项目所需的所有数据。
    *   `raw/`: 存储从原始数据源下载的未处理数据，如 CMORPH, CHIRPS, GSMAP, IMERG, PERSIANN, SM2RAIN, CHM 等产品的 `.nc`, `.zip` 文件。
    *   `intermediate/`: 存储经过完整预处理流程（如 NaN 值填充、时空对齐、掩码应用）后，可直接用于模型输入的最终数据每一年或者连续5年的数据。主要用于训练或者特征工程处理的适合从这里加载，这里的数据就经过空间对齐操作的中国地区0.25分辨率144*256矩阵的数据，只有在中国mask区域上的点有值不在中国区域mask上的点为nan。文件为：
        ```
        CMORPHdata/
            -a----          1/3/2025  10:53 pm       53969088 CMORPH_2016.mat
            -a----          5/3/2025   5:18 pm      269402304 CMORPH_2016_2020.mat
            -a----          1/3/2025  10:53 pm       53821632 CMORPH_2017.mat
            -a----          1/3/2025  10:53 pm       53821632 CMORPH_2018.mat
            -a----          1/3/2025  10:53 pm       53821632 CMORPH_2019.mat
            -a----          1/3/2025  10:53 pm       53969088 CMORPH_2020.mat
        CHIRPSdata/
            -a----          2/3/2025  11:19 am      107937984 chirps_2016.mat
            -a----          5/3/2025   4:30 pm      538804416 chirps_2016_2020.mat
            -a----          2/3/2025  11:19 am      107643072 chirps_2017.mat
            -a----          2/3/2025  11:19 am      107643072 chirps_2018.mat
            -a----          2/3/2025  11:19 am      107643072 chirps_2019.mat
            -a----          2/3/2025  11:20 am      107937984 chirps_2020.mat
        CHMdata/
            -a----          4/3/2025   8:44 pm      107937984 CHM_2016.mat
            -a----          4/3/2025   8:54 pm      538804416 CHM_2016_2020.mat
            -a----          4/3/2025   8:47 pm      107643072 CHM_2017.mat
            -a----          4/3/2025   8:49 pm      107643072 CHM_2018.mat
            -a----          4/3/2025   8:51 pm      107643072 CHM_2019.mat
            -a----          4/3/2025   8:53 pm      107937984 CHM_2020.mat
        IMERGdata/
            -a----          4/3/2025   9:04 pm      107937984 IMERG_2016.mat
            -a----          4/3/2025   9:16 pm      538804416 IMERG_2016_2020.mat
            -a----          4/3/2025   9:07 pm      107643072 IMERG_2017.mat
            -a----          4/3/2025   9:10 pm      107643072 IMERG_2018.mat
            -a----          4/3/2025   9:13 pm      107643072 IMERG_2019.mat
            -a----          4/3/2025   9:16 pm      107937984 IMERG_2020.mat
        sm2raindata/
            -a----          2/3/2025  10:44 am      107937984 sm2rain_2016.mat
            -a----          5/3/2025   5:18 pm      538804416 sm2rain_2016_2020.mat
            -a----          5/3/2025   5:12 pm      538804416 sm2rain_2016_2020processed.mat
            -a----          2/3/2025  10:46 am      107643072 sm2rain_2017.mat
            -a----          2/3/2025  10:49 am      107643072 sm2rain_2018.mat
            -a----          2/3/2025  10:52 am      107643072 sm2rain_2019.mat
            -a----          2/3/2025  10:54 am      107937984 sm2rain_2020.mat
        PERSIANNdata/
            -a----          1/3/2025  10:14 pm       53969088 PERSIANN_2016.mat
            -a----          1/3/2025  10:15 pm      269402304 PERSIANN_2016_2020.mat
            -a----          1/3/2025  10:14 pm       53821632 PERSIANN_2017.mat
            -a----          1/3/2025  10:14 pm       53821632 PERSIANN_2018.mat
            -a----          1/3/2025  10:15 pm       53821632 PERSIANN_2019.mat
            -a----          1/3/2025  10:15 pm       53969088 PERSIANN_2020.mat
        GSMAPdata/
            -a----          2/3/2025   8:47 pm      107937984 GSMAP_2016.mat
            -a----          2/3/2025   8:57 pm      538804416 GSMAP_2016_2020.mat
            -a----          2/3/2025   8:50 pm      107643072 GSMAP_2017.mat
            -a----          2/3/2025   8:52 pm      107643072 GSMAP_2018.mat
            -a----          2/3/2025   8:55 pm      107643072 GSMAP_2019.mat
            -a----          2/3/2025   8:57 pm      107937984 GSMAP_2020.mat
        ```
    *   `processed/`: 初步数据处理尝试生成的文件，基本已经弃用。
    *   `mask/` : 储存从全球数据中选取出中国区域以及从中国区域中选出长江流域的掩码矩阵，为`.mat`文件，数据键值为`"data"`，大小为144*256大小矩阵。目前矩阵中有三类值(0, 1, 2)：大于等于1的值掩码出中国版图，大于等于2的值掩码出长江流域。
*   **`docs/`**: 存放项目相关的各类文档。
    *   `functions_reference.md`: 项目中重要函数的参考说明。
    *   `降雨预测模型优化方法_.pdf`: 关于模型优化的详细 PDF 文档。
    *   (可能包含其他设计文档、研究报告等)
*   **`logs/`**: 存放项目运行过程中产生的日志文件。
    *   `feature_names_v5_1.txt`, `feature_names_v5.txt`, `feature_names_v4.txt`, `feature_names_v3.txt`, `feature_names_v2.txt`, `feature_names.txt`: 不同版本特征工程所使用的特征列表。
    *   `training_log.txt`: 主要模型训练过程的详细日志。
    *   `continued_training_log.txt`: 继续训练过程的日志 (当前为空)。
    *   `fine_tuned_train_log.txt`: 微调训练过程的日志 (当前为空)。
    *   `fine_tuning_log.txt`: 微调过程的日志 (当前为空)。
    *   `distributed_training_log.txt`: 分布式训练过程的日志 (当前为空)。
*   **`models/`**: 存放训练完成的机器学习模型文件及相关产出。
    *   `xgboost_model_YYYYMMDD_HHMMSS.json` (例如 `xgboost_model_20250405_234933.json`): XGBoost 模型保存文件，通常以时间戳命名。
    *   `xgboost_foldX_YYYYMMDD_HHMMSS.json`: 交叉验证中特定折数的 XGBoost 模型。
    *   `xgboost_3days_pca_YYYYMMDD_HHMMSS.json`: 经过 PCA 处理的特征训练的 XGBoost 模型。
    *   `best_model.pth`, `best_weights.pth`, `best_rainfall_model.pth`, `best_rainfall_model_cuda.pth`: PyTorch 格式保存的模型文件或权重。
    *   `prediction_results.csv`: 模型在测试集上的详细预测结果。
    *   `prediction_scatter.png`: 预测值与真实值的散点图。
    *   `training_history.csv`: 模型训练过程中的指标记录。
    *   `training_visualization.png`, `cuda_training_metrics.png`: 训练过程指标的可视化图表。
    *   `training_report.txt`: 简要的训练报告。
    *   `cuda_training_history.npz`, `cuda_metrics_history.csv`: 使用 CUDA 训练时的历史和指标记录。
    *   `continued/`: 存放继续训练得到的模型及报告。
        *   `best_weights.pth`, `best_model.pth`: 继续训练后的模型。
        *   `training_report.txt`: 继续训练的报告。
    *   `fine_tuned/`: (预期存放) 微调训练得到的模型 (当前为空)。
*   **`notebooks/`**: 存放用于探索性数据分析、原型验证、可视化等的 Jupyter Notebooks 或相关学习材料。
    *   `book.md`, `book.pdf`: 可能为项目方法论或背景知识的文档。
    *   `ml_tutorial.md`, `ml_tutorial.pdf`: 机器学习相关的教程材料。
    *   `wordpress.md`, `wordpress.pdf`: 与 Wordpress 相关的文档或教程 (具体关联需确认)。
*   **`results/`**: 存放模型训练、评估和分析产生的结果文件 (此目录下的 `models/` 子目录与顶层 `models/` 目录可能存在分工或历史版本)。
    *   `features/`: 存储不同版本迭代生成的特征集文件。
    *   `models/`: 存储训练好的模型文件（`.joblib`, `.pkl` 等）。
    *   `plots/`: 存储评估过程中生成的各类图表，如特征重要性图、误差分布图、损失曲线等。
    *   `predictions`: 储存模型的预测值
*   **`scripts/`**: 存放一些辅助性的脚本。
    *   `utils/`: 通用工具脚本。
        *   `safe_handlers.py`: 可能包含处理文件或数据时的安全操作函数。已废弃停用。
        *   `encoding_fix.py`: 用于修正或处理不同文件编码问题的脚本。已废弃停用
        *   `torch_safe_load.py`: 安全加载 PyTorch 模型或数据的工具。已废弃停用
        *   `safe_unicode.py`: 处理 Unicode 编码安全的工具。已废弃停用
        *   `memory_utils.py`: 内存管理相关的辅助函数 (当前为空)。已废弃停用
        *   `font_helper.py`: 字体处理相关的辅助脚本，可能用于绘图。已废弃停用
        *   `visualization_helper.py`: 可视化相关的辅助函数。已废弃停用
        *   `gpu_utils.py`: GPU 使用相关的辅助函数，如设备选择、内存监控等。已废弃停用
        *   `scale_utils.py`: 数据缩放或尺度转换相关的工具。在从原始数据中进行空间对齐操作中使用,因为原始6个产品的空间分辨率不一致，部分是0.1°部分为0.25°, 本工具将对全部数据空间对齐至0.25°以便于后续的数据分析处理以及训练
    *   `mask_creation`: 创建地理掩码的脚本。
    *   `ReadGsmapG01d25y0820.m`: 读取特定格式 GSMAP 数据的 MATLAB 脚本。
*   **`src/`**: 核心源代码目录。
    *   `common/`: 通用模块。
        *   `feature_engineering/`: (预期存放) 通用的特征工程函数和类 (当前为空)。
    *   `ensemble_learning/`: 集成学习相关代码,目前停止维护，特征工程尚未完善
        *   `ensemble_learning/`: 具体的集成学习流程脚本。
            *   `1_generate_base_predictions.py`: 生成基础模型的预测结果。
            *   `2_train_fn_expert.py`: 训练专门识别漏报 (FN) 的专家模型, level1, 使用基础模型的预测结果以及预测结果中对于漏报事件的索引标签为特征训练的模型, 并未学习到原有基础模型中对于漏报事件
            *   `3_train_fp_expert.py`: 训练专门识别误报 (FP) 的专家模型, level1, 使用基础模型的预测结果以及预测结果中的误报事件的索引标签为特征训练的模型, 并未学习到原有基础模型中的误报事件。
            *   `4_generate_meta_features.py`: 基于基础模型预测和专家模型输出来生成元特征。
            *   `5_train_evaluate_meta_learner.py`: 训练并评估元学习器 (stacking 模型)。
            *   `6_finetune_base_model.py`: 对基础模型进行微调的脚本。
            *   `evaluate_fp_expert_on_tp.py`: 评估 FP 专家模型在 TP 样本上的表现。
            *   `debug_predict_test.py`: 用于调试预测过程的测试脚本。
    *   `legacy/`: 存放旧的、废弃的或实验性和学习的代码。
        *   `lstm_train.py`, `lstm_train - 副本.py`: 早期的 LSTM 模型训练尝试。
        *   `cuda_train.py`, `xgboost_cuda_training.py`, `cuda_profiler.py`, `checkcuda.py`: CUDA/GPU 加速相关的训练、性能分析和检查脚本。
        *   `gpu_memory_config.py`, `memory_optimization.py`: GPU 内存配置和优化脚本。
        *   `knntrain.py`, `xgboost_rf_knn.py`: KNN 及其他模型的早期实验脚本。
        *   (其他众多脚本为不同时期、不同参数或优化尝试的 XGBoost 训练及数据处理脚本的遗留版本)
    *   `nationwide/`: 全国范围的降雨预测研究代码。
        *   `project_all_for_deepling_learning/`: 核心处理流程和实验脚本。
            *   `loaddata.py`: 加载全国范围的预处理数据以供模型使用，从data/intermediate/下面的数据读取中国区域空间对齐操作后的数据
            *   `turn1.py` 至 `turn5_1.py`: 代表特征工程 v1 到 v5.1 版本迭代的脚本，逐步构建和优化特征集。
            *   `xgboost1.py` 至 `xgboost5_1.py` (及 `xgboost3_optuna.py`): 不同版本或配置的 XGBoost 模型训练脚本，`xgboost3_optuna.py` 使用 Optuna 进行超参数优化。
            *   `lightGBM1.py`: LightGBM 模型训练脚本。
            *   `naive_bayes1.py`, `naive_bayes1_optuna.py`: Naive Bayes 模型训练脚本，后者使用 Optuna 进行优化。
            *   `bayesian_network_fp_expert.py`: 使用贝叶斯网络构建 FP (误报) 专家模型的脚本。
            *   `feature_of_FP_FN.py`: 深入分析导致误报 (FP) 和漏报 (FN) 样本的特征分布的脚本。
            *   `sklearn_pipeline_eval.py`: 使用 scikit-learn Pipeline 进行模型评估的脚本。
            *   `get_fronts.py`: 修复当前系统字体问题的脚本
            *   (大量 `.png` 文件): 模型评估、特征分析等的可视化结果。
        *   `analysis/`: 针对全国范围研究的分析脚本。
            *   `analyze_feature_sets_v1_v2.py`: 对比分析 v1 和 v2 版本特征集的脚本。
            *   `analyze_correlations_v1.py`, `analyze_correlations_v2.py`: 分析 v1 和 v2 特征集内部特征相关性的脚本, 使用的是统计特征分析。
            *   `analyze_pca.py`: 进行主成分分析 (PCA) 的脚本。
    *   `readdata/`: 各类降雨原始数据的读取和初步解析脚本。
        *   `CHM.py`: 从原始数据中读取和处理出中国mask区域 CHM 地面观测融合数据的脚本。
        *   `sm2rain.py`: 从原始数据中读取和处理出中国mask区域 SM2RAIN 卫星降雨产品的脚本。
        *   `PERSIANN.py`: 从原始数据中读取和处理出中国mask区域 PERSIANN 卫星降雨产品的脚本。
        *   `gsmap.py`: 从原始数据中读取和处理出中国mask区域 GSMAP 卫星降雨产品的脚本。
        *   `CMORPH.py`: 从原始数据中读取和处理出中国mask区域 CMORPH 卫星降雨产品的脚本。
        *   `IMERG.py`: 从原始数据中读取和处理出中国mask区域 IMERG 卫星降雨产品的脚本。
        *   `chirps.py`: 从原始数据中读取和处理出中国mask区域 CHIRPS 卫星降雨产品的脚本。
        *   `datafix.py`: 处理空间对齐之后的数据进行修复, 主要进行nan值得处理, 原始产品数据中存在缺失值, 个别产品存在大片区域值得缺失, 本修复函数进行智能插值替换nan值, 能插值尽量插值, 不能插值就用IMERG的值进行替换。
        *   `scale_utils.py`: 数据缩放或尺度转换相关的工具。在从原始数据中进行空间对齐操作中使用,因为原始6个产品的空间分辨率不一致，部分是0.1°部分为0.25°, 本工具将对全部数据空间对齐至0.25°以便于后续的数据分析处理以及训练。
    *   `yangtze/`: 长江流域的降雨预测研究代码。
        *   `YangTsu/` (实际应为 `Yangtze`): 长江流域核心处理流程，脚本结构和功能与 `nationwide/project_all_for_deepling_learning/` 类似, 这下面的代码为后续和核心工作区域。
            *   `loaddata.py`: 加载长江流域的预处理数据。从data/intermediate/下面的数据读取中国区域空间对齐操作后的数据
            *   `turn1.py` 至 `turn5_1.py`: 针对长江流域的特征工程 v1 到 v5.1 版本迭代脚本。
            *   `xgboost1.py` 至 `xgboost5_1.py`: 针对长江流域的 XGBoost 模型训练脚本。
            *   `feature_of_FP_FN_Yangtsu.py`, `feature_of_FP_FN_Yangtsu_Mean.py`: 专门分析长江流域 FP/FN 样本特征的脚本。
            *   `product_pod_far.py`: 计算长江流域各降雨产品 POD/FAR 等指标的脚本。
        *   `analysis/`: (预期存放) 针对长江流域的特定分析脚本 (当前为空)。
*   **`tests/`**: 存放单元测试、集成测试等相关代码 (当前为空)。
*   **`.gitignore`**: Git 配置文件，指定哪些文件或目录不纳入版本控制。
*   **`README.md`**: 项目的入口文档，提供项目概述、技术架构、研究历程、未来展望和本目录结构说明。

## 6. 长江流域多源降雨产品性能评估 (基于不同分类阈值)

以下表格展示了长江流域几种主要降雨产品 (CMORPH, CHIRPS, GSMAP, IMERG, PERSIANN, SM2RAIN) 在不同降雨量分类阈值下的关键性能指标：命中率 (POD - Probability of Detection)、空报率 (FAR - False Alarm Ratio) 和临界成功指数 (CSI - Critical Success Index)。这些指标基于 TP (命中数), FP (空报数), FN (漏报数), TN (正确负例数) 计算得出。

#### 表1: 各产品在不同阈值下的 POD (命中率)

| 阈值   | CMORPH | CHIRPS | GSMAP  | IMERG  | PERSIANN | SM2RAIN |
|------|--------|--------|--------|--------|----------|---------|
| 0.00 | 0.4919 | 0.4113 | 0.5557 | 0.7515 | 0.6004   | 0.9153  |
| 0.05 | 0.5243 | 0.4280 | 0.5887 | 0.7227 | 0.6235   | 0.9074  |
| 0.10 | 0.5460 | 0.4383 | 0.6085 | 0.7053 | 0.6368   | 0.9030  |
| 0.15 | 0.5281 | 0.4441 | 0.6216 | 0.6933 | 0.6449   | 0.8973  |
| 0.20 | 0.5401 | 0.4470 | 0.6317 | 0.6841 | 0.6507   | 0.8946  |
| 0.25 | 0.5285 | 0.4487 | 0.6403 | 0.6767 | 0.6552   | 0.8914  |
| 0.30 | 0.5372 | 0.4497 | 0.6471 | 0.6700 | 0.6584   | 0.8894  |
| 0.35 | 0.5256 | 0.4509 | 0.6533 | 0.6645 | 0.6606   | 0.8870  |
| 0.40 | 0.5327 | 0.4517 | 0.6585 | 0.6593 | 0.6617   | 0.8852  |
| 0.45 | 0.5231 | 0.4522 | 0.6630 | 0.6548 | 0.6619   | 0.8831  |
| 0.50 | 0.5148 | 0.4525 | 0.6669 | 0.6506 | 0.6612   | 0.8809  |
| 0.55 | 0.5204 | 0.4528 | 0.6704 | 0.6466 | 0.6598   | 0.8793  |
| 0.60 | 0.5258 | 0.4530 | 0.6735 | 0.6429 | 0.6580   | 0.8776  |
| 0.65 | 0.5166 | 0.4532 | 0.6764 | 0.6394 | 0.6559   | 0.8758  |
| 0.70 | 0.5109 | 0.4534 | 0.6790 | 0.6361 | 0.6538   | 0.8739  |
| 0.75 | 0.5156 | 0.4536 | 0.6813 | 0.6329 | 0.6515   | 0.8724  |
| 0.80 | 0.5199 | 0.4537 | 0.6833 | 0.6300 | 0.6491   | 0.8710  |
| 0.85 | 0.5122 | 0.4538 | 0.6853 | 0.6273 | 0.6466   | 0.8691  |
| 0.90 | 0.5162 | 0.4538 | 0.6870 | 0.6245 | 0.6441   | 0.8674  |
| 0.95 | 0.5109 | 0.4539 | 0.6885 | 0.6218 | 0.6416   | 0.8659  |

#### 表2: 各产品在不同阈值下的 FAR (空报率)

| 阈值   | CMORPH | CHIRPS | GSMAP  | IMERG  | PERSIANN | SM2RAIN |
|------|--------|--------|--------|--------|----------|---------|
| 0.00 | 0.1173 | 0.1246 | 0.0250 | 0.1425 | 0.1602   | 0.2076  |
| 0.05 | 0.1607 | 0.1672 | 0.0454 | 0.1766 | 0.2145   | 0.2716  |
| 0.10 | 0.1905 | 0.1935 | 0.0613 | 0.1947 | 0.2467   | 0.3088  |
| 0.15 | 0.1977 | 0.2105 | 0.0734 | 0.2061 | 0.2676   | 0.3316  |
| 0.20 | 0.2144 | 0.2240 | 0.0837 | 0.2145 | 0.2831   | 0.3494  |
| 0.25 | 0.2187 | 0.2352 | 0.0931 | 0.2215 | 0.2960   | 0.3631  |
| 0.30 | 0.2311 | 0.2452 | 0.1014 | 0.2273 | 0.3067   | 0.3747  |
| 0.35 | 0.2332 | 0.2543 | 0.1091 | 0.2326 | 0.3165   | 0.3845  |
| 0.40 | 0.2435 | 0.2625 | 0.1162 | 0.2374 | 0.3249   | 0.3932  |
| 0.45 | 0.2449 | 0.2703 | 0.1231 | 0.2419 | 0.3327   | 0.4006  |
| 0.50 | 0.2464 | 0.2774 | 0.1296 | 0.2462 | 0.3397   | 0.4071  |
| 0.55 | 0.2546 | 0.2841 | 0.1357 | 0.2501 | 0.3460   | 0.4132  |
| 0.60 | 0.2625 | 0.2905 | 0.1416 | 0.2540 | 0.3519   | 0.4188  |
| 0.65 | 0.2628 | 0.2967 | 0.1472 | 0.2576 | 0.3574   | 0.4235  |
| 0.70 | 0.2646 | 0.3028 | 0.1528 | 0.2613 | 0.3627   | 0.4280  |
| 0.75 | 0.2714 | 0.3083 | 0.1580 | 0.2648 | 0.3675   | 0.4322  |
| 0.80 | 0.2779 | 0.3136 | 0.1630 | 0.2681 | 0.3719   | 0.4361  |
| 0.85 | 0.2778 | 0.3189 | 0.1678 | 0.2712 | 0.3763   | 0.4394  |
| 0.90 | 0.2842 | 0.3241 | 0.1726 | 0.2746 | 0.3805   | 0.4426  |
| 0.95 | 0.2856 | 0.3290 | 0.1773 | 0.2777 | 0.3845   | 0.4457  |

#### 表3: 各产品在不同阈值下的 CSI (临界成功指数)

| 阈值   | CMORPH | CHIRPS | GSMAP  | IMERG  | PERSIANN | SM2RAIN |
|------|--------|--------|--------|--------|----------|---------|
| 0.00 | 0.4617 | 0.3885 | 0.5479 | 0.6681 | 0.5387   | 0.7382  |
| 0.05 | 0.4765 | 0.3941 | 0.5727 | 0.6257 | 0.5328   | 0.6780  |
| 0.10 | 0.4838 | 0.3966 | 0.5852 | 0.6025 | 0.5269   | 0.6434  |
| 0.15 | 0.4673 | 0.3971 | 0.5924 | 0.5875 | 0.5219   | 0.6208  |
| 0.20 | 0.4707 | 0.3960 | 0.5973 | 0.5764 | 0.5176   | 0.6043  |
| 0.25 | 0.4604 | 0.3943 | 0.6008 | 0.5674 | 0.5137   | 0.5910  |
| 0.30 | 0.4625 | 0.3924 | 0.6031 | 0.5597 | 0.5099   | 0.5802  |
| 0.35 | 0.4532 | 0.3908 | 0.6049 | 0.5531 | 0.5058   | 0.5708  |
| 0.40 | 0.4548 | 0.3892 | 0.6061 | 0.5470 | 0.5019   | 0.5625  |
| 0.45 | 0.4472 | 0.3873 | 0.6065 | 0.5416 | 0.4976   | 0.5553  |
| 0.50 | 0.4406 | 0.3856 | 0.6067 | 0.5366 | 0.4934   | 0.5489  |
| 0.55 | 0.4419 | 0.3839 | 0.6065 | 0.5319 | 0.4891   | 0.5431  |
| 0.60 | 0.4429 | 0.3821 | 0.6062 | 0.5274 | 0.4848   | 0.5376  |
| 0.65 | 0.4363 | 0.3804 | 0.6057 | 0.5233 | 0.4806   | 0.5329  |
| 0.70 | 0.4316 | 0.3788 | 0.6049 | 0.5192 | 0.4765   | 0.5284  |
| 0.75 | 0.4325 | 0.3773 | 0.6040 | 0.5154 | 0.4726   | 0.5242  |
| 0.80 | 0.4332 | 0.3758 | 0.6031 | 0.5119 | 0.4689   | 0.5204  |
| 0.85 | 0.4279 | 0.3743 | 0.6021 | 0.5086 | 0.4652   | 0.5170  |
| 0.90 | 0.4284 | 0.3727 | 0.6009 | 0.5051 | 0.4615   | 0.5137  |
| 0.95 | 0.4243 | 0.3713 | 0.5995 | 0.5019 | 0.4580   | 0.5105  |

## 7. 长江流域各降雨产品基本统计特征

以下数据基于长江流域范围（掩码值为2的区域），时间跨度为2016-2020年。

| 指标                                   | CMORPH                 | CHIRPS                 | SM2RAIN                | IMERG                  | GSMAP                  | PERSIANN               |
|----------------------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|
| 平均值                                 | 3.3629                 | 3.5047                 | 3.9431                 | 3.5663                 | 3.2589                 | 3.5872                 |
| 标准差                                 | 9.9921                 | 9.8690                 | 5.4609                 | 9.7228                 | 7.9307                 | 8.1056                 |
| 最大值                                 | 379.8000               | 330.5150               | 228.4960               | 357.1993               | 280.7053               | 230.6858               |
| 最小值                                 | 0.0000                 | 0.0000                 | 0.0000                 | 0.0000                 | 0.0000                 | 0.0000                 |
| 中位数                                 | 0.0000                 | 0.0000                 | 1.9240                 | 0.1765                 | 0.0000                 | 0.2830                 |
| 众数 (count)                           | 0.0000 (3103372)       | 0.0000 (3453450)       | 0.0000 (709395)        | 0.0000 (1825289)       | 0.0000 (3052396)       | 0.0000 (2472006)       |
| 方差                                   | 99.8425                | 97.3975                | 29.8218                | 94.5334                | 62.8952                | 65.7014                |
| 偏度 (Skewness)                        | 6.1082                 | 5.5473                 | 3.0639                 | 5.9726                 | 4.9681                 | 4.7259                 |
| 峰度 (Kurtosis)                        | 57.8855                | 50.6663                | 21.6656                | 55.5745                | 40.8976                | 34.8649                |
| 和地面观测站(CHM)之间的相关系数        | 0.4456                 | 0.3900                 | 0.5695                 | 0.5014                 | 0.6454                 | 0.4133                 |
| 和 CMORPH 之间的相关系数               | 1.0000 (self-correlation) | 0.6147                 | 0.5000                 | 0.8259                 | 0.6593                 | 0.6752                 |
| 和 CHIRPS 之间的相关系数               | 0.6147                 | 1.0000 (self-correlation) | 0.4278                 | 0.6541                 | 0.5802                 | 0.7533                 |
| 和 SM2RAIN 之间的相关系数              | 0.5000                 | 0.4278                 | 1.0000 (self-correlation) | 0.5359                 | 0.6233                 | 0.4636                 |
| 和 IMERG 之间的相关系数                | 0.8259                 | 0.6541                 | 0.5359                 | 1.0000 (self-correlation) | 0.7261                 | 0.7134                 |
| 和 GSMAP 之间的相关系数                | 0.6593                 | 0.5802                 | 0.6233                 | 0.7261                 | 1.0000 (self-correlation) | 0.5920                 |
| 和 PERSIANN 之间的相关系数             | 0.6752                 | 0.7533                 | 0.4636                 | 0.7134                 | 0.5920                 | 1.0000 (self-correlation) |

// ... existing code ...
| 和 PERSIANN 之间的相关系数         | 0.6551                 | 0.7431                 | 0.5092                 | 0.7137                 | 0.5990                 | 1.0000 (self-correlation) |

## 8. 全国范围各降雨产品性能评估 (基于不同分类阈值)

以下表格展示了全国范围几种主要降雨产品 (CMORPH, CHIRPS, GSMAP, IMERG, PERSIANN, SM2RAIN) 在不同降雨量分类阈值下的关键性能指标：命中率 (POD - Probability of Detection)、空报率 (FAR - False Alarm Ratio) 和临界成功指数 (CSI - Critical Success Index)。这些指标基于 TP (命中数), FP (空报数), FN (漏报数), TN (正确负例数) 计算得出，并以 CHM 产品作为地面真值。

#### 表4: 全国范围各产品在不同阈值下的 POD (命中率)

| 阈值   | CMORPH | CHIRPS | GSMAP  | IMERG  | PERSIANN | SM2RAIN |
|------|--------|--------|--------|--------|----------|---------|
| 0.00 | 0.4474 | 0.3849 | 0.4636 | 0.7002 | 0.6594   | 0.7931  |
| 0.05 | 0.4871 | 0.3995 | 0.5097 | 0.6694 | 0.6740   | 0.7845  |
| 0.10 | 0.5124 | 0.4079 | 0.5366 | 0.6532 | 0.6787   | 0.7780  |
| 0.15 | 0.4917 | 0.4125 | 0.5539 | 0.6424 | 0.6798   | 0.7693  |
| 0.20 | 0.5052 | 0.4148 | 0.5670 | 0.6344 | 0.6793   | 0.7665  |
| 0.25 | 0.4925 | 0.4162 | 0.5776 | 0.6278 | 0.6781   | 0.7630  |
| 0.30 | 0.5021 | 0.4170 | 0.5861 | 0.6221 | 0.6762   | 0.7616  |
| 0.35 | 0.4896 | 0.4179 | 0.5936 | 0.6173 | 0.6738   | 0.7595  |
| 0.40 | 0.4973 | 0.4185 | 0.5999 | 0.6128 | 0.6708   | 0.7585  |
| 0.45 | 0.4869 | 0.4189 | 0.6055 | 0.6089 | 0.6674   | 0.7569  |
| 0.50 | 0.4780 | 0.4191 | 0.6103 | 0.6052 | 0.6636   | 0.7554  |
| 0.55 | 0.4840 | 0.4193 | 0.6146 | 0.6017 | 0.6595   | 0.7547  |
| 0.60 | 0.4897 | 0.4195 | 0.6185 | 0.5985 | 0.6553   | 0.7541  |
| 0.65 | 0.4803 | 0.4197 | 0.6221 | 0.5955 | 0.6512   | 0.7529  |
| 0.70 | 0.4743 | 0.4199 | 0.6254 | 0.5927 | 0.6472   | 0.7518  |
| 0.75 | 0.4792 | 0.4201 | 0.6283 | 0.5900 | 0.6432   | 0.7513  |
| 0.80 | 0.4838 | 0.4201 | 0.6309 | 0.5875 | 0.6393   | 0.7507  |
| 0.85 | 0.4757 | 0.4202 | 0.6334 | 0.5851 | 0.6354   | 0.7496  |
| 0.90 | 0.4800 | 0.4203 | 0.6357 | 0.5828 | 0.6316   | 0.7488  |
| 0.95 | 0.4746 | 0.4203 | 0.6377 | 0.5805 | 0.6279   | 0.7481  |

#### 表5: 全国范围各产品在不同阈值下的 FAR (空报率)

| 阈值   | CMORPH | CHIRPS | GSMAP  | IMERG  | PERSIANN | SM2RAIN |
|------|--------|--------|--------|--------|----------|---------|
| 0.00 | 0.2750 | 0.3085 | 0.0615 | 0.2850 | 0.3816   | 0.3519  |
| 0.05 | 0.3360 | 0.3551 | 0.0885 | 0.3116 | 0.4382   | 0.4127  |
| 0.10 | 0.3742 | 0.3766 | 0.1080 | 0.3244 | 0.4601   | 0.4387  |
| 0.15 | 0.3747 | 0.3881 | 0.1222 | 0.3318 | 0.4706   | 0.4456  |
| 0.20 | 0.3943 | 0.3962 | 0.1340 | 0.3371 | 0.4769   | 0.4537  |
| 0.25 | 0.3943 | 0.4026 | 0.1443 | 0.3418 | 0.4812   | 0.4577  |
| 0.30 | 0.4082 | 0.4080 | 0.1533 | 0.3456 | 0.4842   | 0.4619  |
| 0.35 | 0.4059 | 0.4127 | 0.1615 | 0.3491 | 0.4867   | 0.4643  |
| 0.40 | 0.4170 | 0.4168 | 0.1689 | 0.3522 | 0.4887   | 0.4672  |
| 0.45 | 0.4145 | 0.4208 | 0.1758 | 0.3553 | 0.4905   | 0.4689  |
| 0.50 | 0.4127 | 0.4245 | 0.1823 | 0.3581 | 0.4921   | 0.4703  |
| 0.55 | 0.4214 | 0.4278 | 0.1882 | 0.3607 | 0.4935   | 0.4723  |
| 0.60 | 0.4297 | 0.4312 | 0.1940 | 0.3634 | 0.4949   | 0.4741  |
| 0.65 | 0.4265 | 0.4343 | 0.1995 | 0.3661 | 0.4962   | 0.4751  |
| 0.70 | 0.4258 | 0.4375 | 0.2047 | 0.3686 | 0.4976   | 0.4762  |
| 0.75 | 0.4329 | 0.4405 | 0.2098 | 0.3711 | 0.4989   | 0.4777  |
| 0.80 | 0.4396 | 0.4433 | 0.2145 | 0.3734 | 0.5000   | 0.4790  |
| 0.85 | 0.4366 | 0.4462 | 0.2191 | 0.3757 | 0.5011   | 0.4798  |
| 0.90 | 0.4429 | 0.4490 | 0.2236 | 0.3779 | 0.5024   | 0.4807  |
| 0.95 | 0.4421 | 0.4517 | 0.2279 | 0.3802 | 0.5035   | 0.4817  |

#### 表6: 全国范围各产品在不同阈值下的 CSI (临界成功指数)

| 阈值   | CMORPH | CHIRPS | GSMAP  | IMERG  | PERSIANN | SM2RAIN |
|------|--------|--------|--------|--------|----------|---------|
| 0.00 | 0.3825 | 0.3285 | 0.4499 | 0.5474 | 0.4687   | 0.5544  |
| 0.05 | 0.3908 | 0.3275 | 0.4856 | 0.5138 | 0.4417   | 0.5057  |
| 0.10 | 0.3922 | 0.3273 | 0.5039 | 0.4973 | 0.4300   | 0.4838  |
| 0.15 | 0.3798 | 0.3270 | 0.5142 | 0.4871 | 0.4237   | 0.4753  |
| 0.20 | 0.3802 | 0.3261 | 0.5213 | 0.4796 | 0.4195   | 0.4684  |
| 0.25 | 0.3729 | 0.3250 | 0.5264 | 0.4735 | 0.4163   | 0.4641  |
| 0.30 | 0.3730 | 0.3239 | 0.5299 | 0.4683 | 0.4136   | 0.4605  |
| 0.35 | 0.3669 | 0.3231 | 0.5327 | 0.4638 | 0.4111   | 0.4580  |
| 0.40 | 0.3668 | 0.3221 | 0.5348 | 0.4596 | 0.4088   | 0.4555  |
| 0.45 | 0.3621 | 0.3211 | 0.5362 | 0.4559 | 0.4063   | 0.4537  |
| 0.50 | 0.3578 | 0.3201 | 0.5372 | 0.4524 | 0.4039   | 0.4521  |
| 0.55 | 0.3579 | 0.3192 | 0.5379 | 0.4492 | 0.4015   | 0.4505  |
| 0.60 | 0.3577 | 0.3183 | 0.5384 | 0.4461 | 0.3991   | 0.4489  |
| 0.65 | 0.3539 | 0.3174 | 0.5386 | 0.4431 | 0.3967   | 0.4478  |
| 0.70 | 0.3509 | 0.3165 | 0.5387 | 0.4403 | 0.3944   | 0.4466  |
| 0.75 | 0.3508 | 0.3157 | 0.5385 | 0.4377 | 0.3921   | 0.4453  |
| 0.80 | 0.3507 | 0.3148 | 0.5382 | 0.4352 | 0.3900   | 0.4442  |
| 0.85 | 0.3476 | 0.3140 | 0.5378 | 0.4327 | 0.3878   | 0.4432  |
| 0.90 | 0.3474 | 0.3130 | 0.5373 | 0.4304 | 0.3857   | 0.4423  |
| 0.95 | 0.3449 | 0.3122 | 0.5367 | 0.4281 | 0.3836   | 0.4412  |

// ... existing code ...
| 和 PERSIANN 之间的相关系数             | 0.6752                 | 0.7533                 | 0.4636                 | 0.7134                 | 0.5920                 | 1.0000 (self-correlation) |

## 9. 全国范围各降雨产品基本统计特征

以下数据基于全国范围（掩码值为1的区域），时间跨度为2016-2020年 (1827天)。目标变量 Y 为 CHM 产品。

| 指标                               | CMORPH                 | CHIRPS                 | SM2RAIN                | IMERG                  | GSMAP                  | PERSIANN               |
|------------------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|
| 平均值                             | 1.8652                 | 1.8549                 | 1.9931                 | 1.8931                 | 1.6654                 | 1.9591                 |
| 标准差                             | 6.9623                 | 6.9233                 | 4.2815                 | 6.7717                 | 5.7024                 | 5.5107                 |
| 最大值                             | 379.8000               | 330.5150               | 301.2768               | 408.9030               | 297.9254               | 281.0631               |
| 最小值                             | 0.0000                 | 0.0000                 | 0.0000                 | 0.0000                 | 0.0000                 | 0.0000                 |
| 中位数                             | 0.0000                 | 0.0000                 | 0.2000                 | 0.0194                 | 0.0000                 | 0.1256                 |
| 众数 (count)                       | 0.0000 (18647303)      | 0.0000 (19567263)      | 0.0000 (9411016)       | 0.0000 (13131758)      | 0.0000 (20520991)      | 0.0000 (11810182)      |
| 方差                               | 48.4740                | 47.9320                | 18.3316                | 45.8562                | 32.5170                | 30.3680                |
| 偏度 (Skewness)                    | 8.2594                 | 7.7101                 | 4.6727                 | 8.5174                 | 7.4365                 | 6.6837                 |
| 峰度 (Kurtosis)                    | 108.5944               | 96.0344                | 46.5308                | 119.3158               | 96.1135                | 72.6359                |
| 和 Y (CHM) 之间的相关系数         | 0.4407                 | 0.4124                 | 0.5743                 | 0.5204                 | 0.6591                 | 0.4416                 |
| 和 CMORPH 之间的相关系数           | 1.0000 (self-correlation) | 0.6000                 | 0.5021                 | 0.7943                 | 0.6313                 | 0.6551                 |
| 和 CHIRPS 之间的相关系数           | 0.6000                 | 1.0000 (self-correlation) | 0.4650                 | 0.6605                 | 0.5851                 | 0.7431                 |
| 和 SM2RAIN 之间的相关系数          | 0.5021                 | 0.4650                 | 1.0000 (self-correlation) | 0.5690                 | 0.6298                 | 0.5092                 |
| 和 IMERG 之间的相关系数            | 0.7943                 | 0.6605                 | 0.5690                 | 1.0000 (self-correlation) | 0.7326                 | 0.7137                 |
| 和 GSMAP 之间的相关系数            | 0.6313                 | 0.5851                 | 0.6298                 | 0.7326                 | 1.0000 (self-correlation) | 0.5990                 |
| 和 PERSIANN 之间的相关系数         | 0.6551                 | 0.7431                 | 0.5092                 | 0.7137                 | 0.5990                 | 1.0000 (self-correlation) |